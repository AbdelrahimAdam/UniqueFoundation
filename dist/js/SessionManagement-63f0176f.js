import{j as e,L as s}from"./index-b7c13edd.js";import{r as t}from"./vendor-0a74ad82.js";import"./firebase-d00d8d06.js";import{s as r}from"./sessionService-04125ca4.js";import{r as a}from"./recordingService-ad327dd0.js";import{c as i}from"./courseService-02b328a2.js";import{B as l}from"./Button-1fec977d.js";import n from"./CreateSessionModal-75f785ee.js";import{C as o}from"./CreateRecordingModal-b8399fc3.js";import{u as d}from"./useTranslation-40d56fa6.js";import{f as c,P as m,R as g,n as u,d as x,V as h,b as p,l as f,a as y,q as w,r as b,C as j,j as v,s as N}from"./ui-5d9f441a.js";import"./router-80e9042b.js";import"./utils-a27d9a93.js";import"./index.esm-e04fd8e7.js";import"./Select-21fe8f27.js";import"./utils-db1934d6.js";const k=()=>{d();const[j,k]=t.useState([]),[S,C]=t.useState([]),[R,L]=t.useState([]),[I,A]=t.useState(!0),[P,B]=t.useState(""),[E,F]=t.useState("all"),[z,T]=t.useState("all"),[M,U]=t.useState(!1),[D,$]=t.useState(!1),[q,G]=t.useState({}),[J,O]=t.useState(null);t.useEffect(()=>{V()},[]);const V=async()=>{try{A(!0);const[e,s,t]=await Promise.all([r.getAllSessions().catch(e=>[]),a.getAllRecordings().catch(e=>[]),i.getAllCourses().catch(e=>[])]),l=e.map(e=>({...e,collection:"sessions",isFromRecordingsCollection:!1})),n=s.filter(e=>e.meetLink||"scheduled"===e.status||"live"===e.status).map(e=>({...e,collection:"recordings",isFromRecordingsCollection:!0})),o=s.filter(e=>!e.meetLink&&("completed"===e.status||"recorded"===e.status)).map(e=>({...e,collection:"recordings",isFromRecordingsCollection:!1}));k([...l,...n]),C(o),L(t)}catch(e){}finally{A(!1)}},_=e=>{e.meetLink&&window.open(e.meetLink,"_blank")},H=async e=>{try{G(s=>({...s,[e]:!0}));const s=await a.getRecordingById(e);if(!s||!s.meetLink)throw new Error("Session not found in recordings collection");await r.createSession({meetLink:s.meetLink,title:s.title,description:s.description,scheduledTime:s.scheduledTime,duration:s.duration,category:s.category,visibility:s.visibility,maxParticipants:s.maxParticipants,courseId:s.courseId,enableRecording:s.enableRecording,status:s.status,recordingStatus:s.recordingStatus,isPublished:s.isPublished,instructorId:s.instructorId,instructorEmail:s.instructorEmail,instructorName:s.instructorName,createdBy:s.createdBy});await V()}catch(s){alert("Failed to migrate session: "+s.message)}finally{G(s=>({...s,[e]:!1}))}},K=j.filter(e=>{const s=e.title?.toLowerCase().includes(P.toLowerCase())||e.topic?.toLowerCase().includes(P.toLowerCase())||e.description?.toLowerCase().includes(P.toLowerCase())||e.instructorName?.toLowerCase().includes(P.toLowerCase()),t="all"===E||e.status===E;return s&&t}),Q=S.filter(e=>{const s=e.title?.toLowerCase().includes(P.toLowerCase())||e.description?.toLowerCase().includes(P.toLowerCase())||e.instructorName?.toLowerCase().includes(P.toLowerCase())||e.category?.toLowerCase().includes(P.toLowerCase()),t="all"===E||e.status===E;return s&&t}),W=e=>{switch(e){case"scheduled":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300";case"live":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300";case"completed":case"available":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300";case"recorded":return"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-300"}};if(I)return e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsx(s,{size:"lg"})});const X="sessions"===z?K:"recordings"===z?Q:[...K,...Q],Y=j.filter(e=>"recordings"===e.collection),Z=j.filter(e=>"sessions"===e.collection);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Session & Recording Management"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Manage Google Meet sessions and recordings"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(l,{onClick:()=>{O(null),$(!0)},variant:"outline",className:"bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white",children:[e.jsx(c,{className:"h-4 w-4 mr-2"}),"Add Recording"]}),e.jsxs(l,{onClick:()=>{O(null),U(!0)},className:"bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600",children:[e.jsx(m,{className:"h-4 w-4 mr-2"}),"Schedule Session"]})]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:Z.length}),e.jsx("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:"Sessions in Sessions Collection"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400",children:Y.length}),e.jsx("div",{className:"text-sm text-orange-700 dark:text-orange-300",children:"Sessions in Recordings Collection"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:S.length}),e.jsx("div",{className:"text-sm text-purple-700 dark:text-purple-300",children:"Standalone Recordings"})]})]}),Y.length>0&&e.jsxs(l,{onClick:()=>{window.confirm(`Migrate ${Y.length} sessions from recordings to sessions collection?`)&&Y.forEach(e=>{H(e.id)})},variant:"outline",className:"bg-orange-500 hover:bg-orange-600 text-white",children:[e.jsx(g,{className:"h-4 w-4 mr-2"}),"Migrate All Sessions"]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center space-y-4 lg:space-y-0 lg:space-x-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(u,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search sessions and recordings...",value:P,onChange:e=>B(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("select",{value:z,onChange:e=>T(e.target.value),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"sessions",children:"Sessions Only"}),e.jsx("option",{value:"recordings",children:"Recordings Only"})]}),e.jsxs("select",{value:E,onChange:e=>F(e.target.value),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"scheduled",children:"Scheduled"}),e.jsx("option",{value:"live",children:"Live"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"recorded",children:"Recorded"}),e.jsx("option",{value:"available",children:"Available"})]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:X.map(t=>{const i=(e=>e.meetLink?"session":"recording")(t),n="session"===i,o="recording"===i;(e=>{switch(e){case"scheduled":return x;case"live":return f;case"completed":case"available":return v;case"recorded":return N;default:;}})(t.status);const d="live"===t.status,c="scheduled"===t.status,m=t.recordingUrl||t.isRecorded,u=t.isPublished,k=(e=>"recordings"===e.collection&&e.meetLink)(t);return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden hover:shadow-xl transition-all duration-300",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[n&&e.jsx(x,{className:"h-4 w-4 text-blue-500"}),o&&e.jsx(h,{className:"h-4 w-4 text-purple-500"}),e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${W(t.status)}`,children:[n?"Session":"Recording"," â€¢ ",t.status]}),!u&&e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300",children:"Draft"}),n&&k&&e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-300",children:"From Recordings"})]}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white text-lg line-clamp-2",children:t.title||t.topic}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm mt-1 line-clamp-2",children:t.description})]})}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(p,{className:"h-4 w-4 mr-1"}),t.instructorName||"Unknown"]}),t.scheduledTime&&e.jsxs("span",{className:"flex items-center",children:[e.jsx(x,{className:"h-4 w-4 mr-1"}),new Date(t.scheduledTime).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"space-y-3",children:[t.scheduledTime&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Time"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:new Date(t.scheduledTime).toLocaleTimeString()})]}),t.duration&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Duration"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[t.duration," min"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Recording"}),e.jsx("span",{className:"text-sm font-medium "+(m?"text-green-600 dark:text-green-400":"text-gray-500 dark:text-gray-400"),children:m?"Available":"Not available"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-6",children:[n&&d&&e.jsxs(l,{onClick:()=>_(t),className:"flex-1 bg-red-600 hover:bg-red-700 text-white",children:[e.jsx(f,{className:"h-4 w-4 mr-2"}),"Join Live"]}),n&&c&&e.jsxs(l,{onClick:()=>_(t),variant:"outline",className:"flex-1",children:[e.jsx(x,{className:"h-4 w-4 mr-2"}),"Join"]}),n&&!m&&"completed"===t.status&&e.jsxs(l,{onClick:()=>(async(e,s=!1)=>{const t=prompt("Enter Google Drive recording URL:");if(t)try{let i;if(G(s=>({...s,[e]:!0})),i=s?S.find(s=>s.id===e&&s.meetLink):j.find(s=>s.id===e),!i)throw new Error("Session not found");s?await a.updateRecording(e,{recordingUrl:t,isRecorded:!0,recordingStatus:"available",status:"completed"}):await r.markAsRecorded(e,t),await a.createRecording({title:`${i.title} - Recording`,description:`Recording of ${i.title}`,recordingUrl:t,duration:i.duration||60,fileSize:250,quality:"1080p",courseId:i.courseId,instructorId:i.instructorId,instructorEmail:i.instructorEmail,instructorName:i.instructorName,visibility:i.visibility||"public",category:i.category||"general",status:"recorded",recordingStatus:"available",isPublished:!0}),await V()}catch(i){alert("Failed to add recording: "+i.message)}finally{G(s=>({...s,[e]:!1}))}})(t.id,k),disabled:q[t.id],className:"flex-1 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600",children:[q[t.id]?e.jsx(s,{size:"sm",className:"mr-2"}):e.jsx(h,{className:"h-4 w-4 mr-2"}),"Add Recording"]}),m&&e.jsx("a",{href:t.recordingUrl,target:"_blank",rel:"noopener noreferrer",className:"flex-1",children:e.jsxs(l,{variant:"outline",className:"w-full",children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"View Recording"]})}),n&&e.jsxs(e.Fragment,{children:[c&&e.jsx(l,{onClick:()=>(async(e,s=!1)=>{try{if(G(s=>({...s,[e]:!0})),s)await a.updateRecording(e,{status:"live"});else if(await r.getSessionById(e))await r.updateSessionStatus(e,"live");else{const s=await a.getRecordingById(e);if(!s||!s.meetLink)throw new Error("Session not found in any collection");await a.updateRecording(e,{status:"live"})}await V()}catch(t){alert("Failed to start session: "+t.message)}finally{G(s=>({...s,[e]:!1}))}})(t.id,k),variant:"outline",size:"sm",children:"Start"}),d&&e.jsx(l,{onClick:()=>(async(e,s=!1)=>{try{if(G(s=>({...s,[e]:!0})),s)await a.updateRecording(e,{status:"completed"});else if(await r.getSessionById(e))await r.updateSessionStatus(e,"completed");else{const s=await a.getRecordingById(e);if(!s||!s.meetLink)throw new Error("Session not found in any collection");await a.updateRecording(e,{status:"completed"})}await V()}catch(t){alert("Failed to end session: "+t.message)}finally{G(s=>({...s,[e]:!1}))}})(t.id,k),variant:"outline",size:"sm",children:"End"}),u?e.jsx(l,{onClick:()=>(async(e,s=!1)=>{try{if(G(s=>({...s,[e]:!0})),s)await a.updateRecording(e,{isPublished:!1});else if(await r.getSessionById(e))await r.updateSession(e,{isPublished:!1});else{const s=await a.getRecordingById(e);if(!s||!s.meetLink)throw new Error("Session not found in any collection");await a.updateRecording(e,{isPublished:!1})}await V()}catch(t){alert("Failed to unpublish session: "+t.message)}finally{G(s=>({...s,[e]:!1}))}})(t.id,k),variant:"outline",size:"sm",children:"Unpublish"}):e.jsx(l,{onClick:()=>(async(e,s=!1)=>{try{if(G(s=>({...s,[e]:!0})),s)await a.updateRecording(e,{isPublished:!0});else if(await r.getSessionById(e))await r.updateSession(e,{isPublished:!0});else{const s=await a.getRecordingById(e);if(!s||!s.meetLink)throw new Error("Session not found in any collection");await a.updateRecording(e,{isPublished:!0})}await V()}catch(t){alert("Failed to publish session: "+t.message)}finally{G(s=>({...s,[e]:!1}))}})(t.id,k),variant:"outline",size:"sm",children:"Publish"})]}),n&&k&&e.jsxs(l,{onClick:()=>H(t.id),disabled:q[t.id],variant:"outline",size:"sm",className:"text-orange-600 hover:text-orange-700 hover:bg-orange-50 dark:hover:bg-orange-900/20",children:[q[t.id]?e.jsx(s,{size:"sm",className:"mr-1"}):e.jsx(g,{className:"h-4 w-4 mr-1"}),"Migrate"]}),e.jsx(l,{onClick:()=>n?(O(t),void U(!0)):(O(t),void $(!0)),variant:"outline",size:"sm",children:e.jsx(w,{className:"h-4 w-4"})}),e.jsx(l,{onClick:()=>n?(async(e,s=!1)=>{if(window.confirm("Are you sure you want to delete this session?"))try{G(s=>({...s,[e]:!0})),s?await a.deleteRecording(e):await r.deleteSession(e),await V()}catch(t){alert("Failed to delete session: "+t.message)}finally{G(s=>({...s,[e]:!1}))}})(t.id,k):(async e=>{if(window.confirm("Are you sure you want to delete this recording?"))try{G(s=>({...s,[e]:!0})),await a.deleteRecording(e),await V()}catch(s){alert("Failed to delete recording: "+s.message)}finally{G(s=>({...s,[e]:!1}))}})(t.id),variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20",children:e.jsx(b,{className:"h-4 w-4"})})]})]})]},t.id)})}),0===X.length&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(h,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"No sessions or recordings found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:P||"all"!==E||"all"!==z?"Try adjusting your search or filters":"Get started by scheduling your first session or adding a recording"}),e.jsxs("div",{className:"flex justify-center space-x-3",children:[e.jsxs(l,{onClick:()=>$(!0),variant:"outline",className:"bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white",children:[e.jsx(c,{className:"h-4 w-4 mr-2"}),"Add Recording"]}),e.jsxs(l,{onClick:()=>U(!0),className:"bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600",children:[e.jsx(m,{className:"h-4 w-4 mr-2"}),"Schedule Session"]})]})]}),M&&e.jsx(n,{onClose:()=>U(!1),onSuccess:()=>{U(!1),V()},session:J}),D&&e.jsx(o,{onClose:()=>$(!1),onSuccess:()=>{$(!1),V()},recording:J})]})};export{k as default};
