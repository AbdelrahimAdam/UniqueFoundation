import{u as e,d as s,j as a}from"./index-b7c13edd.js";import{r}from"./vendor-0a74ad82.js";import{A as t,B as l,D as o,G as i,W as d,X as n,Y as c}from"./firebase-d00d8d06.js";import{B as m}from"./Button-1fec977d.js";import{I as u}from"./Input-23bedfdc.js";import{u as x}from"./useTranslation-40d56fa6.js";import{a2 as g,d as p,a3 as h,a4 as b,a1 as f,b as w,B as j,a0 as y,S as N,C as v,x as k,$ as P,T as C,U as z,M as S,a5 as L,a6 as U,L as q,E as I,a as $,a7 as A}from"./ui-5d9f441a.js";import"./router-80e9042b.js";import"./utils-a27d9a93.js";const T=()=>{const{t:T}=x(),{user:E,userProfile:R,updateProfile:M,userRole:D}=e(),[F,B]=r.useState(!1),[G,H]=r.useState(!1),[W,J]=r.useState(!1),[O,Q]=r.useState({}),[X,Y]=r.useState("profile"),[K,V]=r.useState(!1),[Z,_]=r.useState(!1),[ee,se]=r.useState(!1),[ae,re]=r.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[te,le]=r.useState(""),[oe,ie]=r.useState(""),[de,ne]=r.useState(!1),[ce,me]=r.useState({firstName:"",lastName:"",phone:"",address:"",bio:"",department:"",gradeLevel:"",subjects:"",qualifications:""});r.useEffect(()=>{R&&me({firstName:R.firstName||"",lastName:R.lastName||"",phone:R.phone||"",address:R.address||"",bio:R.bio||"",department:R.department||"",gradeLevel:R.gradeLevel||"",subjects:R.subjects||"",qualifications:R.qualifications||""}),ue()},[R,D]);const ue=async()=>{if(E)try{let e={};switch(D){case"admin":const a=await t(o(s,"users")),r=await t(o(s,"courses")),d=await t(l(o(s,"users"),i("role","==","teacher")));e={totalUsers:a.size,activeCourses:r.size,teachers:d.size,systemHealth:"98%"};break;case"teacher":const n=await t(l(o(s,"courses"),i("teacherId","==",E.uid))),c=await t(l(o(s,"sessions"),i("teacherId","==",E.uid))),m=await t(l(o(s,"users"),i("role","==","student")));e={totalCourses:n.size,sessions:c.size,students:m.size,rating:"4.8/5"};break;case"student":const u=await t(l(o(s,"enrollments"),i("studentId","==",E.uid))),x=await t(l(o(s,"progress"),i("studentId","==",E.uid),i("completed","==",!0))),g=await t(l(o(s,"sessions"),i("students","array-contains",E.uid)));e={enrolledCourses:u.size,completedLessons:x.size,upcomingSessions:g.size,progress:"75%"};break;default:e={}}Q(e)}catch(e){}},xe=e=>{const{name:s,value:a}=e.target;me(e=>({...e,[s]:a}))},ge=e=>{const{name:s,value:a}=e.target;re(e=>({...e,[s]:a})),te&&le(""),oe&&ie("")},pe=async()=>{H(!0);try{await M(ce),B(!1)}catch(e){}finally{H(!1)}},he=async()=>{if(le(""),ie(""),ae.currentPassword&&ae.newPassword&&ae.confirmPassword)if(ae.newPassword.length<6)le(T("profile.passwordMinLength","Password must be at least 6 characters long"));else if(ae.newPassword===ae.confirmPassword)if(ae.newPassword!==ae.currentPassword){ne(!0);try{const e=d.credential(E.email,ae.currentPassword);await n(E,e),await c(E,ae.newPassword),ie(T("profile.passwordChanged","Password changed successfully!")),re({currentPassword:"",newPassword:"",confirmPassword:""})}catch(e){switch(e.code){case"auth/wrong-password":le(T("profile.incorrectPassword","Current password is incorrect"));break;case"auth/weak-password":le(T("profile.weakPassword","Password is too weak. Please use a stronger password."));break;case"auth/requires-recent-login":le(T("profile.recentLoginRequired","Please log in again to change your password"));break;default:le(T("profile.passwordChangeFailed","Failed to change password. Please try again."))}}finally{ne(!1)}}else le(T("profile.samePassword","New password must be different from current password"));else le(T("profile.passwordsDontMatch","New passwords do not match"));else le(T("profile.fillAllFields","Please fill in all fields"))},be=(()=>{const e={admin:{icon:f,color:"purple",badge:T("admin.administrator","Administrator"),stats:[{label:T("admin.totalUsers","Total Users"),value:O.totalUsers||"0",icon:w,color:"text-blue-600"},{label:T("admin.activeCourses","Active Courses"),value:O.activeCourses||"0",icon:j,color:"text-green-600"},{label:T("admin.teachers","Teachers"),value:O.teachers||"0",icon:y,color:"text-purple-600"},{label:T("admin.systemHealth","System Health"),value:O.systemHealth||"100%",icon:N,color:"text-green-600"}]},teacher:{icon:y,color:"blue",badge:T("teacher.teacher","Teacher"),stats:[{label:T("teacher.totalCourses","Total Courses"),value:O.totalCourses||"0",icon:j,color:"text-blue-600"},{label:T("teacher.sessions","Sessions"),value:O.sessions||"0",icon:v,color:"text-green-600"},{label:T("teacher.students","Students"),value:O.students||"0",icon:w,color:"text-purple-600"},{label:T("teacher.rating","Rating"),value:O.rating||"0/5",icon:k,color:"text-yellow-600"}]},student:{icon:P,color:"green",badge:T("student.student","Student"),stats:[{label:T("student.enrolledCourses","Enrolled Courses"),value:O.enrolledCourses||"0",icon:j,color:"text-blue-600"},{label:T("student.completedLessons","Completed Lessons"),value:O.completedLessons||"0",icon:k,color:"text-green-600"},{label:T("student.upcomingSessions","Upcoming Sessions"),value:O.upcomingSessions||"0",icon:v,color:"text-purple-600"},{label:T("student.progress","Overall Progress"),value:O.progress||"0%",icon:C,color:"text-green-600"}]}};return e[D]||e.student})(),fe=be.icon;return a.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:T("profile.title","My Profile")}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:T("profile.description","Manage your profile and account settings")})]}),a.jsx("div",{className:"flex items-center space-x-4",children:a.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-${be.color}-100 text-${be.color}-800 dark:bg-${be.color}-900 dark:text-${be.color}-200`,children:[a.jsx(fe,{className:"w-4 h-4 mr-1"}),be.badge]})})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:be.stats.map((e,s)=>{const r=e.icon;return a.jsx("div",{className:"bg-gradient-to-br from-white to-gray-50 dark:from-gray-700 dark:to-gray-800 p-6 rounded-xl border border-gray-200 dark:border-gray-600",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:e.label}),a.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-2",children:e.value})]}),a.jsx(r,{className:`w-8 h-8 ${e.color}`})]})},s)})}),a.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:a.jsxs("nav",{className:"-mb-px flex space-x-8",children:[a.jsx("button",{onClick:()=>Y("profile"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("profile"===X?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:T("profile.profile","Profile")}),a.jsx("button",{onClick:()=>Y("password"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("password"===X?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:T("profile.password","Password")})]})})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[a.jsx("div",{className:"lg:col-span-1",children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 sticky top-6",children:[a.jsxs("div",{className:"flex flex-col items-center",children:[a.jsxs("div",{className:"relative",children:[a.jsxs("div",{className:"w-32 h-32 rounded-full border-4 border-white dark:border-gray-700 shadow-lg overflow-hidden",children:[(()=>{const e=R?.photoURL||E?.photoURL;return e?a.jsx("img",{src:e,alt:"Profile",className:"w-32 h-32 rounded-full object-cover border-4 border-white dark:border-gray-700 shadow-lg",onError:e=>{e.target.style.display="none",e.target.nextSibling.style.display="flex"}}):null})(),a.jsx("div",{className:`w-full h-full bg-gradient-to-br ${(()=>{switch(D){case"admin":return"from-purple-500 to-violet-600";case"teacher":return"from-blue-500 to-cyan-600";case"student":return"from-green-500 to-emerald-600";default:return"from-gray-500 to-gray-600"}})()} flex items-center justify-center text-white text-2xl font-bold ${R?.photoURL||E?.photoURL?"hidden":"flex"}`,children:R?.firstName&&R?.lastName?`${R.firstName.charAt(0)}${R.lastName.charAt(0)}`.toUpperCase():E?.email?E.email.charAt(0).toUpperCase():"U"})]}),F&&"profile"===X&&a.jsxs("label",{className:"absolute bottom-2 right-2 bg-blue-600 p-2 rounded-full cursor-pointer shadow-lg hover:bg-blue-700 transition-colors",children:[W?a.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):a.jsx(g,{size:16,className:"text-white"}),a.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:async e=>{const s=e.target.files[0];if(!s)return;if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(s.type))return void alert("Please select a valid image file (JPEG, PNG, GIF, WebP)");if(s.size>1048576)return void alert("Image size should be less than 1MB for quick upload");J(!0);const a=new FileReader;a.onload=async e=>{try{const s=e.target.result;await M({photoURL:s,photoURLType:"base64"}),alert("Profile picture updated successfully!")}catch(s){alert("Failed to update profile picture. Please try again.")}finally{J(!1)}},a.onerror=()=>{alert("Error reading file. Please try again."),J(!1)},a.readAsDataURL(s)},disabled:W})]})]}),a.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mt-4 text-center",children:[R?.firstName," ",R?.lastName]}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-center",children:E?.email}),a.jsx("div",{className:"mt-4 text-center",children:a.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-${be.color}-100 text-${be.color}-800 dark:bg-${be.color}-900 dark:text-${be.color}-200`,children:[a.jsx(fe,{className:"w-4 h-4 mr-1"}),be.badge]})})]}),a.jsxs("div",{className:"mt-6 space-y-4",children:[a.jsxs("div",{className:"flex items-center text-gray-600 dark:text-gray-400",children:[a.jsx(p,{size:18,className:"mr-3"}),a.jsxs("span",{className:"text-sm",children:[T("profile.memberSince","Member since"),": ",E?.metadata?.creationTime?new Date(E.metadata.creationTime).toLocaleDateString():"N/A"]})]}),a.jsxs("div",{className:"flex items-center text-gray-600 dark:text-gray-400",children:[a.jsx(h,{size:18,className:"mr-3"}),a.jsx("span",{className:"text-sm",children:ce.address||T("profile.noAddress","No address provided")})]}),a.jsxs("div",{className:"flex items-center text-gray-600 dark:text-gray-400",children:[a.jsx(b,{size:18,className:"mr-3"}),a.jsx("span",{className:"text-sm",children:ce.phone||T("profile.noPhone","No phone provided")})]})]})]})}),a.jsxs("div",{className:"lg:col-span-3",children:["profile"===X&&a.jsx("div",{className:"space-y-6",children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:T("profile.personalInfo","Personal Information")}),!F&&a.jsx(m,{variant:"outline",onClick:()=>B(!0),children:T("profile.edit","Edit Profile")})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(u,{label:T("profile.firstName","First Name"),name:"firstName",value:ce.firstName,onChange:xe,disabled:!F,icon:a.jsx(z,{size:18,className:"text-gray-400"})}),a.jsx(u,{label:T("profile.lastName","Last Name"),name:"lastName",value:ce.lastName,onChange:xe,disabled:!F})]}),a.jsx(u,{label:T("profile.email","Email Address"),name:"email",value:E?.email||"",disabled:!0,icon:a.jsx(S,{size:18,className:"text-gray-400"})}),a.jsx(u,{label:T("profile.phone","Phone Number"),name:"phone",value:ce.phone,onChange:xe,disabled:!F,icon:a.jsx(b,{size:18,className:"text-gray-400"})}),("admin"===D||"teacher"===D)&&a.jsx(u,{label:T("profile.department","Department"),name:"department",value:ce.department,onChange:xe,disabled:!F,icon:a.jsx(L,{size:18,className:"text-gray-400"})}),"student"===D&&a.jsx(u,{label:T("profile.gradeLevel","Grade Level"),name:"gradeLevel",value:ce.gradeLevel,onChange:xe,disabled:!F,icon:a.jsx(P,{size:18,className:"text-gray-400"})}),"teacher"===D&&a.jsx(u,{label:T("profile.subjects","Subjects"),name:"subjects",value:ce.subjects,onChange:xe,disabled:!F,placeholder:T("profile.subjectsPlaceholder","Math, Science, English..."),icon:a.jsx(j,{size:18,className:"text-gray-400"})}),"teacher"===D&&a.jsx(u,{label:T("profile.qualifications","Qualifications"),name:"qualifications",value:ce.qualifications,onChange:xe,disabled:!F,placeholder:T("profile.qualificationsPlaceholder","M.Ed, PhD, Teaching Certificate..."),icon:a.jsx(k,{size:18,className:"text-gray-400"})}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:T("profile.bio","Bio")}),a.jsx("textarea",{name:"bio",value:ce.bio,onChange:xe,disabled:!F,rows:4,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white disabled:bg-gray-100 dark:disabled:bg-gray-600 disabled:cursor-not-allowed",placeholder:T("profile.bioPlaceholder","Tell us about yourself...")})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:T("profile.address","Address")}),a.jsx("textarea",{name:"address",value:ce.address,onChange:xe,disabled:!F,rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white disabled:bg-gray-100 dark:disabled:bg-gray-600 disabled:cursor-not-allowed",placeholder:T("profile.addressPlaceholder","Enter your address...")})]}),F&&a.jsxs("div",{className:"flex space-x-4 pt-4",children:[a.jsxs(m,{onClick:pe,loading:G,className:"flex items-center",children:[a.jsx(U,{size:18,className:"mr-2"}),T("profile.save","Save Changes")]}),a.jsx(m,{variant:"outline",onClick:()=>{B(!1),me({firstName:R?.firstName||"",lastName:R?.lastName||"",phone:R?.phone||"",address:R?.address||"",bio:R?.bio||"",department:R?.department||"",gradeLevel:R?.gradeLevel||"",subjects:R?.subjects||"",qualifications:R?.qualifications||""})},children:T("profile.cancel","Cancel")})]})]})]})}),"password"===X&&a.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6",children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:T("profile.changePassword","Change Password")}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:T("profile.passwordSecurity","Update your password to keep your account secure")})]}),te&&a.jsx("div",{className:"mb-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:a.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:te})}),oe&&a.jsx("div",{className:"mb-4 p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:a.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:oe})}),a.jsxs("div",{className:"space-y-4 max-w-md",children:[a.jsx(u,{label:T("profile.currentPassword","Current Password"),name:"currentPassword",type:K?"text":"password",value:ae.currentPassword,onChange:ge,icon:a.jsx(q,{size:18,className:"text-gray-400"}),trailingIcon:a.jsx("button",{type:"button",onClick:()=>V(!K),className:"text-gray-400 hover:text-gray-600",children:K?a.jsx(I,{size:18}):a.jsx($,{size:18})})}),a.jsx(u,{label:T("profile.newPassword","New Password"),name:"newPassword",type:Z?"text":"password",value:ae.newPassword,onChange:ge,icon:a.jsx(A,{size:18,className:"text-gray-400"}),trailingIcon:a.jsx("button",{type:"button",onClick:()=>_(!Z),className:"text-gray-400 hover:text-gray-600",children:Z?a.jsx(I,{size:18}):a.jsx($,{size:18})})}),a.jsx(u,{label:T("profile.confirmPassword","Confirm New Password"),name:"confirmPassword",type:ee?"text":"password",value:ae.confirmPassword,onChange:ge,icon:a.jsx(A,{size:18,className:"text-gray-400"}),trailingIcon:a.jsx("button",{type:"button",onClick:()=>se(!ee),className:"text-gray-400 hover:text-gray-600",children:ee?a.jsx(I,{size:18}):a.jsx($,{size:18})})}),a.jsx("div",{className:"pt-4",children:a.jsxs(m,{onClick:he,loading:de,className:"flex items-center",children:[a.jsx(A,{size:18,className:"mr-2"}),T("profile.updatePassword","Update Password")]})}),a.jsxs("div",{className:"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[a.jsx("h3",{className:"text-sm font-medium text-blue-800 dark:text-blue-300 mb-2",children:T("profile.passwordTips","Password Tips")}),a.jsxs("ul",{className:"text-xs text-blue-700 dark:text-blue-400 space-y-1",children:[a.jsxs("li",{children:["• ",T("profile.minLength","Use at least 6 characters")]}),a.jsxs("li",{children:["• ",T("profile.includeNumbers","Include numbers and symbols")]}),a.jsxs("li",{children:["• ",T("profile.avoidCommon","Avoid common words and patterns")]}),a.jsxs("li",{children:["• ",T("profile.uniquePassword","Use a unique password for this account")]})]})]})]})]})]})]})]})};export{T as default};
