var e=Object.defineProperty,s=Object.defineProperties,t=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,l=(s,t,r)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,n=(e,s)=>{for(var t in s||(s={}))a.call(s,t)&&l(e,t,s[t]);if(r)for(var t of r(s))i.call(s,t)&&l(e,t,s[t]);return e},o=(e,r)=>s(e,t(r));import{j as d,L as c}from"./index-c63f14c2.js";import{r as m}from"./vendor-c3615fdd.js";import"./firebase-9a5fb30d.js";import{s as u}from"./sessionService-69fc7e03.js";import{r as g}from"./recordingService-265d9a9f.js";import{c as x}from"./courseService-fdde1342.js";import{B as h}from"./Button-4635154f.js";import p from"./CreateSessionModal-dc8a8bba.js";import{C as f}from"./CreateRecordingModal-29d1c973.js";import{u as b}from"./useTranslation-89f0f982.js";import{f as y,P as j,R as w,n as v,d as N,V as k,b as S,l as C,a as R,q as L,r as P,C as I,j as A,s as E}from"./ui-e3d8d230.js";import"./router-4adec120.js";import"./utils-5b9d0682.js";import"./index.esm-c19471e5.js";import"./Select-583e9346.js";import"./utils-db1934d6.js";const B=()=>{b();const[e,s]=m.useState([]),[t,r]=m.useState([]),[a,i]=m.useState([]),[l,I]=m.useState(!0),[B,F]=m.useState(""),[z,O]=m.useState("all"),[T,M]=m.useState("all"),[D,U]=m.useState(!1),[$,q]=m.useState(!1),[G,J]=m.useState({}),[V,_]=m.useState(null);m.useEffect(()=>{H()},[]);const H=async()=>{try{I(!0);const[e,t,a]=await Promise.all([u.getAllSessions().catch(e=>[]),g.getAllRecordings().catch(e=>[]),x.getAllCourses().catch(e=>[])]),l=e.map(e=>o(n({},e),{collection:"sessions",isFromRecordingsCollection:!1})),d=t.filter(e=>e.meetLink||"scheduled"===e.status||"live"===e.status).map(e=>o(n({},e),{collection:"recordings",isFromRecordingsCollection:!0})),c=t.filter(e=>!e.meetLink&&("completed"===e.status||"recorded"===e.status)).map(e=>o(n({},e),{collection:"recordings",isFromRecordingsCollection:!1}));s([...l,...d]),r(c),i(a)}catch(e){}finally{I(!1)}},K=e=>{e.meetLink&&window.open(e.meetLink,"_blank")},Q=async e=>{try{J(s=>o(n({},s),{[e]:!0}));const s=await g.getRecordingById(e);if(!s||!s.meetLink)throw new Error("Session not found in recordings collection");await u.createSession({meetLink:s.meetLink,title:s.title,description:s.description,scheduledTime:s.scheduledTime,duration:s.duration,category:s.category,visibility:s.visibility,maxParticipants:s.maxParticipants,courseId:s.courseId,enableRecording:s.enableRecording,status:s.status,recordingStatus:s.recordingStatus,isPublished:s.isPublished,instructorId:s.instructorId,instructorEmail:s.instructorEmail,instructorName:s.instructorName,createdBy:s.createdBy});await H()}catch(s){alert("Failed to migrate session: "+s.message)}finally{J(s=>o(n({},s),{[e]:!1}))}},W=e.filter(e=>{var s,t,r,a;const i=(null==(s=e.title)?void 0:s.toLowerCase().includes(B.toLowerCase()))||(null==(t=e.topic)?void 0:t.toLowerCase().includes(B.toLowerCase()))||(null==(r=e.description)?void 0:r.toLowerCase().includes(B.toLowerCase()))||(null==(a=e.instructorName)?void 0:a.toLowerCase().includes(B.toLowerCase())),l="all"===z||e.status===z;return i&&l}),X=t.filter(e=>{var s,t,r,a;const i=(null==(s=e.title)?void 0:s.toLowerCase().includes(B.toLowerCase()))||(null==(t=e.description)?void 0:t.toLowerCase().includes(B.toLowerCase()))||(null==(r=e.instructorName)?void 0:r.toLowerCase().includes(B.toLowerCase()))||(null==(a=e.category)?void 0:a.toLowerCase().includes(B.toLowerCase())),l="all"===z||e.status===z;return i&&l}),Y=e=>{switch(e){case"scheduled":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300";case"live":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300";case"completed":case"available":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300";case"recorded":return"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-300"}};if(l)return d.jsx("div",{className:"flex items-center justify-center min-h-96",children:d.jsx(c,{size:"lg"})});const Z="sessions"===T?W:"recordings"===T?X:[...W,...X],ee=e.filter(e=>"recordings"===e.collection),se=e.filter(e=>"sessions"===e.collection);return d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Session & Recording Management"}),d.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Manage Google Meet sessions and recordings"})]}),d.jsxs("div",{className:"flex space-x-3",children:[d.jsxs(h,{onClick:()=>{_(null),q(!0)},variant:"outline",className:"bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white",children:[d.jsx(y,{className:"h-4 w-4 mr-2"}),"Add Recording"]}),d.jsxs(h,{onClick:()=>{_(null),U(!0)},className:"bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600",children:[d.jsx(j,{className:"h-4 w-4 mr-2"}),"Schedule Session"]})]})]}),d.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center space-x-4",children:[d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:se.length}),d.jsx("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:"Sessions in Sessions Collection"})]}),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400",children:ee.length}),d.jsx("div",{className:"text-sm text-orange-700 dark:text-orange-300",children:"Sessions in Recordings Collection"})]}),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:t.length}),d.jsx("div",{className:"text-sm text-purple-700 dark:text-purple-300",children:"Standalone Recordings"})]})]}),ee.length>0&&d.jsxs(h,{onClick:()=>{window.confirm(`Migrate ${ee.length} sessions from recordings to sessions collection?`)&&ee.forEach(e=>{Q(e.id)})},variant:"outline",className:"bg-orange-500 hover:bg-orange-600 text-white",children:[d.jsx(w,{className:"h-4 w-4 mr-2"}),"Migrate All Sessions"]})]})}),d.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-200 dark:border-gray-700",children:d.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center space-y-4 lg:space-y-0 lg:space-x-4",children:[d.jsx("div",{className:"flex-1",children:d.jsxs("div",{className:"relative",children:[d.jsx(v,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),d.jsx("input",{type:"text",placeholder:"Search sessions and recordings...",value:B,onChange:e=>F(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),d.jsxs("div",{className:"flex space-x-4",children:[d.jsxs("select",{value:T,onChange:e=>M(e.target.value),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[d.jsx("option",{value:"all",children:"All Types"}),d.jsx("option",{value:"sessions",children:"Sessions Only"}),d.jsx("option",{value:"recordings",children:"Recordings Only"})]}),d.jsxs("select",{value:z,onChange:e=>O(e.target.value),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[d.jsx("option",{value:"all",children:"All Status"}),d.jsx("option",{value:"scheduled",children:"Scheduled"}),d.jsx("option",{value:"live",children:"Live"}),d.jsx("option",{value:"completed",children:"Completed"}),d.jsx("option",{value:"recorded",children:"Recorded"}),d.jsx("option",{value:"available",children:"Available"})]})]})]})}),d.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:Z.map(s=>{const r=(e=>e.meetLink?"session":"recording")(s),a="session"===r,i="recording"===r;(e=>{switch(e){case"scheduled":return N;case"live":return C;case"completed":case"available":return A;case"recorded":return E;default:;}})(s.status);const l="live"===s.status,m="scheduled"===s.status,x=s.recordingUrl||s.isRecorded,p=s.isPublished,f=(e=>"recordings"===e.collection&&e.meetLink)(s);return d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden hover:shadow-xl transition-all duration-300",children:[d.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[d.jsx("div",{className:"flex items-start justify-between mb-3",children:d.jsxs("div",{className:"flex-1",children:[d.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[a&&d.jsx(N,{className:"h-4 w-4 text-blue-500"}),i&&d.jsx(k,{className:"h-4 w-4 text-purple-500"}),d.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${Y(s.status)}`,children:[a?"Session":"Recording"," â€¢ ",s.status]}),!p&&d.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300",children:"Draft"}),a&&f&&d.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-300",children:"From Recordings"})]}),d.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white text-lg line-clamp-2",children:s.title||s.topic}),d.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm mt-1 line-clamp-2",children:s.description})]})}),d.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500 dark:text-gray-400",children:[d.jsxs("span",{className:"flex items-center",children:[d.jsx(S,{className:"h-4 w-4 mr-1"}),s.instructorName||"Unknown"]}),s.scheduledTime&&d.jsxs("span",{className:"flex items-center",children:[d.jsx(N,{className:"h-4 w-4 mr-1"}),new Date(s.scheduledTime).toLocaleDateString()]})]})]}),d.jsxs("div",{className:"p-6",children:[d.jsxs("div",{className:"space-y-3",children:[s.scheduledTime&&d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Time"}),d.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:new Date(s.scheduledTime).toLocaleTimeString()})]}),s.duration&&d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Duration"}),d.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[s.duration," min"]})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Recording"}),d.jsx("span",{className:"text-sm font-medium "+(x?"text-green-600 dark:text-green-400":"text-gray-500 dark:text-gray-400"),children:x?"Available":"Not available"})]})]}),d.jsxs("div",{className:"flex flex-wrap gap-2 mt-6",children:[a&&l&&d.jsxs(h,{onClick:()=>K(s),className:"flex-1 bg-red-600 hover:bg-red-700 text-white",children:[d.jsx(C,{className:"h-4 w-4 mr-2"}),"Join Live"]}),a&&m&&d.jsxs(h,{onClick:()=>K(s),variant:"outline",className:"flex-1",children:[d.jsx(N,{className:"h-4 w-4 mr-2"}),"Join"]}),a&&!x&&"completed"===s.status&&d.jsxs(h,{onClick:()=>(async(s,r=!1)=>{const a=prompt("Enter Google Drive recording URL:");if(a)try{let i;if(J(e=>o(n({},e),{[s]:!0})),i=r?t.find(e=>e.id===s&&e.meetLink):e.find(e=>e.id===s),!i)throw new Error("Session not found");r?await g.updateRecording(s,{recordingUrl:a,isRecorded:!0,recordingStatus:"available",status:"completed"}):await u.markAsRecorded(s,a),await g.createRecording({title:`${i.title} - Recording`,description:`Recording of ${i.title}`,recordingUrl:a,duration:i.duration||60,fileSize:250,quality:"1080p",courseId:i.courseId,instructorId:i.instructorId,instructorEmail:i.instructorEmail,instructorName:i.instructorName,visibility:i.visibility||"public",category:i.category||"general",status:"recorded",recordingStatus:"available",isPublished:!0}),await H()}catch(i){alert("Failed to add recording: "+i.message)}finally{J(e=>o(n({},e),{[s]:!1}))}})(s.id,f),disabled:G[s.id],className:"flex-1 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600",children:[G[s.id]?d.jsx(c,{size:"sm",className:"mr-2"}):d.jsx(k,{className:"h-4 w-4 mr-2"}),"Add Recording"]}),x&&d.jsx("a",{href:s.recordingUrl,target:"_blank",rel:"noopener noreferrer",className:"flex-1",children:d.jsxs(h,{variant:"outline",className:"w-full",children:[d.jsx(R,{className:"h-4 w-4 mr-2"}),"View Recording"]})}),a&&d.jsxs(d.Fragment,{children:[m&&d.jsx(h,{onClick:()=>(async(e,s=!1)=>{try{if(J(s=>o(n({},s),{[e]:!0})),s)await g.updateRecording(e,{status:"live"});else if(await u.getSessionById(e))await u.updateSessionStatus(e,"live");else{const s=await g.getRecordingById(e);if(!s||!s.meetLink)throw new Error("Session not found in any collection");await g.updateRecording(e,{status:"live"})}await H()}catch(t){alert("Failed to start session: "+t.message)}finally{J(s=>o(n({},s),{[e]:!1}))}})(s.id,f),variant:"outline",size:"sm",children:"Start"}),l&&d.jsx(h,{onClick:()=>(async(e,s=!1)=>{try{if(J(s=>o(n({},s),{[e]:!0})),s)await g.updateRecording(e,{status:"completed"});else if(await u.getSessionById(e))await u.updateSessionStatus(e,"completed");else{const s=await g.getRecordingById(e);if(!s||!s.meetLink)throw new Error("Session not found in any collection");await g.updateRecording(e,{status:"completed"})}await H()}catch(t){alert("Failed to end session: "+t.message)}finally{J(s=>o(n({},s),{[e]:!1}))}})(s.id,f),variant:"outline",size:"sm",children:"End"}),p?d.jsx(h,{onClick:()=>(async(e,s=!1)=>{try{if(J(s=>o(n({},s),{[e]:!0})),s)await g.updateRecording(e,{isPublished:!1});else if(await u.getSessionById(e))await u.updateSession(e,{isPublished:!1});else{const s=await g.getRecordingById(e);if(!s||!s.meetLink)throw new Error("Session not found in any collection");await g.updateRecording(e,{isPublished:!1})}await H()}catch(t){alert("Failed to unpublish session: "+t.message)}finally{J(s=>o(n({},s),{[e]:!1}))}})(s.id,f),variant:"outline",size:"sm",children:"Unpublish"}):d.jsx(h,{onClick:()=>(async(e,s=!1)=>{try{if(J(s=>o(n({},s),{[e]:!0})),s)await g.updateRecording(e,{isPublished:!0});else if(await u.getSessionById(e))await u.updateSession(e,{isPublished:!0});else{const s=await g.getRecordingById(e);if(!s||!s.meetLink)throw new Error("Session not found in any collection");await g.updateRecording(e,{isPublished:!0})}await H()}catch(t){alert("Failed to publish session: "+t.message)}finally{J(s=>o(n({},s),{[e]:!1}))}})(s.id,f),variant:"outline",size:"sm",children:"Publish"})]}),a&&f&&d.jsxs(h,{onClick:()=>Q(s.id),disabled:G[s.id],variant:"outline",size:"sm",className:"text-orange-600 hover:text-orange-700 hover:bg-orange-50 dark:hover:bg-orange-900/20",children:[G[s.id]?d.jsx(c,{size:"sm",className:"mr-1"}):d.jsx(w,{className:"h-4 w-4 mr-1"}),"Migrate"]}),d.jsx(h,{onClick:()=>a?(_(s),void U(!0)):(_(s),void q(!0)),variant:"outline",size:"sm",children:d.jsx(L,{className:"h-4 w-4"})}),d.jsx(h,{onClick:()=>a?(async(e,s=!1)=>{if(window.confirm("Are you sure you want to delete this session?"))try{J(s=>o(n({},s),{[e]:!0})),s?await g.deleteRecording(e):await u.deleteSession(e),await H()}catch(t){alert("Failed to delete session: "+t.message)}finally{J(s=>o(n({},s),{[e]:!1}))}})(s.id,f):(async e=>{if(window.confirm("Are you sure you want to delete this recording?"))try{J(s=>o(n({},s),{[e]:!0})),await g.deleteRecording(e),await H()}catch(s){alert("Failed to delete recording: "+s.message)}finally{J(s=>o(n({},s),{[e]:!1}))}})(s.id),variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20",children:d.jsx(P,{className:"h-4 w-4"})})]})]})]},s.id)})}),0===Z.length&&d.jsxs("div",{className:"text-center py-12",children:[d.jsx(k,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),d.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"No sessions or recordings found"}),d.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:B||"all"!==z||"all"!==T?"Try adjusting your search or filters":"Get started by scheduling your first session or adding a recording"}),d.jsxs("div",{className:"flex justify-center space-x-3",children:[d.jsxs(h,{onClick:()=>q(!0),variant:"outline",className:"bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white",children:[d.jsx(y,{className:"h-4 w-4 mr-2"}),"Add Recording"]}),d.jsxs(h,{onClick:()=>U(!0),className:"bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600",children:[d.jsx(j,{className:"h-4 w-4 mr-2"}),"Schedule Session"]})]})]}),D&&d.jsx(p,{onClose:()=>U(!1),onSuccess:()=>{U(!1),H()},session:V}),$&&d.jsx(f,{onClose:()=>q(!1),onSuccess:()=>{q(!1),H()},recording:V})]})};export{B as default};
