var e=Object.defineProperty,s=Object.defineProperties,t=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,l=(s,t,r)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,n=(e,s)=>{for(var t in s||(s={}))a.call(s,t)&&l(e,t,s[t]);if(r)for(var t of r(s))i.call(s,t)&&l(e,t,s[t]);return e},o=(e,r)=>s(e,t(r));import{j as d,L as c}from"./index-CI4zpFZI.js";import{r as m}from"./router-C3Im-STG.js";import"./firebase-BFqJWPH6.js";import{s as u}from"./sessionService-CZ53Cjk9.js";import{r as g}from"./recordingService-DLOKybmB.js";import{c as x}from"./courseService-AQ5gPFVj.js";import{B as h}from"./Button-ye-G-80u.js";import p from"./CreateSessionModal-BROzwxVA.js";import{C as f}from"./CreateRecordingModal-Bt7Etmob.js";import{u as b}from"./useTranslation-D7bftQm-.js";import{f as y,P as j,R as w,k as v,d as N,V as k,b as S,m as C,a as R,q as L,r as P,C as I,n as A,s as E}from"./ui-BAjx5vmw.js";import"./vendor-BhyxaAfg.js";import"./utils-nJVaOoPq.js";import"./index.esm-Vr2sJyeS.js";import"./Select-BXp-jGT8.js";import"./utils-FV6rFRcL.js";const B=()=>{const{t:e}=b(),[s,t]=m.useState([]),[r,a]=m.useState([]),[i,l]=m.useState([]),[I,B]=m.useState(!0),[F,z]=m.useState(""),[O,T]=m.useState("all"),[M,D]=m.useState("all"),[U,$]=m.useState(!1),[q,G]=m.useState(!1),[J,V]=m.useState({}),[_,H]=m.useState(null);m.useEffect(()=>{K()},[]);const K=async()=>{try{B(!0);const[e,s,r]=await Promise.all([u.getAllSessions().catch(e=>[]),g.getAllRecordings().catch(e=>[]),x.getAllCourses().catch(e=>[])]),i=e.map(e=>o(n({},e),{collection:"sessions",isFromRecordingsCollection:!1})),d=s.filter(e=>e.meetLink||"scheduled"===e.status||"live"===e.status).map(e=>o(n({},e),{collection:"recordings",isFromRecordingsCollection:!0})),c=s.filter(e=>!e.meetLink&&("completed"===e.status||"recorded"===e.status)).map(e=>o(n({},e),{collection:"recordings",isFromRecordingsCollection:!1}));t([...i,...d]),a(c),l(r)}catch(e){}finally{B(!1)}},Q=e=>{e.meetLink&&window.open(e.meetLink,"_blank")},W=async e=>{try{V(s=>o(n({},s),{[e]:!0}));const s=await g.getRecordingById(e);if(!s||!s.meetLink)throw new Error("Session not found in recordings collection");await u.createSession({meetLink:s.meetLink,title:s.title,description:s.description,scheduledTime:s.scheduledTime,duration:s.duration,category:s.category,visibility:s.visibility,maxParticipants:s.maxParticipants,courseId:s.courseId,enableRecording:s.enableRecording,status:s.status,recordingStatus:s.recordingStatus,isPublished:s.isPublished,instructorId:s.instructorId,instructorEmail:s.instructorEmail,instructorName:s.instructorName,createdBy:s.createdBy});await K()}catch(s){alert("Failed to migrate session: "+s.message)}finally{V(s=>o(n({},s),{[e]:!1}))}},X=s.filter(e=>{var s,t,r,a;const i=(null==(s=e.title)?void 0:s.toLowerCase().includes(F.toLowerCase()))||(null==(t=e.topic)?void 0:t.toLowerCase().includes(F.toLowerCase()))||(null==(r=e.description)?void 0:r.toLowerCase().includes(F.toLowerCase()))||(null==(a=e.instructorName)?void 0:a.toLowerCase().includes(F.toLowerCase())),l="all"===O||e.status===O;return i&&l}),Y=r.filter(e=>{var s,t,r,a;const i=(null==(s=e.title)?void 0:s.toLowerCase().includes(F.toLowerCase()))||(null==(t=e.description)?void 0:t.toLowerCase().includes(F.toLowerCase()))||(null==(r=e.instructorName)?void 0:r.toLowerCase().includes(F.toLowerCase()))||(null==(a=e.category)?void 0:a.toLowerCase().includes(F.toLowerCase())),l="all"===O||e.status===O;return i&&l}),Z=e=>{switch(e){case"scheduled":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300";case"live":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300";case"completed":case"available":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300";case"recorded":return"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-300"}};if(I)return d.jsx("div",{className:"flex items-center justify-center min-h-96",children:d.jsx(c,{size:"lg"})});const ee="sessions"===M?X:"recordings"===M?Y:[...X,...Y],se=s.filter(e=>"recordings"===e.collection),te=s.filter(e=>"sessions"===e.collection);return d.jsxs("div",{className:"space-y-6",children:[d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{children:[d.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Session & Recording Management"}),d.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Manage Google Meet sessions and recordings"})]}),d.jsxs("div",{className:"flex space-x-3",children:[d.jsxs(h,{onClick:()=>{H(null),G(!0)},variant:"outline",className:"bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white",children:[d.jsx(y,{className:"h-4 w-4 mr-2"}),"Add Recording"]}),d.jsxs(h,{onClick:()=>{H(null),$(!0)},className:"bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600",children:[d.jsx(j,{className:"h-4 w-4 mr-2"}),"Schedule Session"]})]})]}),d.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsxs("div",{className:"flex items-center space-x-4",children:[d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:te.length}),d.jsx("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:"Sessions in Sessions Collection"})]}),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400",children:se.length}),d.jsx("div",{className:"text-sm text-orange-700 dark:text-orange-300",children:"Sessions in Recordings Collection"})]}),d.jsxs("div",{className:"text-center",children:[d.jsx("div",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:r.length}),d.jsx("div",{className:"text-sm text-purple-700 dark:text-purple-300",children:"Standalone Recordings"})]})]}),se.length>0&&d.jsxs(h,{onClick:()=>{window.confirm(`Migrate ${se.length} sessions from recordings to sessions collection?`)&&se.forEach(e=>{W(e.id)})},variant:"outline",className:"bg-orange-500 hover:bg-orange-600 text-white",children:[d.jsx(w,{className:"h-4 w-4 mr-2"}),"Migrate All Sessions"]})]})}),d.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-200 dark:border-gray-700",children:d.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center space-y-4 lg:space-y-0 lg:space-x-4",children:[d.jsx("div",{className:"flex-1",children:d.jsxs("div",{className:"relative",children:[d.jsx(v,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),d.jsx("input",{type:"text",placeholder:"Search sessions and recordings...",value:F,onChange:e=>z(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),d.jsxs("div",{className:"flex space-x-4",children:[d.jsxs("select",{value:M,onChange:e=>D(e.target.value),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[d.jsx("option",{value:"all",children:"All Types"}),d.jsx("option",{value:"sessions",children:"Sessions Only"}),d.jsx("option",{value:"recordings",children:"Recordings Only"})]}),d.jsxs("select",{value:O,onChange:e=>T(e.target.value),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[d.jsx("option",{value:"all",children:"All Status"}),d.jsx("option",{value:"scheduled",children:"Scheduled"}),d.jsx("option",{value:"live",children:"Live"}),d.jsx("option",{value:"completed",children:"Completed"}),d.jsx("option",{value:"recorded",children:"Recorded"}),d.jsx("option",{value:"available",children:"Available"})]})]})]})}),d.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:ee.map(e=>{const t=(e=>e.meetLink?"session":"recording")(e),a="session"===t,i="recording"===t;(e=>{switch(e){case"scheduled":return N;case"live":return C;case"completed":case"available":return A;case"recorded":return E;default:;}})(e.status);const l="live"===e.status,m="scheduled"===e.status,x=e.recordingUrl||e.isRecorded,p=e.isPublished,f=(e=>"recordings"===e.collection&&e.meetLink)(e);return d.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden hover:shadow-xl transition-all duration-300",children:[d.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[d.jsx("div",{className:"flex items-start justify-between mb-3",children:d.jsxs("div",{className:"flex-1",children:[d.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[a&&d.jsx(N,{className:"h-4 w-4 text-blue-500"}),i&&d.jsx(k,{className:"h-4 w-4 text-purple-500"}),d.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${Z(e.status)}`,children:[a?"Session":"Recording"," â€¢ ",e.status]}),!p&&d.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300",children:"Draft"}),a&&f&&d.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-300",children:"From Recordings"})]}),d.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white text-lg line-clamp-2",children:e.title||e.topic}),d.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm mt-1 line-clamp-2",children:e.description})]})}),d.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500 dark:text-gray-400",children:[d.jsxs("span",{className:"flex items-center",children:[d.jsx(S,{className:"h-4 w-4 mr-1"}),e.instructorName||"Unknown"]}),e.scheduledTime&&d.jsxs("span",{className:"flex items-center",children:[d.jsx(N,{className:"h-4 w-4 mr-1"}),new Date(e.scheduledTime).toLocaleDateString()]})]})]}),d.jsxs("div",{className:"p-6",children:[d.jsxs("div",{className:"space-y-3",children:[e.scheduledTime&&d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Time"}),d.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:new Date(e.scheduledTime).toLocaleTimeString()})]}),e.duration&&d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Duration"}),d.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[e.duration," min"]})]}),d.jsxs("div",{className:"flex items-center justify-between",children:[d.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Recording"}),d.jsx("span",{className:"text-sm font-medium "+(x?"text-green-600 dark:text-green-400":"text-gray-500 dark:text-gray-400"),children:x?"Available":"Not available"})]})]}),d.jsxs("div",{className:"flex flex-wrap gap-2 mt-6",children:[a&&l&&d.jsxs(h,{onClick:()=>Q(e),className:"flex-1 bg-red-600 hover:bg-red-700 text-white",children:[d.jsx(C,{className:"h-4 w-4 mr-2"}),"Join Live"]}),a&&m&&d.jsxs(h,{onClick:()=>Q(e),variant:"outline",className:"flex-1",children:[d.jsx(N,{className:"h-4 w-4 mr-2"}),"Join"]}),a&&!x&&"completed"===e.status&&d.jsxs(h,{onClick:()=>(async(e,t=!1)=>{const a=prompt("Enter Google Drive recording URL:");if(a)try{let i;if(V(s=>o(n({},s),{[e]:!0})),i=t?r.find(s=>s.id===e&&s.meetLink):s.find(s=>s.id===e),!i)throw new Error("Session not found");t?await g.updateRecording(e,{recordingUrl:a,isRecorded:!0,recordingStatus:"available",status:"completed"}):await u.markAsRecorded(e,a),await g.createRecording({title:`${i.title} - Recording`,description:`Recording of ${i.title}`,recordingUrl:a,duration:i.duration||60,fileSize:250,quality:"1080p",courseId:i.courseId,instructorId:i.instructorId,instructorEmail:i.instructorEmail,instructorName:i.instructorName,visibility:i.visibility||"public",category:i.category||"general",status:"recorded",recordingStatus:"available",isPublished:!0}),await K()}catch(i){alert("Failed to add recording: "+i.message)}finally{V(s=>o(n({},s),{[e]:!1}))}})(e.id,f),disabled:J[e.id],className:"flex-1 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600",children:[J[e.id]?d.jsx(c,{size:"sm",className:"mr-2"}):d.jsx(k,{className:"h-4 w-4 mr-2"}),"Add Recording"]}),x&&d.jsx("a",{href:e.recordingUrl,target:"_blank",rel:"noopener noreferrer",className:"flex-1",children:d.jsxs(h,{variant:"outline",className:"w-full",children:[d.jsx(R,{className:"h-4 w-4 mr-2"}),"View Recording"]})}),a&&d.jsxs(d.Fragment,{children:[m&&d.jsx(h,{onClick:()=>(async(e,s=!1)=>{try{if(V(s=>o(n({},s),{[e]:!0})),s)await g.updateRecording(e,{status:"live"});else if(await u.getSessionById(e))await u.updateSessionStatus(e,"live");else{const s=await g.getRecordingById(e);if(!s||!s.meetLink)throw new Error("Session not found in any collection");await g.updateRecording(e,{status:"live"})}await K()}catch(t){alert("Failed to start session: "+t.message)}finally{V(s=>o(n({},s),{[e]:!1}))}})(e.id,f),variant:"outline",size:"sm",children:"Start"}),l&&d.jsx(h,{onClick:()=>(async(e,s=!1)=>{try{if(V(s=>o(n({},s),{[e]:!0})),s)await g.updateRecording(e,{status:"completed"});else if(await u.getSessionById(e))await u.updateSessionStatus(e,"completed");else{const s=await g.getRecordingById(e);if(!s||!s.meetLink)throw new Error("Session not found in any collection");await g.updateRecording(e,{status:"completed"})}await K()}catch(t){alert("Failed to end session: "+t.message)}finally{V(s=>o(n({},s),{[e]:!1}))}})(e.id,f),variant:"outline",size:"sm",children:"End"}),p?d.jsx(h,{onClick:()=>(async(e,s=!1)=>{try{if(V(s=>o(n({},s),{[e]:!0})),s)await g.updateRecording(e,{isPublished:!1});else if(await u.getSessionById(e))await u.updateSession(e,{isPublished:!1});else{const s=await g.getRecordingById(e);if(!s||!s.meetLink)throw new Error("Session not found in any collection");await g.updateRecording(e,{isPublished:!1})}await K()}catch(t){alert("Failed to unpublish session: "+t.message)}finally{V(s=>o(n({},s),{[e]:!1}))}})(e.id,f),variant:"outline",size:"sm",children:"Unpublish"}):d.jsx(h,{onClick:()=>(async(e,s=!1)=>{try{if(V(s=>o(n({},s),{[e]:!0})),s)await g.updateRecording(e,{isPublished:!0});else if(await u.getSessionById(e))await u.updateSession(e,{isPublished:!0});else{const s=await g.getRecordingById(e);if(!s||!s.meetLink)throw new Error("Session not found in any collection");await g.updateRecording(e,{isPublished:!0})}await K()}catch(t){alert("Failed to publish session: "+t.message)}finally{V(s=>o(n({},s),{[e]:!1}))}})(e.id,f),variant:"outline",size:"sm",children:"Publish"})]}),a&&f&&d.jsxs(h,{onClick:()=>W(e.id),disabled:J[e.id],variant:"outline",size:"sm",className:"text-orange-600 hover:text-orange-700 hover:bg-orange-50 dark:hover:bg-orange-900/20",children:[J[e.id]?d.jsx(c,{size:"sm",className:"mr-1"}):d.jsx(w,{className:"h-4 w-4 mr-1"}),"Migrate"]}),d.jsx(h,{onClick:()=>a?(H(e),void $(!0)):(H(e),void G(!0)),variant:"outline",size:"sm",children:d.jsx(L,{className:"h-4 w-4"})}),d.jsx(h,{onClick:()=>a?(async(e,s=!1)=>{if(window.confirm("Are you sure you want to delete this session?"))try{V(s=>o(n({},s),{[e]:!0})),s?await g.deleteRecording(e):await u.deleteSession(e),await K()}catch(t){alert("Failed to delete session: "+t.message)}finally{V(s=>o(n({},s),{[e]:!1}))}})(e.id,f):(async e=>{if(window.confirm("Are you sure you want to delete this recording?"))try{V(s=>o(n({},s),{[e]:!0})),await g.deleteRecording(e),await K()}catch(s){alert("Failed to delete recording: "+s.message)}finally{V(s=>o(n({},s),{[e]:!1}))}})(e.id),variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20",children:d.jsx(P,{className:"h-4 w-4"})})]})]})]},e.id)})}),0===ee.length&&d.jsxs("div",{className:"text-center py-12",children:[d.jsx(k,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),d.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"No sessions or recordings found"}),d.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:F||"all"!==O||"all"!==M?"Try adjusting your search or filters":"Get started by scheduling your first session or adding a recording"}),d.jsxs("div",{className:"flex justify-center space-x-3",children:[d.jsxs(h,{onClick:()=>G(!0),variant:"outline",className:"bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white",children:[d.jsx(y,{className:"h-4 w-4 mr-2"}),"Add Recording"]}),d.jsxs(h,{onClick:()=>$(!0),className:"bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600",children:[d.jsx(j,{className:"h-4 w-4 mr-2"}),"Schedule Session"]})]})]}),U&&d.jsx(p,{onClose:()=>$(!1),onSuccess:()=>{$(!1),K()},session:_}),q&&d.jsx(f,{onClose:()=>G(!1),onSuccess:()=>{G(!1),K()},recording:_})]})};export{B as default};
