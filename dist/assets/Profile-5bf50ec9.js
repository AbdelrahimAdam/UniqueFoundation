var e=Object.defineProperty,s=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,o=(s,a,r)=>a in s?e(s,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[a]=r,i=(e,s)=>{for(var a in s||(s={}))t.call(s,a)&&o(e,a,s[a]);if(r)for(var a of r(s))l.call(s,a)&&o(e,a,s[a]);return e},d=(e,r)=>s(e,a(r));import{u as n,d as c,j as m}from"./index-c63f14c2.js";import{r as u}from"./vendor-c3615fdd.js";import{A as x,B as p,D as g,G as b,W as h,X as f,Y as w}from"./firebase-9a5fb30d.js";import{B as j}from"./Button-4635154f.js";import{I as y}from"./Input-fbeac968.js";import{u as v}from"./useTranslation-89f0f982.js";import{a2 as N,d as k,a3 as P,a4 as C,a1 as z,b as S,B as L,a0 as U,S as I,C as q,x as $,$ as A,T,U as E,M as R,a5 as O,a6 as M,L as D,E as F,a as B,a7 as G}from"./ui-e3d8d230.js";import"./router-4adec120.js";import"./utils-5b9d0682.js";const H=()=>{var e;const{t:s}=v(),{user:a,userProfile:r,updateProfile:t,userRole:l}=n(),[o,H]=u.useState(!1),[W,J]=u.useState(!1),[Q,X]=u.useState(!1),[Y,K]=u.useState({}),[V,Z]=u.useState("profile"),[_,ee]=u.useState(!1),[se,ae]=u.useState(!1),[re,te]=u.useState(!1),[le,oe]=u.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[ie,de]=u.useState(""),[ne,ce]=u.useState(""),[me,ue]=u.useState(!1),[xe,pe]=u.useState({firstName:"",lastName:"",phone:"",address:"",bio:"",department:"",gradeLevel:"",subjects:"",qualifications:""});u.useEffect(()=>{r&&pe({firstName:r.firstName||"",lastName:r.lastName||"",phone:r.phone||"",address:r.address||"",bio:r.bio||"",department:r.department||"",gradeLevel:r.gradeLevel||"",subjects:r.subjects||"",qualifications:r.qualifications||""}),ge()},[r,l]);const ge=async()=>{if(a)try{let e={};switch(l){case"admin":const s=await x(g(c,"users")),r=await x(g(c,"courses")),t=await x(p(g(c,"users"),b("role","==","teacher")));e={totalUsers:s.size,activeCourses:r.size,teachers:t.size,systemHealth:"98%"};break;case"teacher":const l=await x(p(g(c,"courses"),b("teacherId","==",a.uid))),o=await x(p(g(c,"sessions"),b("teacherId","==",a.uid))),i=await x(p(g(c,"users"),b("role","==","student")));e={totalCourses:l.size,sessions:o.size,students:i.size,rating:"4.8/5"};break;case"student":const d=await x(p(g(c,"enrollments"),b("studentId","==",a.uid))),n=await x(p(g(c,"progress"),b("studentId","==",a.uid),b("completed","==",!0))),m=await x(p(g(c,"sessions"),b("students","array-contains",a.uid)));e={enrolledCourses:d.size,completedLessons:n.size,upcomingSessions:m.size,progress:"75%"};break;default:e={}}K(e)}catch(e){}},be=e=>{const{name:s,value:a}=e.target;pe(e=>d(i({},e),{[s]:a}))},he=e=>{const{name:s,value:a}=e.target;oe(e=>d(i({},e),{[s]:a})),ie&&de(""),ne&&ce("")},fe=async()=>{J(!0);try{await t(xe),H(!1)}catch(e){}finally{J(!1)}},we=async()=>{if(de(""),ce(""),le.currentPassword&&le.newPassword&&le.confirmPassword)if(le.newPassword.length<6)de(s("profile.passwordMinLength","Password must be at least 6 characters long"));else if(le.newPassword===le.confirmPassword)if(le.newPassword!==le.currentPassword){ue(!0);try{const e=h.credential(a.email,le.currentPassword);await f(a,e),await w(a,le.newPassword),ce(s("profile.passwordChanged","Password changed successfully!")),oe({currentPassword:"",newPassword:"",confirmPassword:""})}catch(e){switch(e.code){case"auth/wrong-password":de(s("profile.incorrectPassword","Current password is incorrect"));break;case"auth/weak-password":de(s("profile.weakPassword","Password is too weak. Please use a stronger password."));break;case"auth/requires-recent-login":de(s("profile.recentLoginRequired","Please log in again to change your password"));break;default:de(s("profile.passwordChangeFailed","Failed to change password. Please try again."))}}finally{ue(!1)}}else de(s("profile.samePassword","New password must be different from current password"));else de(s("profile.passwordsDontMatch","New passwords do not match"));else de(s("profile.fillAllFields","Please fill in all fields"))},je=(()=>{const e={admin:{icon:z,color:"purple",badge:s("admin.administrator","Administrator"),stats:[{label:s("admin.totalUsers","Total Users"),value:Y.totalUsers||"0",icon:S,color:"text-blue-600"},{label:s("admin.activeCourses","Active Courses"),value:Y.activeCourses||"0",icon:L,color:"text-green-600"},{label:s("admin.teachers","Teachers"),value:Y.teachers||"0",icon:U,color:"text-purple-600"},{label:s("admin.systemHealth","System Health"),value:Y.systemHealth||"100%",icon:I,color:"text-green-600"}]},teacher:{icon:U,color:"blue",badge:s("teacher.teacher","Teacher"),stats:[{label:s("teacher.totalCourses","Total Courses"),value:Y.totalCourses||"0",icon:L,color:"text-blue-600"},{label:s("teacher.sessions","Sessions"),value:Y.sessions||"0",icon:q,color:"text-green-600"},{label:s("teacher.students","Students"),value:Y.students||"0",icon:S,color:"text-purple-600"},{label:s("teacher.rating","Rating"),value:Y.rating||"0/5",icon:$,color:"text-yellow-600"}]},student:{icon:A,color:"green",badge:s("student.student","Student"),stats:[{label:s("student.enrolledCourses","Enrolled Courses"),value:Y.enrolledCourses||"0",icon:L,color:"text-blue-600"},{label:s("student.completedLessons","Completed Lessons"),value:Y.completedLessons||"0",icon:$,color:"text-green-600"},{label:s("student.upcomingSessions","Upcoming Sessions"),value:Y.upcomingSessions||"0",icon:q,color:"text-purple-600"},{label:s("student.progress","Overall Progress"),value:Y.progress||"0%",icon:T,color:"text-green-600"}]}};return e[l]||e.student})(),ye=je.icon;return m.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[m.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6",children:[m.jsxs("div",{className:"flex items-center justify-between mb-6",children:[m.jsxs("div",{children:[m.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:s("profile.title","My Profile")}),m.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:s("profile.description","Manage your profile and account settings")})]}),m.jsx("div",{className:"flex items-center space-x-4",children:m.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-${je.color}-100 text-${je.color}-800 dark:bg-${je.color}-900 dark:text-${je.color}-200`,children:[m.jsx(ye,{className:"w-4 h-4 mr-1"}),je.badge]})})]}),m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:je.stats.map((e,s)=>{const a=e.icon;return m.jsx("div",{className:"bg-gradient-to-br from-white to-gray-50 dark:from-gray-700 dark:to-gray-800 p-6 rounded-xl border border-gray-200 dark:border-gray-600",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:e.label}),m.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-2",children:e.value})]}),m.jsx(a,{className:`w-8 h-8 ${e.color}`})]})},s)})}),m.jsx("div",{className:"border-b border-gray-200 dark:border-gray-700",children:m.jsxs("nav",{className:"-mb-px flex space-x-8",children:[m.jsx("button",{onClick:()=>Z("profile"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("profile"===V?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:s("profile.profile","Profile")}),m.jsx("button",{onClick:()=>Z("password"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("password"===V?"border-blue-500 text-blue-600 dark:text-blue-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"),children:s("profile.password","Password")})]})})]}),m.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[m.jsx("div",{className:"lg:col-span-1",children:m.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 sticky top-6",children:[m.jsxs("div",{className:"flex flex-col items-center",children:[m.jsxs("div",{className:"relative",children:[m.jsxs("div",{className:"w-32 h-32 rounded-full border-4 border-white dark:border-gray-700 shadow-lg overflow-hidden",children:[(()=>{const e=(null==r?void 0:r.photoURL)||(null==a?void 0:a.photoURL);return e?m.jsx("img",{src:e,alt:"Profile",className:"w-32 h-32 rounded-full object-cover border-4 border-white dark:border-gray-700 shadow-lg",onError:e=>{e.target.style.display="none",e.target.nextSibling.style.display="flex"}}):null})(),m.jsx("div",{className:`w-full h-full bg-gradient-to-br ${(()=>{switch(l){case"admin":return"from-purple-500 to-violet-600";case"teacher":return"from-blue-500 to-cyan-600";case"student":return"from-green-500 to-emerald-600";default:return"from-gray-500 to-gray-600"}})()} flex items-center justify-center text-white text-2xl font-bold ${(null==r?void 0:r.photoURL)||(null==a?void 0:a.photoURL)?"hidden":"flex"}`,children:(null==r?void 0:r.firstName)&&(null==r?void 0:r.lastName)?`${r.firstName.charAt(0)}${r.lastName.charAt(0)}`.toUpperCase():(null==a?void 0:a.email)?a.email.charAt(0).toUpperCase():"U"})]}),o&&"profile"===V&&m.jsxs("label",{className:"absolute bottom-2 right-2 bg-blue-600 p-2 rounded-full cursor-pointer shadow-lg hover:bg-blue-700 transition-colors",children:[Q?m.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):m.jsx(N,{size:16,className:"text-white"}),m.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:async e=>{const s=e.target.files[0];if(!s)return;if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(s.type))return void alert("Please select a valid image file (JPEG, PNG, GIF, WebP)");if(s.size>1048576)return void alert("Image size should be less than 1MB for quick upload");X(!0);const a=new FileReader;a.onload=async e=>{try{const s=e.target.result;await t({photoURL:s,photoURLType:"base64"}),alert("Profile picture updated successfully!")}catch(s){alert("Failed to update profile picture. Please try again.")}finally{X(!1)}},a.onerror=()=>{alert("Error reading file. Please try again."),X(!1)},a.readAsDataURL(s)},disabled:Q})]})]}),m.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mt-4 text-center",children:[null==r?void 0:r.firstName," ",null==r?void 0:r.lastName]}),m.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-center",children:null==a?void 0:a.email}),m.jsx("div",{className:"mt-4 text-center",children:m.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-${je.color}-100 text-${je.color}-800 dark:bg-${je.color}-900 dark:text-${je.color}-200`,children:[m.jsx(ye,{className:"w-4 h-4 mr-1"}),je.badge]})})]}),m.jsxs("div",{className:"mt-6 space-y-4",children:[m.jsxs("div",{className:"flex items-center text-gray-600 dark:text-gray-400",children:[m.jsx(k,{size:18,className:"mr-3"}),m.jsxs("span",{className:"text-sm",children:[s("profile.memberSince","Member since"),": ",(null==(e=null==a?void 0:a.metadata)?void 0:e.creationTime)?new Date(a.metadata.creationTime).toLocaleDateString():"N/A"]})]}),m.jsxs("div",{className:"flex items-center text-gray-600 dark:text-gray-400",children:[m.jsx(P,{size:18,className:"mr-3"}),m.jsx("span",{className:"text-sm",children:xe.address||s("profile.noAddress","No address provided")})]}),m.jsxs("div",{className:"flex items-center text-gray-600 dark:text-gray-400",children:[m.jsx(C,{size:18,className:"mr-3"}),m.jsx("span",{className:"text-sm",children:xe.phone||s("profile.noPhone","No phone provided")})]})]})]})}),m.jsxs("div",{className:"lg:col-span-3",children:["profile"===V&&m.jsx("div",{className:"space-y-6",children:m.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6",children:[m.jsxs("div",{className:"flex items-center justify-between mb-6",children:[m.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:s("profile.personalInfo","Personal Information")}),!o&&m.jsx(j,{variant:"outline",onClick:()=>H(!0),children:s("profile.edit","Edit Profile")})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[m.jsx(y,{label:s("profile.firstName","First Name"),name:"firstName",value:xe.firstName,onChange:be,disabled:!o,icon:m.jsx(E,{size:18,className:"text-gray-400"})}),m.jsx(y,{label:s("profile.lastName","Last Name"),name:"lastName",value:xe.lastName,onChange:be,disabled:!o})]}),m.jsx(y,{label:s("profile.email","Email Address"),name:"email",value:(null==a?void 0:a.email)||"",disabled:!0,icon:m.jsx(R,{size:18,className:"text-gray-400"})}),m.jsx(y,{label:s("profile.phone","Phone Number"),name:"phone",value:xe.phone,onChange:be,disabled:!o,icon:m.jsx(C,{size:18,className:"text-gray-400"})}),("admin"===l||"teacher"===l)&&m.jsx(y,{label:s("profile.department","Department"),name:"department",value:xe.department,onChange:be,disabled:!o,icon:m.jsx(O,{size:18,className:"text-gray-400"})}),"student"===l&&m.jsx(y,{label:s("profile.gradeLevel","Grade Level"),name:"gradeLevel",value:xe.gradeLevel,onChange:be,disabled:!o,icon:m.jsx(A,{size:18,className:"text-gray-400"})}),"teacher"===l&&m.jsx(y,{label:s("profile.subjects","Subjects"),name:"subjects",value:xe.subjects,onChange:be,disabled:!o,placeholder:s("profile.subjectsPlaceholder","Math, Science, English..."),icon:m.jsx(L,{size:18,className:"text-gray-400"})}),"teacher"===l&&m.jsx(y,{label:s("profile.qualifications","Qualifications"),name:"qualifications",value:xe.qualifications,onChange:be,disabled:!o,placeholder:s("profile.qualificationsPlaceholder","M.Ed, PhD, Teaching Certificate..."),icon:m.jsx($,{size:18,className:"text-gray-400"})}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:s("profile.bio","Bio")}),m.jsx("textarea",{name:"bio",value:xe.bio,onChange:be,disabled:!o,rows:4,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white disabled:bg-gray-100 dark:disabled:bg-gray-600 disabled:cursor-not-allowed",placeholder:s("profile.bioPlaceholder","Tell us about yourself...")})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:s("profile.address","Address")}),m.jsx("textarea",{name:"address",value:xe.address,onChange:be,disabled:!o,rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white disabled:bg-gray-100 dark:disabled:bg-gray-600 disabled:cursor-not-allowed",placeholder:s("profile.addressPlaceholder","Enter your address...")})]}),o&&m.jsxs("div",{className:"flex space-x-4 pt-4",children:[m.jsxs(j,{onClick:fe,loading:W,className:"flex items-center",children:[m.jsx(M,{size:18,className:"mr-2"}),s("profile.save","Save Changes")]}),m.jsx(j,{variant:"outline",onClick:()=>{H(!1),pe({firstName:(null==r?void 0:r.firstName)||"",lastName:(null==r?void 0:r.lastName)||"",phone:(null==r?void 0:r.phone)||"",address:(null==r?void 0:r.address)||"",bio:(null==r?void 0:r.bio)||"",department:(null==r?void 0:r.department)||"",gradeLevel:(null==r?void 0:r.gradeLevel)||"",subjects:(null==r?void 0:r.subjects)||"",qualifications:(null==r?void 0:r.qualifications)||""})},children:s("profile.cancel","Cancel")})]})]})]})}),"password"===V&&m.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6",children:[m.jsxs("div",{className:"mb-6",children:[m.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:s("profile.changePassword","Change Password")}),m.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:s("profile.passwordSecurity","Update your password to keep your account secure")})]}),ie&&m.jsx("div",{className:"mb-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:m.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:ie})}),ne&&m.jsx("div",{className:"mb-4 p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:m.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:ne})}),m.jsxs("div",{className:"space-y-4 max-w-md",children:[m.jsx(y,{label:s("profile.currentPassword","Current Password"),name:"currentPassword",type:_?"text":"password",value:le.currentPassword,onChange:he,icon:m.jsx(D,{size:18,className:"text-gray-400"}),trailingIcon:m.jsx("button",{type:"button",onClick:()=>ee(!_),className:"text-gray-400 hover:text-gray-600",children:_?m.jsx(F,{size:18}):m.jsx(B,{size:18})})}),m.jsx(y,{label:s("profile.newPassword","New Password"),name:"newPassword",type:se?"text":"password",value:le.newPassword,onChange:he,icon:m.jsx(G,{size:18,className:"text-gray-400"}),trailingIcon:m.jsx("button",{type:"button",onClick:()=>ae(!se),className:"text-gray-400 hover:text-gray-600",children:se?m.jsx(F,{size:18}):m.jsx(B,{size:18})})}),m.jsx(y,{label:s("profile.confirmPassword","Confirm New Password"),name:"confirmPassword",type:re?"text":"password",value:le.confirmPassword,onChange:he,icon:m.jsx(G,{size:18,className:"text-gray-400"}),trailingIcon:m.jsx("button",{type:"button",onClick:()=>te(!re),className:"text-gray-400 hover:text-gray-600",children:re?m.jsx(F,{size:18}):m.jsx(B,{size:18})})}),m.jsx("div",{className:"pt-4",children:m.jsxs(j,{onClick:we,loading:me,className:"flex items-center",children:[m.jsx(G,{size:18,className:"mr-2"}),s("profile.updatePassword","Update Password")]})}),m.jsxs("div",{className:"mt-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[m.jsx("h3",{className:"text-sm font-medium text-blue-800 dark:text-blue-300 mb-2",children:s("profile.passwordTips","Password Tips")}),m.jsxs("ul",{className:"text-xs text-blue-700 dark:text-blue-400 space-y-1",children:[m.jsxs("li",{children:["• ",s("profile.minLength","Use at least 6 characters")]}),m.jsxs("li",{children:["• ",s("profile.includeNumbers","Include numbers and symbols")]}),m.jsxs("li",{children:["• ",s("profile.avoidCommon","Avoid common words and patterns")]}),m.jsxs("li",{children:["• ",s("profile.uniquePassword","Use a unique password for this account")]})]})]})]})]})]})]})]})};export{H as default};
