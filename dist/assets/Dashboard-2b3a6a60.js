import{a as e,b as t,n as r,i as s,c as a,t as i,f as n,r as l,g as o,s as c,e as d,h as u,S as h,k as m,l as g,m as x,o as p,p as f,j as b,L as v,u as y}from"./index-5767ddf8.js";import{c as j,r as w}from"./vendor-0a74ad82.js";import{s as N}from"./utils-db1934d6.js";import{u as k}from"./userService-5dcc377d.js";import{s as R}from"./sessionService-6e8a4b4a.js";import{r as S}from"./recordingService-a3f82448.js";import{c as C}from"./courseService-495bf198.js";import{B as P}from"./Button-3bd6c448.js";import{I as T}from"./Input-381357a3.js";import{C as O}from"./check-circle-0b4512e8.js";import{S as E}from"./star-fde52966.js";import{U as I}from"./user-88eaccbf.js";import{E as Q}from"./eye-b2ee8344.js";import{C as F}from"./clock-7df3ab35.js";import{P as L}from"./play-circle-c1f21b6b.js";import{u as U}from"./useTranslation-aa9b7537.js";import{B as A}from"./book-open-cf5b879f.js";import{V as M}from"./video-9bd5ab91.js";import{U as $}from"./users-499efd4b.js";import{T as D}from"./trending-up-3b4b82f0.js";import{C as B}from"./crown-d8e01332.js";import{R as W}from"./refresh-cw-c53519ba.js";import{A as z}from"./alert-circle-b175e642.js";import{C as q}from"./calendar-db1a81dc.js";import{S as Y}from"./search-574a4b7f.js";import{F as J}from"./filter-5c97562b.js";import{X as V}from"./x-circle-bf91ba73.js";import"./router-80e9042b.js";import"./firebase-383b8577.js";var K=function(h){function m(e,t){var r;return(r=h.call(this)||this).client=e,r.options=t,r.trackedProps=[],r.selectError=null,r.bindMethods(),r.setOptions(t),r}e(m,h);var g=m.prototype;return g.bindMethods=function(){this.remove=this.remove.bind(this),this.refetch=this.refetch.bind(this)},g.onSubscribe=function(){1===this.listeners.length&&(this.currentQuery.addObserver(this),_(this.currentQuery,this.options)&&this.executeFetch(),this.updateTimers())},g.onUnsubscribe=function(){this.listeners.length||this.destroy()},g.shouldFetchOnReconnect=function(){return X(this.currentQuery,this.options,this.options.refetchOnReconnect)},g.shouldFetchOnWindowFocus=function(){return X(this.currentQuery,this.options,this.options.refetchOnWindowFocus)},g.destroy=function(){this.listeners=[],this.clearTimers(),this.currentQuery.removeObserver(this)},g.setOptions=function(e,t){var r=this.options,s=this.currentQuery;if(this.options=this.client.defaultQueryObserverOptions(e),void 0!==this.options.enabled&&"boolean"!=typeof this.options.enabled)throw new Error("Expected enabled to be a boolean");this.options.queryKey||(this.options.queryKey=r.queryKey),this.updateQuery();var a=this.hasListeners();a&&G(this.currentQuery,s,this.options,r)&&this.executeFetch(),this.updateResult(t),!a||this.currentQuery===s&&this.options.enabled===r.enabled&&this.options.staleTime===r.staleTime||this.updateStaleTimeout();var i=this.computeRefetchInterval();!a||this.currentQuery===s&&this.options.enabled===r.enabled&&i===this.currentRefetchInterval||this.updateRefetchInterval(i)},g.getOptimisticResult=function(e){var t=this.client.defaultQueryObserverOptions(e),r=this.client.getQueryCache().build(this.client,t);return this.createResult(r,t)},g.getCurrentResult=function(){return this.currentResult},g.trackResult=function(e,t){var r=this,s={},a=function(e){r.trackedProps.includes(e)||r.trackedProps.push(e)};return Object.keys(e).forEach(function(t){Object.defineProperty(s,t,{configurable:!1,enumerable:!0,get:function(){return a(t),e[t]}})}),(t.useErrorBoundary||t.suspense)&&a("error"),s},g.getNextResult=function(e){var t=this;return new Promise(function(r,s){var a=t.subscribe(function(t){t.isFetching||(a(),t.isError&&(null==e?void 0:e.throwOnError)?s(t.error):r(t))})})},g.getCurrentQuery=function(){return this.currentQuery},g.remove=function(){this.client.getQueryCache().remove(this.currentQuery)},g.refetch=function(e){return this.fetch(t({},e,{meta:{refetchPage:null==e?void 0:e.refetchPage}}))},g.fetchOptimistic=function(e){var t=this,r=this.client.defaultQueryObserverOptions(e),s=this.client.getQueryCache().build(this.client,r);return s.fetch().then(function(){return t.createResult(s,r)})},g.fetch=function(e){var t=this;return this.executeFetch(e).then(function(){return t.updateResult(),t.currentResult})},g.executeFetch=function(e){this.updateQuery();var t=this.currentQuery.fetch(this.options,e);return(null==e?void 0:e.throwOnError)||(t=t.catch(r)),t},g.updateStaleTimeout=function(){var e=this;if(this.clearStaleTimeout(),!s&&!this.currentResult.isStale&&a(this.options.staleTime)){var t=i(this.currentResult.dataUpdatedAt,this.options.staleTime)+1;this.staleTimeoutId=setTimeout(function(){e.currentResult.isStale||e.updateResult()},t)}},g.computeRefetchInterval=function(){var e;return"function"==typeof this.options.refetchInterval?this.options.refetchInterval(this.currentResult.data,this.currentQuery):null!=(e=this.options.refetchInterval)&&e},g.updateRefetchInterval=function(e){var t=this;this.clearRefetchInterval(),this.currentRefetchInterval=e,!s&&!1!==this.options.enabled&&a(this.currentRefetchInterval)&&0!==this.currentRefetchInterval&&(this.refetchIntervalId=setInterval(function(){(t.options.refetchIntervalInBackground||n.isFocused())&&t.executeFetch()},this.currentRefetchInterval))},g.updateTimers=function(){this.updateStaleTimeout(),this.updateRefetchInterval(this.computeRefetchInterval())},g.clearTimers=function(){this.clearStaleTimeout(),this.clearRefetchInterval()},g.clearStaleTimeout=function(){this.staleTimeoutId&&(clearTimeout(this.staleTimeoutId),this.staleTimeoutId=void 0)},g.clearRefetchInterval=function(){this.refetchIntervalId&&(clearInterval(this.refetchIntervalId),this.refetchIntervalId=void 0)},g.createResult=function(e,t){var r,s=this.currentQuery,a=this.options,i=this.currentResult,n=this.currentResultState,c=this.currentResultOptions,d=e!==s,u=d?e.state:this.currentQueryInitialState,h=d?this.currentResult:this.previousQueryResult,m=e.state,g=m.dataUpdatedAt,x=m.error,p=m.errorUpdatedAt,f=m.isFetching,b=m.status,v=!1,y=!1;if(t.optimisticResults){var j=this.hasListeners(),w=!j&&_(e,t),N=j&&G(e,s,t,a);(w||N)&&(f=!0,g||(b="loading"))}if(t.keepPreviousData&&!m.dataUpdateCount&&(null==h?void 0:h.isSuccess)&&"error"!==b)r=h.data,g=h.dataUpdatedAt,b=h.status,v=!0;else if(t.select&&void 0!==m.data)if(i&&m.data===(null==n?void 0:n.data)&&t.select===this.selectFn)r=this.selectResult;else try{this.selectFn=t.select,r=t.select(m.data),!1!==t.structuralSharing&&(r=l(null==i?void 0:i.data,r)),this.selectResult=r,this.selectError=null}catch(R){o().error(R),this.selectError=R}else r=m.data;if(void 0!==t.placeholderData&&void 0===r&&("loading"===b||"idle"===b)){var k;if((null==i?void 0:i.isPlaceholderData)&&t.placeholderData===(null==c?void 0:c.placeholderData))k=i.data;else if(k="function"==typeof t.placeholderData?t.placeholderData():t.placeholderData,t.select&&void 0!==k)try{k=t.select(k),!1!==t.structuralSharing&&(k=l(null==i?void 0:i.data,k)),this.selectError=null}catch(R){o().error(R),this.selectError=R}void 0!==k&&(b="success",r=k,y=!0)}return this.selectError&&(x=this.selectError,r=this.selectResult,p=Date.now(),b="error"),{status:b,isLoading:"loading"===b,isSuccess:"success"===b,isError:"error"===b,isIdle:"idle"===b,data:r,dataUpdatedAt:g,error:x,errorUpdatedAt:p,failureCount:m.fetchFailureCount,errorUpdateCount:m.errorUpdateCount,isFetched:m.dataUpdateCount>0||m.errorUpdateCount>0,isFetchedAfterMount:m.dataUpdateCount>u.dataUpdateCount||m.errorUpdateCount>u.errorUpdateCount,isFetching:f,isRefetching:f&&"loading"!==b,isLoadingError:"error"===b&&0===m.dataUpdatedAt,isPlaceholderData:y,isPreviousData:v,isRefetchError:"error"===b&&0!==m.dataUpdatedAt,isStale:Z(e,t),refetch:this.refetch,remove:this.remove}},g.shouldNotifyListeners=function(e,t){if(!t)return!0;var r=this.options,s=r.notifyOnChangeProps,a=r.notifyOnChangePropsExclusions;if(!s&&!a)return!0;if("tracked"===s&&!this.trackedProps.length)return!0;var i="tracked"===s?this.trackedProps:s;return Object.keys(e).some(function(r){var s=r,n=e[s]!==t[s],l=null==i?void 0:i.some(function(e){return e===r}),o=null==a?void 0:a.some(function(e){return e===r});return n&&!o&&(!i||l)})},g.updateResult=function(e){var r=this.currentResult;if(this.currentResult=this.createResult(this.currentQuery,this.options),this.currentResultState=this.currentQuery.state,this.currentResultOptions=this.options,!c(this.currentResult,r)){var s={cache:!0};!1!==(null==e?void 0:e.listeners)&&this.shouldNotifyListeners(this.currentResult,r)&&(s.listeners=!0),this.notify(t({},s,e))}},g.updateQuery=function(){var e=this.client.getQueryCache().build(this.client,this.options);if(e!==this.currentQuery){var t=this.currentQuery;this.currentQuery=e,this.currentQueryInitialState=e.state,this.previousQueryResult=this.currentResult,this.hasListeners()&&(null==t||t.removeObserver(this),e.addObserver(this))}},g.onQueryUpdate=function(e){var t={};"success"===e.type?t.onSuccess=!0:"error"!==e.type||d(e.error)||(t.onError=!0),this.updateResult(t),this.hasListeners()&&this.updateTimers()},g.notify=function(e){var t=this;u.batch(function(){e.onSuccess?(null==t.options.onSuccess||t.options.onSuccess(t.currentResult.data),null==t.options.onSettled||t.options.onSettled(t.currentResult.data,null)):e.onError&&(null==t.options.onError||t.options.onError(t.currentResult.error),null==t.options.onSettled||t.options.onSettled(void 0,t.currentResult.error)),e.listeners&&t.listeners.forEach(function(e){e(t.currentResult)}),e.cache&&t.client.getQueryCache().notify({query:t.currentQuery,type:"observerResultsUpdated"})})},m}(h);function _(e,t){return function(e,t){return!(!1===t.enabled||e.state.dataUpdatedAt||"error"===e.state.status&&!1===t.retryOnMount)}(e,t)||e.state.dataUpdatedAt>0&&X(e,t,t.refetchOnMount)}function X(e,t,r){if(!1!==t.enabled){var s="function"==typeof r?r(e):r;return"always"===s||!1!==s&&Z(e,t)}return!1}function G(e,t,r,s){return!1!==r.enabled&&(e!==t||!1===s.enabled)&&(!r.suspense||"error"!==e.state.status)&&Z(e,r)}function Z(e,t){return e.isStaleByTime(t.staleTime)}var H=function(r){function s(e,t){return r.call(this,e,t)||this}e(s,r);var a=s.prototype;return a.bindMethods=function(){r.prototype.bindMethods.call(this),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)},a.setOptions=function(e,s){r.prototype.setOptions.call(this,t({},e,{behavior:m()}),s)},a.getOptimisticResult=function(e){return e.behavior=m(),r.prototype.getOptimisticResult.call(this,e)},a.fetchNextPage=function(e){var t;return this.fetch({cancelRefetch:null==(t=null==e?void 0:e.cancelRefetch)||t,throwOnError:null==e?void 0:e.throwOnError,meta:{fetchMore:{direction:"forward",pageParam:null==e?void 0:e.pageParam}}})},a.fetchPreviousPage=function(e){var t;return this.fetch({cancelRefetch:null==(t=null==e?void 0:e.cancelRefetch)||t,throwOnError:null==e?void 0:e.throwOnError,meta:{fetchMore:{direction:"backward",pageParam:null==e?void 0:e.pageParam}}})},a.createResult=function(e,s){var a,i,n,l,o,c,d=e.state,u=r.prototype.createResult.call(this,e,s);return t({},u,{fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:g(s,null==(a=d.data)?void 0:a.pages),hasPreviousPage:x(s,null==(i=d.data)?void 0:i.pages),isFetchingNextPage:d.isFetching&&"forward"===(null==(n=d.fetchMeta)||null==(l=n.fetchMore)?void 0:l.direction),isFetchingPreviousPage:d.isFetching&&"backward"===(null==(o=d.fetchMeta)||null==(c=o.fetchMore)?void 0:c.direction)})},s}(K);var ee,te=j.createContext((ee=!1,{clearReset:function(){ee=!1},reset:function(){ee=!0},isReset:function(){return ee}}));function re(e,t){var r=j.useRef(!1),s=j.useState(0)[1],a=p(),i=j.useContext(te),n=a.defaultQueryObserverOptions(e);n.optimisticResults=!0,n.onError&&(n.onError=u.batchCalls(n.onError)),n.onSuccess&&(n.onSuccess=u.batchCalls(n.onSuccess)),n.onSettled&&(n.onSettled=u.batchCalls(n.onSettled)),n.suspense&&("number"!=typeof n.staleTime&&(n.staleTime=1e3),0===n.cacheTime&&(n.cacheTime=1)),(n.suspense||n.useErrorBoundary)&&(i.isReset()||(n.retryOnMount=!1));var l=j.useState(function(){return new t(a,n)})[0],o=l.getOptimisticResult(n);if(j.useEffect(function(){r.current=!0,i.clearReset();var e=l.subscribe(u.batchCalls(function(){r.current&&s(function(e){return e+1})}));return l.updateResult(),function(){r.current=!1,e()}},[i,l]),j.useEffect(function(){l.setOptions(n,{listeners:!1})},[n,l]),n.suspense&&o.isLoading)throw l.fetchOptimistic(n).then(function(e){var t=e.data;null==n.onSuccess||n.onSuccess(t),null==n.onSettled||n.onSettled(t,null)}).catch(function(e){i.clearReset(),null==n.onError||n.onError(e),null==n.onSettled||n.onSettled(void 0,e)});if(o.isError&&!i.isReset()&&!o.isFetching&&N(n.suspense,n.useErrorBoundary,[o.error,l.getCurrentQuery()]))throw o.error;return"tracked"===n.notifyOnChangeProps&&(o=l.trackResult(o,n)),o}function se(e,t,r){return re(f(e,t,r),K)}const ae=[{value:"createdAt",label:"Date Added"},{value:"title",label:"Title"},{value:"duration",label:"Duration"},{value:"views",label:"Popularity"},{value:"rating",label:"Rating"}],ie=[{value:"all",label:"All Categories"},{value:"lecture",label:"Lectures"},{value:"tutorial",label:"Tutorials"},{value:"workshop",label:"Workshops"},{value:"qna",label:"Q&A Sessions"}],ne=[{value:"all",label:"All Status"},{value:"new",label:"New"},{value:"watched",label:"Watched"},{value:"completed",label:"Completed"},{value:"processing",label:"Processing"}],le=e=>{if(!e)return"0:00";const t=Math.floor(e/3600),r=Math.floor(e%3600/60),s=Math.floor(e%60);return t>0?`${t}:${r.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`:`${r}:${s.toString().padStart(2,"0")}`},oe=e=>{switch(e){case"completed":return"from-green-500 to-emerald-500";case"processing":return"from-yellow-500 to-orange-500";case"recording":return"from-blue-500 to-cyan-500";case"failed":return"from-red-500 to-pink-500";default:return"from-gray-500 to-gray-600"}},ce=e=>e>=90?"from-green-500 to-emerald-500":e>=50?"from-yellow-500 to-orange-500":"from-blue-500 to-cyan-500",de=j.memo(({recording:e,onWatch:t,actionLoading:r,getTeacherName:s,teachers:a})=>{const i=(e=>{switch(e){case"completed":return O;case"processing":return F;case"recording":return L;case"failed":return V;default:return M}})(e.status),n=e.progress||(e.watched?100:0),l=e.instructorName||s(e.instructorId);return b.jsx("div",{className:"group bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-3xl border border-white/30 dark:border-gray-700/40 p-6 shadow-2xl hover:shadow-2xl transition-all duration-300 hover:scale-105",children:b.jsxs("div",{className:"flex items-start justify-between",children:[b.jsxs("div",{className:"flex items-start space-x-4 flex-1 min-w-0",children:[b.jsx("div",{className:`p-3 rounded-2xl bg-gradient-to-br ${oe(e.status)}`,children:b.jsx(i,{className:"h-6 w-6 text-white"})}),b.jsxs("div",{className:"flex-1 min-w-0",children:[b.jsxs("div",{className:"flex items-start justify-between mb-2",children:[b.jsxs("h4",{className:"font-semibold text-gray-900 dark:text-white text-lg line-clamp-1 flex-1",children:[e.title,e.meetLink&&b.jsx("span",{className:"ml-2 px-2 py-1 text-xs bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300 rounded-full",children:"Google Meet"})]}),b.jsxs("div",{className:"flex items-center space-x-2 ml-3",children:[e.watched&&b.jsx(O,{className:"h-4 w-4 text-green-500"}),e.isFeatured&&b.jsx(E,{className:"h-4 w-4 text-yellow-500 fill-current"})]})]}),b.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm mb-3 line-clamp-2",children:e.description||"No description provided"}),b.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-600 dark:text-gray-400 mb-3",children:[l&&b.jsxs("span",{className:"flex items-center",children:[b.jsx(I,{className:"h-3 w-3 mr-1"}),l]}),e.category&&b.jsx("span",{className:"px-2 py-1 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300",children:e.category})]}),b.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-600 dark:text-gray-400",children:[b.jsxs("span",{className:"flex items-center",children:[b.jsx(Q,{className:"h-3 w-3 mr-1"}),e.views||0," views"]}),b.jsxs("span",{className:"flex items-center",children:[b.jsx(F,{className:"h-3 w-3 mr-1"}),le(e.duration)]}),e.averageRating>0&&b.jsxs("span",{className:"flex items-center",children:[b.jsx(E,{className:"h-3 w-3 mr-1 text-yellow-500 fill-current"}),e.averageRating.toFixed(1)]}),b.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium capitalize "+("completed"===e.status?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300":"processing"===e.status?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300":"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300"),children:e.status})]}),n>0&&n<100&&b.jsxs("div",{className:"mt-3",children:[b.jsxs("div",{className:"flex justify-between text-xs text-gray-600 dark:text-gray-400 mb-1",children:[b.jsx("span",{children:"Progress"}),b.jsxs("span",{children:[n,"%"]})]}),b.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:b.jsx("div",{className:`h-2 rounded-full bg-gradient-to-r ${ce(n)} transition-all duration-500`,style:{width:`${n}%`}})})]}),e.tags&&e.tags.length>0&&b.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[e.tags.slice(0,3).map((t,r)=>b.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300",children:t},`tag-${e.id}-${r}`)),e.tags.length>3&&b.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400",children:["+",e.tags.length-3," more"]})]})]})]}),b.jsx("div",{className:"flex space-x-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 ml-4",children:b.jsxs(P,{size:"sm",onClick:()=>t(e),disabled:r[e.id],className:"bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600",children:[r[e.id]?b.jsx(v,{size:"sm",className:"mr-1"}):b.jsx(L,{className:"h-3 w-3 mr-1"}),e.recordingUrl?.includes("drive.google.com")?"Watch on Drive":"Watch"]})})]})})}),ue=j.memo(({session:e,onJoin:t,getTeacherName:r,teachers:s,type:a="teacher"})=>{const i=(e=>{if(!e)return{date:"TBD",time:"",full:"TBD"};const t=new Date(e);return{date:t.toLocaleDateString(),time:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),full:t.toLocaleString()}})(e.scheduledTime),n=r(e.createdBy);return b.jsxs("div",{className:"flex items-center p-3 rounded-2xl bg-white/50 dark:bg-gray-700/50 backdrop-blur-lg border border-white/40 dark:border-gray-600/40 hover:bg-white/80 dark:hover:bg-gray-600/80 transition-all duration-200 group cursor-pointer",onClick:()=>t(e),children:[b.jsxs("div",{className:"flex-1 min-w-0",children:[b.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:e.topic||e.title||"Untitled Session"}),"teacher"===a&&b.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[b.jsx(I,{className:"h-3 w-3 text-gray-500"}),b.jsx("p",{className:"text-xs text-gray-700 dark:text-gray-300 truncate",children:n})]}),b.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[b.jsx(F,{className:"h-3 w-3 text-gray-500"}),b.jsxs("p",{className:"text-xs text-gray-700 dark:text-gray-300",children:[i.date," at ",i.time]})]})]}),b.jsxs("div",{className:"flex items-center space-x-2",children:[b.jsx("div",{className:"w-2 h-2 rounded-full animate-pulse "+("teacher"===a?"bg-green-500":"bg-red-500")}),b.jsx(L,{className:"h-4 w-4 text-green-500 opacity-0 group-hover:opacity-100 transition-opacity"})]})]})}),he=()=>{U();const{user:e,userProfile:t,loading:r}=y(),[s,a]=w.useState(""),[i,n]=w.useState("all"),[l,o]=w.useState("all"),[c,d]=w.useState("all"),[u,h]=w.useState("createdAt"),[m,g]=w.useState("desc"),[x,p]=w.useState({}),[j,N]=w.useState(!1),O=e?.uid,E=t?.isActive,I=t?.displayName||e?.email?.split("@")[0],{data:Q,isLoading:F}=se(["studentSessions",O],async()=>{const[e,t]=await Promise.all([R.getPublicSessions({status:"scheduled",dateRange:"upcoming",limit:10}),R.getTeacherSessionsForStudents({limit:20,daysAhead:30})]);return{recentSessions:e,teacherSessions:t}},{enabled:!!O&&E,staleTime:3e5,refetchOnWindowFocus:!1}),L=Q?.recentSessions||[],V=Q?.teacherSessions||[],{data:K,fetchNextPage:_,hasNextPage:X,isFetchingNextPage:G,isLoading:Z,error:ee,refetch:te,isRefetching:le}=re(f(["studentRecordings",O,u,m],({pageParam:e=null})=>S.getAvailableRecordings({studentId:O,cursor:e,limit:12,sortBy:u,sortOrder:m}),{getNextPageParam:e=>e.nextCursor||void 0,enabled:!!O&&E,retry:2,staleTime:3e5,refetchOnWindowFocus:!1}),H);const{data:oe=[],isLoading:ce,error:he}=se(["studentCourses",O],()=>C.getPublishedCourses(20),{enabled:!!O&&E,staleTime:6e5}),{data:me=[],isLoading:ge,error:xe}=se(["teachers"],()=>k.getAllUsers({role:"teacher",status:"active"}),{enabled:!!O&&E,select:e=>e.filter(e=>"teacher"===e.role&&e.isActive)}),pe=K?.pages.flatMap(e=>e.recordings||[])||[],fe=w.useMemo(()=>{if(!pe.length)return[];let e=pe;if(s){const t=s.toLowerCase();e=e.filter(e=>e.title?.toLowerCase().includes(t)||e.description?.toLowerCase().includes(t)||e.tags?.some(e=>e.toLowerCase().includes(t))||e.instructorName?.toLowerCase().includes(t))}return"all"!==i&&(e=e.filter(e=>e.status===i||"watched"===i&&e.watched||"new"===i&&!e.watched)),"all"!==l&&(e=e.filter(e=>e.category===l)),"all"!==c&&(e=e.filter(e=>e.instructorId===c)),e.sort((e,t)=>{let r=e[u]||0,s=t[u]||0;return"createdAt"!==u&&"updatedAt"!==u&&"scheduledTime"!==u||(r=new Date(r).getTime(),s=new Date(s).getTime()),"desc"===m?s-r:r-s})},[pe,s,i,l,c,u,m]),be=w.useMemo(()=>"all"===c?V:V.filter(e=>e.createdBy===c),[V,c]),ve=w.useMemo(()=>{const e=pe.filter(e=>e.watched).length,t=pe.length>0?Math.round(e/pe.length*100):0;return{enrolledClasses:oe.length,availableRecordings:pe.filter(e=>e.isPublished&&"completed"===e.status).length,teachers:me.length,totalWatchTime:pe.reduce((e,t)=>e+(t.duration||0),0),completedRecordings:e,upcomingSessions:L.length,teacherUpcomingSessions:be.length,googleMeetSessions:pe.filter(e=>e.meetLink).length,totalProgress:t}},[oe,pe,me,L,be]),ye=w.useCallback(e=>{const t=me.find(t=>t.uid===e);return t?.displayName||t?.email?.split("@")[0]||"Unknown Teacher"},[me]),je=w.useCallback(()=>{te()},[te]),we=w.useCallback(e=>{e.recordingUrl&&(p(t=>({...t,[e.id]:!0})),e.recordingUrl.includes("drive.google.com")&&window.open(e.recordingUrl,"_blank"),setTimeout(()=>{p(t=>({...t,[e.id]:!1}))},1e3))},[]),Ne=w.useCallback(e=>{(e.meetLink||e.googleMeetLink)&&window.open(e.meetLink||e.googleMeetLink,"_blank")},[]),ke=w.useMemo(()=>[{id:"enrolled-classes",name:"Enrolled Classes",value:ve.enrolledClasses.toString(),icon:A,change:`${oe.filter(e=>e.isPublished).length} active`,changeType:"positive",color:"from-blue-500 to-cyan-500",bgColor:"from-blue-500/10 to-cyan-500/10",description:"Your learning journey",loading:ce},{id:"available-recordings",name:"Available Recordings",value:ve.availableRecordings.toString(),icon:M,change:`${ve.completedRecordings} watched`,changeType:ve.completedRecordings>0?"positive":"neutral",color:"from-green-500 to-emerald-500",bgColor:"from-green-500/10 to-emerald-500/10",description:"Ready to watch",loading:Z},{id:"teachers",name:"Teachers",value:ve.teachers.toString(),icon:$,change:`${ve.teacherUpcomingSessions} upcoming`,changeType:"neutral",color:"from-purple-500 to-pink-500",bgColor:"from-purple-500/10 to-pink-500/10",description:"Expert instructors",loading:ge},{id:"learning-progress",name:"Learning Progress",value:`${ve.totalProgress}%`,icon:D,change:`${Math.round(ve.totalWatchTime/3600)} hours watched`,changeType:ve.totalProgress>50?"positive":"neutral",color:"from-orange-500 to-red-500",bgColor:"from-orange-500/10 to-red-500/10",description:"Your overall progress",loading:Z}],[ve,oe,ce,Z,ge]),Re=w.useMemo(()=>[{value:"all",label:"All Teachers"},...me.map(e=>({value:e.uid,label:e.displayName||e.email?.split("@")[0]||"Unknown Teacher"}))],[me]),Se=ee||he||xe;return r?b.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-50 via-white to-cyan-50 dark:from-gray-900 dark:via-gray-800 dark:to-blue-900",children:b.jsxs("div",{className:"text-center",children:[b.jsx(v,{size:"lg"}),b.jsx("p",{className:"mt-3 text-sm text-gray-500 dark:text-gray-400",children:"Loading your dashboard..."})]})}):O?E?b.jsxs("div",{className:"space-y-6 sm:space-y-8 p-4 sm:p-6 lg:p-8 bg-gradient-to-br from-blue-50 via-white to-cyan-50 dark:from-gray-900 dark:via-gray-800 dark:to-blue-900 min-h-screen",children:[b.jsx("div",{className:"text-center lg:text-left",children:b.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[b.jsxs("div",{children:[b.jsx("h1",{className:"text-3xl sm:text-4xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-cyan-600 bg-clip-text text-transparent mb-2 sm:mb-3",children:"Student Dashboard"}),b.jsx("p",{className:"text-base sm:text-lg text-gray-700 dark:text-gray-300 max-w-2xl",children:"Access your classes, recordings, and learning materials"}),I&&b.jsxs("div",{className:"flex items-center mt-2 space-x-2",children:[b.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Welcome back, ",b.jsx("span",{className:"font-semibold text-gray-800 dark:text-gray-200",children:I})]}),"premium"===t?.subscription?.plan&&b.jsxs("span",{className:"px-2 py-1 text-xs bg-gradient-to-r from-yellow-500 to-orange-500 text-white rounded-full flex items-center",children:[b.jsx(B,{className:"h-3 w-3 mr-1"}),"Premium Student"]})]})]}),b.jsxs("div",{className:"flex items-center gap-3",children:[b.jsxs(P,{onClick:je,variant:"outline",disabled:le,className:"hidden lg:flex items-center",children:[b.jsx(W,{className:"h-4 w-4 mr-2 "+(le?"animate-spin":"")}),"Refresh"]}),b.jsxs(P,{onClick:()=>window.location.href="/courses",className:"bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 shadow-lg",children:[b.jsx(A,{className:"h-4 w-4 mr-2"}),"Browse Classes"]})]})]})}),Se&&b.jsxs("div",{className:"bg-red-50/80 dark:bg-red-900/30 backdrop-blur-lg border border-red-200/50 dark:border-red-800/50 rounded-2xl p-4 flex items-center",children:[b.jsx(z,{className:"h-5 w-5 text-red-500 mr-3 flex-shrink-0"}),b.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm flex-1",children:"Failed to load content. Please try refreshing."}),b.jsx("button",{onClick:je,className:"ml-4 text-red-500 hover:text-red-700 flex-shrink-0",children:b.jsx(W,{className:"h-4 w-4"})})]}),b.jsx("div",{className:"grid grid-cols-1 gap-4 sm:gap-6 sm:grid-cols-2 xl:grid-cols-4",children:ke.map(e=>{const t=e.icon;return b.jsxs("div",{className:"group relative overflow-hidden rounded-3xl bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl border border-white/30 dark:border-gray-700/40 p-4 sm:p-6 shadow-2xl hover:shadow-2xl transition-all duration-500 hover:scale-105",children:[b.jsx("div",{className:`absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-500 bg-gradient-to-br ${e.bgColor} rounded-3xl`}),b.jsxs("div",{className:"relative z-10",children:[b.jsxs("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:[b.jsx("div",{className:`p-2 sm:p-3 rounded-2xl bg-gradient-to-br ${e.color} shadow-lg`,children:b.jsx(t,{className:"h-5 w-5 sm:h-6 sm:w-6 text-white"})}),b.jsxs("div",{className:"flex items-center space-x-1",children:["positive"===e.changeType&&b.jsx(D,{className:"h-4 w-4 text-green-500"}),b.jsx("div",{className:"text-xs sm:text-sm font-semibold "+("positive"===e.changeType?"text-green-600 dark:text-green-400":"text-gray-600 dark:text-gray-400"),children:e.change})]})]}),e.loading?b.jsxs("div",{className:"animate-pulse",children:[b.jsx("div",{className:"h-7 sm:h-8 bg-gray-300 dark:bg-gray-600 rounded mb-2"}),b.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded"})]}):b.jsxs(b.Fragment,{children:[b.jsx("h3",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white mb-1 sm:mb-2",children:e.value}),b.jsx("p",{className:"text-sm font-medium text-gray-800 dark:text-gray-200 mb-1",children:e.name}),b.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:e.description})]})]})]},e.id)})}),b.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-4 gap-6 sm:gap-8",children:[b.jsxs("div",{className:"xl:col-span-1 space-y-6",children:[b.jsxs("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-3xl border border-white/30 dark:border-gray-700/40 p-4 sm:p-6 shadow-2xl hover:shadow-2xl transition-all duration-300",children:[b.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[b.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"Teacher Sessions"}),b.jsx($,{className:"h-5 w-5 text-purple-500"})]}),b.jsxs("div",{className:"space-y-3",children:[be.length>0?be.slice(0,5).map(e=>b.jsx(ue,{session:e,onJoin:Ne,getTeacherName:ye,teachers:me,type:"teacher"},`teacher-session-${e.id}`)):b.jsxs("div",{className:"text-center py-4 text-gray-600 dark:text-gray-400",children:[b.jsx($,{className:"mx-auto h-8 w-8 mb-2"}),b.jsx("p",{className:"text-sm",children:"No teacher sessions"}),b.jsx("p",{className:"text-xs mt-1",children:"Check back later for updates"})]}),be.length>5&&b.jsx(P,{variant:"outline",size:"sm",className:"w-full mt-2",onClick:()=>window.location.href="/sessions?view=teachers",children:"View All Teacher Sessions"})]})]}),b.jsxs("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-3xl border border-white/30 dark:border-gray-700/40 p-4 sm:p-6 shadow-2xl hover:shadow-2xl transition-all duration-300",children:[b.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[b.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"Your Upcoming Sessions"}),b.jsx(q,{className:"h-5 w-5 text-blue-500"})]}),b.jsx("div",{className:"space-y-3",children:F?b.jsx("div",{className:"flex justify-center py-4",children:b.jsx(v,{size:"sm"})}):L.length>0?L.map(e=>b.jsx(ue,{session:e,onJoin:Ne,getTeacherName:ye,teachers:me,type:"recent"},`recent-session-${e.id}`)):b.jsxs("div",{className:"text-center py-4 text-gray-600 dark:text-gray-400",children:[b.jsx(q,{className:"mx-auto h-8 w-8 mb-2"}),b.jsx("p",{className:"text-sm",children:"No upcoming sessions"}),b.jsx(P,{variant:"outline",size:"sm",className:"mt-2",onClick:()=>window.location.href="/sessions",children:"View All Sessions"})]})})]})]}),b.jsxs("div",{className:"xl:col-span-3 space-y-6",children:[b.jsx("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-3xl border border-white/30 dark:border-gray-700/40 p-4 sm:p-6 shadow-2xl",children:b.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center space-y-4 lg:space-y-0 lg:space-x-4",children:[b.jsx("div",{className:"flex-1",children:b.jsxs("div",{className:"relative",children:[b.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:b.jsx(Y,{className:"h-4 w-4 text-gray-500"})}),b.jsx(T,{type:"text",className:"block w-full pl-10 pr-3 py-3 rounded-2xl bg-white/50 dark:bg-gray-700/50 border-white/40 dark:border-gray-600/40 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 dark:text-white",placeholder:"Search recordings by title, description, or instructor...",value:s,onChange:e=>a(e.target.value)})]})}),b.jsxs(P,{onClick:()=>N(!j),variant:"outline",className:"lg:hidden",children:[b.jsx(J,{className:"h-4 w-4 mr-2"}),"Filters"]}),b.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 "+(j?"flex":"hidden lg:flex"),children:[b.jsx("select",{className:"block w-full sm:w-auto px-3 py-3 text-sm rounded-2xl bg-white/50 dark:bg-gray-700/50 border-white/40 dark:border-gray-600/40 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:c,onChange:e=>d(e.target.value),children:Re.map(e=>b.jsx("option",{value:e.value,children:e.label},`teacher-${e.value}`))}),b.jsx("select",{className:"block w-full sm:w-auto px-3 py-3 text-sm rounded-2xl bg-white/50 dark:bg-gray-700/50 border-white/40 dark:border-gray-600/40 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:l,onChange:e=>o(e.target.value),children:ie.map(e=>b.jsx("option",{value:e.value,children:e.label},`category-${e.value}`))}),b.jsx("select",{className:"block w-full sm:w-auto px-3 py-3 text-sm rounded-2xl bg-white/50 dark:bg-gray-700/50 border-white/40 dark:border-gray-600/40 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:i,onChange:e=>n(e.target.value),children:ne.map(e=>b.jsx("option",{value:e.value,children:e.label},`status-${e.value}`))}),b.jsx("select",{className:"block w-full sm:w-auto px-3 py-3 text-sm rounded-2xl bg-white/50 dark:bg-gray-700/50 border-white/40 dark:border-gray-600/40 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:u,onChange:e=>h(e.target.value),children:ae.map(e=>b.jsx("option",{value:e.value,children:e.label},`sort-${e.value}`))}),b.jsx(P,{onClick:()=>g("desc"===m?"asc":"desc"),variant:"outline",className:"px-3",children:"desc"===m?"↓":"↑"}),b.jsx(P,{onClick:je,variant:"outline",disabled:le,children:b.jsx(W,{className:"h-4 w-4 "+(le?"animate-spin":"")})})]})]})}),b.jsxs("div",{children:[b.jsxs("div",{className:"flex items-center justify-between mb-4",children:[b.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"Available Recordings"}),b.jsxs("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:[fe.length," items",s&&` • matching "${s}"`,"all"!==c&&` • by ${Re.find(e=>e.value===c)?.label}`]})]}),Z?b.jsx("div",{className:"flex justify-center items-center min-h-64 bg-white/50 dark:bg-gray-800/50 rounded-3xl border border-white/30 dark:border-gray-700/40",children:b.jsxs("div",{className:"text-center",children:[b.jsx(v,{size:"lg"}),b.jsx("p",{className:"mt-3 text-sm text-gray-600 dark:text-gray-400",children:"Loading recordings..."})]})}):fe.length>0?b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"grid grid-cols-1 gap-4 sm:gap-6",children:fe.map(e=>b.jsx(de,{recording:e,onWatch:we,actionLoading:x,getTeacherName:ye,teachers:me},`recording-${e.id}`))}),X&&b.jsx("div",{className:"flex justify-center mt-8",children:b.jsx(P,{onClick:()=>_(),disabled:G,variant:"outline",className:"flex items-center",children:G?b.jsxs(b.Fragment,{children:[b.jsx(v,{size:"sm",className:"mr-2"}),"Loading more recordings..."]}):b.jsx(b.Fragment,{children:"Load More Recordings"})})})]}):b.jsxs("div",{className:"text-center py-12 bg-white/50 dark:bg-gray-800/50 rounded-3xl border border-white/30 dark:border-gray-700/40",children:[b.jsx(M,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),b.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:s||"all"!==i||"all"!==l||"all"!==c?"No matching recordings":"No recordings available"}),b.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6 max-w-md mx-auto",children:s||"all"!==i||"all"!==l||"all"!==c?"Try adjusting your search or filters.":"Enroll in a class to access recordings."}),b.jsxs(P,{onClick:()=>window.location.href="/courses",className:"bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600",children:[b.jsx(A,{className:"h-4 w-4 mr-2"}),"Browse Classes"]})]})]})]})]})]}):b.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-50 via-white to-cyan-50 dark:from-gray-900 dark:via-gray-800 dark:to-blue-900",children:b.jsxs("div",{className:"text-center max-w-md p-8",children:[b.jsx(A,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),b.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Pending Approval"}),b.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Your account is awaiting admin approval. You will be notified via email once approved."}),b.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-xl p-4",children:b.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:"Please contact the administrator if you have been waiting for more than 24 hours."})})]})}):b.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-50 via-white to-cyan-50 dark:from-gray-900 dark:via-gray-800 dark:to-blue-900",children:b.jsxs("div",{className:"text-center max-w-md p-8",children:[b.jsx(A,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),b.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Authentication Required"}),b.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Please log in to access the student dashboard."}),b.jsx(P,{onClick:()=>window.location.href="/login",className:"bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 shadow-lg",children:"Sign in"})]})})};export{he as default};
