var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,i=(t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,o=(e,t)=>{for(var a in t||(t={}))s.call(t,a)&&i(e,a,t[a]);if(r)for(var a of r(t))l.call(t,a)&&i(e,a,t[a]);return e},n=(e,r)=>t(e,a(r));import{k as c,e as d,r as m,V as u,p as x,a8 as g,t as h,C as p,j as y,o as b,A as f,H as v,I as j,a9 as w,a4 as N,J as k,O as S,l as C,g as D,D as L,Z as A,a0 as R}from"./vendor-react-UVl3l3eP.js";import{u as $,L as T}from"./index-DEgoYGZl.js";import"./firebase-DbUGxvwD.js";import{s as M}from"./sessionService-C_bGmzpN.js";import{r as P}from"./recordingService-DCQSlFNV.js";import{B as O}from"./Button-BII5FLFC.js";import{z as U,B as z}from"./vendor-BMEBppWF.js";import"./i18n-CsgR-yW4.js";const W="recordings",F="upcoming",I="live",J="createdAt",B="title",G="duration",_="views",E="scheduledTime",V=[{value:"all",label:"All Categories"},{value:"lecture",label:"Lectures"},{value:"tutorial",label:"Tutorials"},{value:"workshop",label:"Workshops"},{value:"qna",label:"Q&A Sessions"}],Z=e=>{if(!e||0===e)return"0:00";const t=Math.floor(e/3600),a=Math.floor(e%3600/60),r=Math.floor(e%60);return t>0?`${t}:${a.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`:`${a}:${r.toString().padStart(2,"0")}`},q=e=>{if(!e)return"TBD";try{return new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}catch(t){return"Invalid Date"}},H=e=>{if(!e||"string"!=typeof e)return null;const t=e.match(/\/d\/([a-zA-Z0-9-_]+)/);return t?t[1]:null},Q=c.memo(m.forwardRef(({recording:e,onWatch:t,onDownload:a,index:r},s)=>{const l=!!H(e.recordingUrl),[i,o]=m.useState(!1);return y.jsxs(U.div,{ref:s,layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:Math.min(.03*r,.3),type:"spring",stiffness:400,damping:40},className:"group bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden hover:shadow-xl transition-all duration-300 hover:scale-105",children:[y.jsxs("div",{className:"h-48 bg-gradient-to-br from-blue-500 to-cyan-500 relative overflow-hidden",children:[e.thumbnailUrl?y.jsxs(y.Fragment,{children:[y.jsx("img",{src:e.thumbnailUrl,alt:e.title,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-110 "+(i?"opacity-100":"opacity-0"),loading:"lazy",onLoad:()=>o(!0)}),!i&&y.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gradient-to-br from-blue-500 to-cyan-500",children:y.jsx(u,{className:"h-8 w-8 text-white opacity-80"})})]}):y.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-blue-500 to-cyan-500",children:y.jsx(u,{className:"h-16 w-16 text-white opacity-80"})}),y.jsx("div",{className:"absolute bottom-4 left-4",children:y.jsx("span",{className:"px-3 py-1 bg-black bg-opacity-70 text-white rounded-full text-sm font-medium backdrop-blur-sm",children:Z(e.duration)})}),e.watched&&y.jsx("div",{className:"absolute top-4 right-4",children:y.jsxs("span",{className:"px-3 py-1 bg-green-500 text-white rounded-full text-xs font-medium flex items-center gap-1",children:[y.jsx(h,{className:"h-3 w-3"})," Watched"]})}),l&&y.jsx("div",{className:"absolute top-4 left-4",children:y.jsxs("span",{className:"px-2 py-1 bg-blue-500 text-white rounded-full text-xs font-medium flex items-center gap-1",children:[y.jsx(N,{className:"h-3 w-3"}),"Drive"]})}),l&&y.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-black bg-opacity-40",children:y.jsx("button",{onClick:()=>t(e),className:"p-4 bg-white bg-opacity-20 rounded-full backdrop-blur-sm hover:bg-opacity-30 transition-all transform hover:scale-110",title:"Watch on Google Drive",children:y.jsx(k,{className:"h-8 w-8 text-white"})})})]}),y.jsxs("div",{className:"p-6 space-y-4",children:[y.jsxs("div",{className:"flex items-start justify-between",children:[y.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white text-lg line-clamp-2 flex-1",children:e.title}),e.isFeatured&&y.jsx(S,{className:"h-5 w-5 text-yellow-500 fill-current ml-2 flex-shrink-0"})]}),y.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm line-clamp-2",children:e.description||"No description available"}),y.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500 dark:text-gray-400",children:[y.jsxs("div",{className:"flex items-center gap-3",children:[y.jsxs("span",{className:"flex items-center gap-1",children:[y.jsx(C,{className:"h-4 w-4"}),e.instructorName]}),y.jsxs("span",{className:"flex items-center gap-1",children:[y.jsx(D,{className:"h-4 w-4"}),e.views||0]})]}),e.category&&y.jsx("span",{className:"px-2 py-1 bg-gradient-to-r from-blue-100 to-cyan-100 dark:from-blue-900/30 dark:to-cyan-900/30 text-xs rounded-full capitalize",children:e.category})]}),y.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-gray-100 dark:border-gray-700",children:[y.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.createdAt?new Date(e.createdAt).toLocaleDateString():"Unknown date"}),y.jsxs("div",{className:"flex gap-2",children:[y.jsxs(O,{onClick:()=>t(e),size:"sm",className:"bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600",children:[y.jsx(k,{className:"h-4 w-4 mr-1"}),"Watch"]}),y.jsx(O,{variant:"outline",size:"sm",onClick:()=>a(e),title:"Download video",children:y.jsx(L,{className:"h-4 w-4"})})]})]})]})]})})),K=c.memo(m.forwardRef(({session:e,onJoin:t,index:a,type:r},s)=>{const l=r===I,i=l?"from-red-500 to-pink-600":"from-orange-400 to-yellow-500",o=l?"border-l-red-500":"border-l-orange-500",n=l?g:x,c=l?"Live Now":"Upcoming",d=l?"Join Live":"Join Session",m=l?g:R;return y.jsxs(U.div,{ref:s,layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:Math.min(.03*a,.3),type:"spring",stiffness:400,damping:40},className:`group bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden hover:shadow-xl transition-all duration-300 hover:scale-105 border-l-4 ${o} ${l?"animate-pulse":""}`,children:[y.jsxs("div",{className:`h-48 bg-gradient-to-br ${i} relative overflow-hidden`,children:[y.jsx("div",{className:"w-full h-full flex items-center justify-center",children:y.jsx(n,{className:"h-16 w-16 text-white opacity-80 "+(l?"animate-pulse":"")})}),y.jsx("div",{className:"absolute bottom-4 left-4",children:y.jsx("span",{className:"px-3 py-1 bg-black bg-opacity-70 text-white rounded-full text-sm font-medium backdrop-blur-sm",children:Z(e.duration||60)})}),y.jsx("div",{className:"absolute top-4 right-4",children:y.jsxs("span",{className:`px-3 py-1 ${l?"bg-red-500 animate-pulse":"bg-orange-500"} text-white rounded-full text-xs font-medium flex items-center gap-1`,children:[l&&y.jsx(A,{className:"h-3 w-3"}),c]})})]}),y.jsxs("div",{className:"p-6 space-y-4",children:[y.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white text-lg line-clamp-2",children:e.title||e.topic}),y.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm line-clamp-2",children:e.description||(l?"Live session in progress":"Live session coming soon")}),y.jsx("div",{className:"flex items-center justify-between text-sm text-gray-500 dark:text-gray-400",children:y.jsxs("div",{className:"flex items-center gap-3",children:[y.jsxs("span",{className:"flex items-center gap-1",children:[y.jsx(C,{className:"h-4 w-4"}),e.instructorName]}),y.jsxs("span",{className:"flex items-center gap-1",children:[y.jsx(p,{className:"h-4 w-4"}),q(e.scheduledTime)]})]})}),y.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-gray-100 dark:border-gray-700",children:[y.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.courseName||"General Session"}),y.jsxs(O,{size:"sm",onClick:()=>t(e),className:"bg-gradient-to-r "+(l?"from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 animate-pulse":"from-orange-500 to-yellow-500 hover:from-orange-600 hover:to-yellow-600"),children:[y.jsx(m,{className:"h-4 w-4 mr-1"}),d]})]})]})]})})),X=c.memo(()=>{const{t:e}=d(),{user:t}=$(),[a,r]=m.useState([]),[s,l]=m.useState([]),[i,c]=m.useState([]),[N,k]=m.useState(!0),[S,C]=m.useState(""),[D,L]=m.useState("all"),[A,R]=m.useState(J),[q,X]=m.useState(W),[Y,ee]=m.useState(null),[te,ae]=m.useState(!1),re=null==t?void 0:t.uid,se=m.useRef(null),le=m.useMemo(()=>{const e=a.length,t=a.reduce((e,t)=>e+(t.duration||0),0),r=a.reduce((e,t)=>e+(t.views||0),0),l=a.filter(e=>e.progress>=95).length;return{totalRecordings:e,totalDuration:Z(t),totalViews:r,completedRecordings:l,completionRate:e>0?Math.round(l/e*100):0,upcomingCount:s.length,liveCount:i.length}},[a,s,i]),ie=m.useMemo(()=>{if(!a.length&&!s.length&&!i.length)return[];let e=[];switch(q){case W:e=a.map(e=>n(o({},e),{type:W,sortDate:e.createdAt}));break;case F:e=s.map(e=>n(o({},e),{type:F,duration:e.duration||60,sortDate:e.scheduledTime}));break;case I:e=i.map(e=>n(o({},e),{type:I,duration:e.duration||60,sortDate:e.actualStartTime||e.scheduledTime}));break;default:return[]}if(S){const t=S.toLowerCase();e=e.filter(e=>{var a,r,s;return(null==(a=e.title)?void 0:a.toLowerCase().includes(t))||(null==(r=e.description)?void 0:r.toLowerCase().includes(t))||(null==(s=e.instructorName)?void 0:s.toLowerCase().includes(t))||(e.tags||[]).some(e=>e.toLowerCase().includes(t))})}return"all"!==D&&(e=e.filter(e=>e.category===D)),e.length>0&&e.sort((e,t)=>{switch(A){case B:return(e.title||"").localeCompare(t.title||"");case G:return(t.duration||0)-(e.duration||0);case _:return(t.views||0)-(e.views||0);case E:return new Date(e.sortDate||0)-new Date(t.sortDate||0);default:return new Date(t.sortDate||0)-new Date(e.sortDate||0)}}),e},[a,s,i,q,S,D,A]),oe=m.useCallback(async e=>{const t=H(e.recordingUrl);if(!t)return void alert("Invalid Google Drive link");const a=`https://drive.google.com/file/d/${t}/preview`;if(window.open(a,"_blank","noopener,noreferrer"),e.id&&re)try{await Promise.allSettled([P.incrementRecordingViews(e.id),P.updateStudentProgress(e.id,re,{progress:5,lastWatched:new Date})])}catch(r){}},[re]),ne=m.useCallback(e=>{const t=H(e.recordingUrl);if(!t)return void alert("Cannot download: Invalid video URL");const a=`https://drive.google.com/uc?export=download&id=${t}`,r=document.createElement("a");r.href=a,r.download=`${e.title||"recording"}.mp4`,r.target="_blank",document.body.appendChild(r),r.click(),document.body.removeChild(r)},[]),ce=m.useCallback(async e=>{if(e.meetLink){try{await M.addParticipant(e.id,re,{email:null==t?void 0:t.email,name:(null==t?void 0:t.displayName)||"Student",joinedAt:new Date})}catch(a){}window.open(e.meetLink,"_blank","noopener,noreferrer")}else alert("No meeting link available")},[re,t]),de=m.useCallback(async(e=!1)=>{if(!re)return;se.current&&se.current.abort(),se.current=new AbortController;const t=se.current.signal;try{e?ae(!0):k(!0),ee(null);const[a,s,i]=await Promise.allSettled([P.getAvailableRecordings({studentId:re,limit:50}),M.getTeacherSessionsForStudents({limit:20,daysAhead:30}),M.getAllSessions({status:"live",limit:20})]);if(t.aborted)return;if("fulfilled"===a.status){const e=Array.isArray(a.value.recordings)?a.value.recordings:[];r(e)}else r([]);"fulfilled"===s.status?l(s.value):l([]),"fulfilled"===i.status?c(i.value):c([])}catch(a){if(t.aborted)return;ee("Failed to load content. Please try refreshing.")}finally{t.aborted||(k(!1),ae(!1))}},[re]);m.useEffect(()=>(re&&de(),()=>{se.current&&se.current.abort()}),[re,de]);const me=m.useMemo(()=>[{key:W,label:"Recordings",icon:u,count:a.length},{key:F,label:"Upcoming",icon:x,count:s.length},{key:I,label:"Live",icon:g,count:i.length}],[a.length,s.length,i.length]),ue=m.useMemo(()=>[{value:J,label:"Newest First"},{value:_,label:"Most Popular"},{value:G,label:"Longest"},{value:B,label:"Title A-Z"},{value:E,label:"Soonest First"}],[]),xe=m.useMemo(()=>[{label:"Total Recordings",value:le.totalRecordings,icon:u,color:"blue"},{label:"Completed",value:le.completedRecordings,percent:le.completionRate,icon:h,color:"green"},{label:"Total Watch Time",value:le.totalDuration,icon:p,color:"purple"}],[le]);return N?y.jsxs("div",{className:"flex flex-col items-center justify-center min-h-96 space-y-4",children:[y.jsx(T,{size:"lg"}),y.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading your learning content..."})]}):y.jsxs("div",{className:"space-y-6",children:[y.jsxs(U.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[y.jsxs("div",{children:[y.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-3",children:[y.jsx(u,{className:"h-8 w-8 text-blue-500"}),"Learning Content"]}),y.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Watch recordings on Google Drive, join live sessions, and track your progress"})]}),y.jsx("div",{className:"flex gap-3",children:y.jsxs(O,{onClick:()=>de(!0),variant:"outline",disabled:te,children:[y.jsx(b,{className:"h-4 w-4 mr-2 "+(te?"animate-spin":"")}),te?"Refreshing...":"Refresh"]})})]}),Y&&y.jsxs(U.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-xl p-4 flex items-start gap-3",children:[y.jsx(f,{className:"h-5 w-5 text-red-500 mt-0.5 flex-shrink-0"}),y.jsxs("div",{className:"flex-1",children:[y.jsx("p",{className:"text-red-700 dark:text-red-300",children:Y}),y.jsx(O,{onClick:()=>de(!0),size:"sm",variant:"outline",className:"mt-2 border-red-300 text-red-700 hover:bg-red-50",children:"Try Again"})]})]}),y.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:xe.map((e,t)=>y.jsx(U.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.1*t},className:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-200 dark:border-gray-700 hover:shadow-xl transition-shadow duration-300",children:y.jsxs("div",{className:"flex items-center justify-between",children:[y.jsxs("div",{children:[y.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:e.label}),y.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-1",children:e.value}),void 0!==e.percent&&y.jsxs("p",{className:"text-sm text-green-600 dark:text-green-400 mt-1",children:[e.percent,"% completed"]})]}),y.jsx("div",{className:`p-3 bg-${e.color}-100 dark:bg-${e.color}-900/30 rounded-lg`,children:y.jsx(e.icon,{className:`h-6 w-6 text-${e.color}-600 dark:text-${e.color}-400`})})]})},e.label))}),y.jsx(U.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-200 dark:border-gray-700",children:y.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-6",children:[y.jsx("div",{className:"flex space-x-1 bg-gray-100 dark:bg-gray-700 rounded-lg p-1",children:me.map(e=>y.jsxs("button",{onClick:()=>X(e.key),className:"flex items-center px-4 py-2 rounded-md text-sm font-medium transition-all duration-200 "+(q===e.key?"bg-white dark:bg-gray-600 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),children:[y.jsx(e.icon,{className:"h-4 w-4 mr-2"}),e.label,y.jsx("span",{className:"ml-2 px-1.5 py-0.5 text-xs rounded-full "+(q===e.key?"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300":"bg-gray-200 dark:bg-gray-600 text-gray-600 dark:text-gray-400"),children:e.count})]},e.key))}),y.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row lg:items-center gap-4",children:[y.jsxs("div",{className:"flex-1 relative",children:[y.jsx(v,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),y.jsx("input",{type:"text",placeholder:"Search recordings, sessions, instructors...",value:S,onChange:e=>C(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200"})]}),y.jsxs("div",{className:"flex flex-wrap gap-3",children:[y.jsxs("div",{className:"relative",children:[y.jsx(j,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),y.jsx("select",{value:D,onChange:e=>L(e.target.value),className:"pl-10 pr-8 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none cursor-pointer",children:V.map(e=>y.jsx("option",{value:e.value,children:e.label},e.value))})]}),y.jsxs("div",{className:"relative",children:[y.jsx(w,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),y.jsx("select",{value:A,onChange:e=>R(e.target.value),className:"pl-10 pr-8 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none cursor-pointer",children:ue.map(e=>y.jsx("option",{value:e.value,children:e.label},e.value))})]})]})]})]})}),y.jsxs("div",{children:[y.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:y.jsx(z,{mode:"popLayout",children:ie.map((e,t)=>e.type===W?y.jsx(Q,{recording:e,index:t,onWatch:oe,onDownload:ne},e.id):e.type===F||e.type===I?y.jsx(K,{session:e,index:t,type:e.type,onJoin:ce},e.id):null)})}),0===ie.length&&y.jsxs(U.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-16",children:[q===W&&y.jsx(u,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),q===F&&y.jsx(x,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),q===I&&y.jsx(g,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),y.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:["No ",q," found"]}),y.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6 max-w-md mx-auto",children:S||"all"!==D?"Try adjusting your search or filters to find more content.":`No ${q} are currently available. Check back later for new content.`}),y.jsxs(O,{onClick:()=>de(!0),variant:"outline",children:[y.jsx(b,{className:"h-4 w-4 mr-2"}),"Refresh Content"]})]})]})]})});export{X as default};
