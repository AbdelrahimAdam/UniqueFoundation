var e=Object.defineProperty,s=Object.defineProperties,r=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,l=(s,r,a)=>r in s?e(s,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[r]=a,n=(e,s)=>{for(var r in s||(s={}))t.call(s,r)&&l(e,r,s[r]);if(a)for(var r of a(s))i.call(s,r)&&l(e,r,s[r]);return e},d=(e,a)=>s(e,r(a));import{e as o,r as c,j as m,s as x,P as u,p as g,V as h,m as y,n as j,H as p,U as b,J as f,g as v,Y as w,_ as N,C as k,K as S,$ as C}from"./vendor-react-UVl3l3eP.js";import{u as R}from"./userService-D6ZxaIsw.js";import{s as L}from"./sessionService-C_bGmzpN.js";import{r as P}from"./recordingService-DCQSlFNV.js";import{c as A}from"./courseService-Bk_98Hn2.js";import{B as T}from"./Button-BII5FLFC.js";import{L as F}from"./index-DEgoYGZl.js";import U from"./CreateSessionModal-ggWHErs7.js";import{C as z}from"./CreateRecordingModal-2wDhSN1Z.js";import"./vendor-BMEBppWF.js";import"./firebase-DbUGxvwD.js";import"./i18n-CsgR-yW4.js";import"./Select-DqBXF94C.js";const O=()=>{const{t:e}=o(),[s,r]=c.useState([]),[a,t]=c.useState([]),[i,l]=c.useState([]),[k,O]=c.useState([]),[I,D]=c.useState(!0),[E,B]=c.useState(""),[M,J]=c.useState("all"),[V,$]=c.useState("all"),[_,G]=c.useState(!1),[q,H]=c.useState(!1),[K,W]=c.useState({}),[Y,Q]=c.useState(null),[X,Z]=c.useState(null),[ee,se]=c.useState("");c.useEffect(()=>{re()},[]);const re=async()=>{try{D(!0);const e=await authService.getCurrentUser();if(Z(e),se((null==e?void 0:e.role)||""),"admin"===(null==e?void 0:e.role)){const[e,s,a,i]=await Promise.all([L.getAllSessions().catch(e=>[]),P.getAllRecordings().catch(e=>[]),A.getAllCourses().catch(e=>[]),R.getUsersByRole("teacher").catch(e=>[])]);r(e),t(s),l(a),O(i)}else if("teacher"===(null==e?void 0:e.role)){const[s,a,i]=await Promise.all([L.getSessionsByTeacher(e.uid).catch(e=>[]),P.getRecordingsByTeacher(e.uid).catch(e=>[]),A.getCoursesByTeacher(e.uid).catch(e=>[])]);r(s),t(a),l(i)}else if("student"===(null==e?void 0:e.role)){const[e,s,a]=await Promise.all([L.getPublishedSessions().catch(e=>[]),P.getPublishedRecordings().catch(e=>[]),A.getAllCourses().catch(e=>[])]);r(e),t(s),l(a)}}catch(e){}finally{D(!1)}},ae=e=>{e.meetLink&&window.open(e.meetLink,"_blank")},te=()=>k,ie=()=>i,le=s.filter(e=>{var s,r,a,t;const i=(null==(s=e.title)?void 0:s.toLowerCase().includes(E.toLowerCase()))||(null==(r=e.topic)?void 0:r.toLowerCase().includes(E.toLowerCase()))||(null==(a=e.description)?void 0:a.toLowerCase().includes(E.toLowerCase()))||(null==(t=e.instructorName)?void 0:t.toLowerCase().includes(E.toLowerCase())),l="all"===M||e.status===M;return i&&l}),ne=a.filter(e=>{var s,r,a,t;const i=(null==(s=e.title)?void 0:s.toLowerCase().includes(E.toLowerCase()))||(null==(r=e.description)?void 0:r.toLowerCase().includes(E.toLowerCase()))||(null==(a=e.instructorName)?void 0:a.toLowerCase().includes(E.toLowerCase()))||(null==(t=e.category)?void 0:t.toLowerCase().includes(E.toLowerCase())),l="all"===M||e.status===M;return i&&l}),de=e=>{switch(e){case"scheduled":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300";case"live":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300";case"completed":case"available":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300";case"recorded":return"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-300"}},oe=e=>{const s=i.find(s=>s.id===e);return s?s.name:"Unknown Course"},ce=e=>{if(!k||"admin"!==ee)return"Unknown Teacher";const s=k.find(s=>s.id===e);return s?s.displayName:"Unknown Teacher"};if(I)return m.jsx("div",{className:"flex items-center justify-center min-h-96",children:m.jsx(F,{size:"lg"})});const me="sessions"===V?le:"recordings"===V?ne:[...le,...ne];return m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:["admin"===ee&&"Session & Recording Management","teacher"===ee&&"My Sessions & Recordings","student"===ee&&"Available Sessions & Recordings"]}),m.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:["admin"===ee&&"Manage all sessions and recordings across the platform","teacher"===ee&&"Manage your teaching sessions and recordings","student"===ee&&"View available sessions and recordings"]})]}),m.jsx("div",{className:"flex space-x-3",children:("admin"===ee||"teacher"===ee)&&m.jsxs(m.Fragment,{children:["admin"===ee&&m.jsxs(T,{onClick:()=>{Q(null),H(!0)},variant:"outline",className:"bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white",children:[m.jsx(x,{className:"h-4 w-4 mr-2"}),"Add Recording"]}),m.jsxs(T,{onClick:()=>{Q(null),G(!0)},className:"bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600",children:[m.jsx(u,{className:"h-4 w-4 mr-2"}),"Schedule Session"]})]})})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[m.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow border border-gray-200 dark:border-gray-700",children:m.jsxs("div",{className:"flex items-center",children:[m.jsx(g,{className:"h-8 w-8 text-blue-500 mr-3"}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"student"===ee?"Available Sessions":"Total Sessions"}),m.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:s.length})]})]})}),m.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow border border-gray-200 dark:border-gray-700",children:m.jsxs("div",{className:"flex items-center",children:[m.jsx(h,{className:"h-8 w-8 text-purple-500 mr-3"}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"student"===ee?"Available Recordings":"Total Recordings"}),m.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a.length})]})]})}),m.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow border border-gray-200 dark:border-gray-700",children:m.jsxs("div",{className:"flex items-center",children:[m.jsx(y,{className:"h-8 w-8 text-green-500 mr-3"}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Courses"}),m.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:i.length})]})]})}),m.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow border border-gray-200 dark:border-gray-700",children:m.jsxs("div",{className:"flex items-center",children:[m.jsx(j,{className:"h-8 w-8 text-orange-500 mr-3"}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Live Sessions"}),m.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:s.filter(e=>"live"===e.status).length})]})]})})]}),m.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-200 dark:border-gray-700",children:m.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center space-y-4 lg:space-y-0 lg:space-x-4",children:[m.jsx("div",{className:"flex-1",children:m.jsxs("div",{className:"relative",children:[m.jsx(p,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),m.jsx("input",{type:"text",placeholder:"student"===ee?"Search available sessions and recordings...":"Search sessions and recordings...",value:E,onChange:e=>B(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),m.jsxs("div",{className:"flex space-x-4",children:[m.jsxs("select",{value:V,onChange:e=>$(e.target.value),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[m.jsx("option",{value:"all",children:"All Types"}),m.jsx("option",{value:"sessions",children:"Sessions Only"}),m.jsx("option",{value:"recordings",children:"Recordings Only"})]}),m.jsxs("select",{value:M,onChange:e=>J(e.target.value),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[m.jsx("option",{value:"all",children:"All Status"}),m.jsx("option",{value:"scheduled",children:"Scheduled"}),m.jsx("option",{value:"live",children:"Live"}),m.jsx("option",{value:"completed",children:"Completed"}),m.jsx("option",{value:"recorded",children:"Recorded"})]})]})]})}),m.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:me.map(e=>{const r=(e=>e.meetLink?"session":"recording")(e),a="session"===r,t="recording"===r;(e=>{switch(e){case"scheduled":return g;case"live":return f;case"completed":case"available":return S;case"recorded":return C;default:;}})(e.status);const i="live"===e.status,l="scheduled"===e.status,o=e.recordingUrl||e.isRecorded,c=e.isPublished,x=(e=>"admin"===ee||"teacher"===ee&&e.instructorId===(null==X?void 0:X.uid))(e);return m.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden hover:shadow-xl transition-all duration-300",children:[m.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[m.jsx("div",{className:"flex items-start justify-between mb-3",children:m.jsxs("div",{className:"flex-1",children:[m.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[a&&m.jsx(g,{className:"h-4 w-4 text-blue-500"}),t&&m.jsx(h,{className:"h-4 w-4 text-purple-500"}),m.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${de(e.status)}`,children:[a?"Session":"Recording"," â€¢ ",e.status]}),!c&&"student"!==ee&&m.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300",children:"Draft"})]}),m.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white text-lg line-clamp-2",children:e.title||e.topic}),m.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm mt-1 line-clamp-2",children:e.description})]})}),m.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500 dark:text-gray-400",children:[m.jsxs("span",{className:"flex items-center",children:[m.jsx(b,{className:"h-4 w-4 mr-1"}),e.instructorName||"Unknown Instructor"]}),e.scheduledTime&&m.jsxs("span",{className:"flex items-center",children:[m.jsx(g,{className:"h-4 w-4 mr-1"}),new Date(e.scheduledTime).toLocaleDateString()]})]})]}),m.jsxs("div",{className:"p-6",children:[m.jsxs("div",{className:"space-y-3",children:[e.scheduledTime&&m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Time"}),m.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:new Date(e.scheduledTime).toLocaleTimeString()})]}),e.duration&&m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Duration"}),m.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[e.duration," min"]})]}),m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Course"}),m.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:oe(e.courseId)})]}),"admin"===ee&&m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Teacher"}),m.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:ce(e.instructorId)})]}),m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Recording"}),m.jsx("span",{className:"text-sm font-medium "+(o?"text-green-600 dark:text-green-400":"text-gray-500 dark:text-gray-400"),children:o?"Available":"Not available"})]})]}),m.jsxs("div",{className:"flex flex-wrap gap-2 mt-6",children:[("student"===ee||!x)&&m.jsxs(m.Fragment,{children:[a&&i&&m.jsxs(T,{onClick:()=>ae(e),className:"flex-1 bg-red-600 hover:bg-red-700 text-white",children:[m.jsx(f,{className:"h-4 w-4 mr-2"}),"Join Live"]}),a&&l&&m.jsxs(T,{onClick:()=>ae(e),variant:"outline",className:"flex-1",children:[m.jsx(g,{className:"h-4 w-4 mr-2"}),"Join Session"]}),o&&m.jsx("a",{href:e.recordingUrl,target:"_blank",rel:"noopener noreferrer",className:"flex-1",children:m.jsxs(T,{variant:"outline",className:"w-full",children:[m.jsx(v,{className:"h-4 w-4 mr-2"}),a?"View Recording":"Watch Recording"]})})]}),x&&m.jsxs(m.Fragment,{children:[a&&i&&m.jsxs(T,{onClick:()=>ae(e),className:"flex-1 bg-red-600 hover:bg-red-700 text-white",children:[m.jsx(f,{className:"h-4 w-4 mr-2"}),"Join Live"]}),a&&l&&m.jsxs(T,{onClick:()=>ae(e),variant:"outline",className:"flex-1",children:[m.jsx(g,{className:"h-4 w-4 mr-2"}),"Join"]}),a&&!o&&"completed"===e.status&&m.jsxs(T,{onClick:()=>(async e=>{const r=prompt("Enter Google Drive recording URL:");if(r)try{W(s=>d(n({},s),{[e]:!0}));const a=s.find(s=>s.id===e);if(!a)throw new Error("Session not found");await L.markAsRecorded(e,r),await P.createRecording({title:`${a.title} - Recording`,description:`Recording of ${a.title}`,recordingUrl:r,duration:a.duration||60,fileSize:250,quality:"1080p",courseId:a.courseId,instructorId:a.instructorId,instructorEmail:a.instructorEmail,instructorName:a.instructorName,visibility:a.visibility||"public",category:a.category||"general",status:"recorded",recordingStatus:"available",isPublished:a.isPublished||!1}),await re()}catch(a){alert("Failed to add recording: "+a.message)}finally{W(s=>d(n({},s),{[e]:!1}))}})(e.id),disabled:K[e.id],className:"flex-1 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600",children:[K[e.id]?m.jsx(F,{size:"sm",className:"mr-2"}):m.jsx(h,{className:"h-4 w-4 mr-2"}),"Add Recording"]}),o&&m.jsx("a",{href:e.recordingUrl,target:"_blank",rel:"noopener noreferrer",className:"flex-1",children:m.jsxs(T,{variant:"outline",className:"w-full",children:[m.jsx(v,{className:"h-4 w-4 mr-2"}),"View Recording"]})}),a&&m.jsxs(m.Fragment,{children:[l&&m.jsx(T,{onClick:()=>(async e=>{try{W(s=>d(n({},s),{[e]:!0})),await L.updateSessionStatus(e,"live"),await re()}catch(s){alert("Failed to start session: "+s.message)}finally{W(s=>d(n({},s),{[e]:!1}))}})(e.id),variant:"outline",size:"sm",children:"Start"}),i&&m.jsx(T,{onClick:()=>(async e=>{try{W(s=>d(n({},s),{[e]:!0})),await L.updateSessionStatus(e,"completed"),await re()}catch(s){alert("Failed to end session: "+s.message)}finally{W(s=>d(n({},s),{[e]:!1}))}})(e.id),variant:"outline",size:"sm",children:"End"}),c?m.jsx(T,{onClick:()=>(async e=>{try{W(s=>d(n({},s),{[e]:!0})),await L.updateSession(e,{isPublished:!1}),await re()}catch(s){alert("Failed to unpublish session: "+s.message)}finally{W(s=>d(n({},s),{[e]:!1}))}})(e.id),variant:"outline",size:"sm",children:"Unpublish"}):m.jsx(T,{onClick:()=>(async e=>{try{W(s=>d(n({},s),{[e]:!0})),await L.updateSession(e,{isPublished:!0}),await re()}catch(s){alert("Failed to publish session: "+s.message)}finally{W(s=>d(n({},s),{[e]:!1}))}})(e.id),variant:"outline",size:"sm",children:"Publish"})]}),t&&m.jsx(m.Fragment,{children:c?m.jsx(T,{onClick:()=>(async e=>{try{W(s=>d(n({},s),{[e]:!0})),await P.updateRecording(e,{isPublished:!1}),await re()}catch(s){alert("Failed to unpublish recording: "+s.message)}finally{W(s=>d(n({},s),{[e]:!1}))}})(e.id),variant:"outline",size:"sm",children:"Unpublish"}):m.jsx(T,{onClick:()=>(async e=>{try{W(s=>d(n({},s),{[e]:!0})),await P.updateRecording(e,{isPublished:!0}),await re()}catch(s){alert("Failed to publish recording: "+s.message)}finally{W(s=>d(n({},s),{[e]:!1}))}})(e.id),variant:"outline",size:"sm",children:"Publish"})}),m.jsx(T,{onClick:()=>a?(Q(e),void G(!0)):(Q(e),void H(!0)),variant:"outline",size:"sm",children:m.jsx(w,{className:"h-4 w-4"})}),m.jsx(T,{onClick:()=>a?(async e=>{if(window.confirm("Are you sure you want to delete this session?"))try{W(s=>d(n({},s),{[e]:!0})),await L.deleteSession(e),await re()}catch(s){alert("Failed to delete session: "+s.message)}finally{W(s=>d(n({},s),{[e]:!1}))}})(e.id):(async e=>{if(window.confirm("Are you sure you want to delete this recording?"))try{W(s=>d(n({},s),{[e]:!0})),await P.deleteRecording(e),await re()}catch(s){alert("Failed to delete recording: "+s.message)}finally{W(s=>d(n({},s),{[e]:!1}))}})(e.id),variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20",children:m.jsx(N,{className:"h-4 w-4"})})]})]})]})]},e.id)})}),0===me.length&&m.jsxs("div",{className:"text-center py-12",children:[m.jsx(h,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),m.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"No sessions or recordings found"}),m.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:E||"all"!==M||"all"!==V?"Try adjusting your search or filters":"student"===ee?"No published sessions or recordings available yet":"Get started by scheduling your first session or adding a recording"}),("admin"===ee||"teacher"===ee)&&m.jsxs("div",{className:"flex justify-center space-x-3",children:["admin"===ee&&m.jsxs(T,{onClick:()=>H(!0),variant:"outline",className:"bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white",children:[m.jsx(x,{className:"h-4 w-4 mr-2"}),"Add Recording"]}),m.jsxs(T,{onClick:()=>G(!0),className:"bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600",children:[m.jsx(u,{className:"h-4 w-4 mr-2"}),"Schedule Session"]})]})]}),_&&m.jsx(U,{onClose:()=>G(!1),onSuccess:()=>{G(!1),Q(null),re()},session:Y,courses:ie(),teachers:te(),currentTeacher:X,isAdmin:"admin"===ee}),q&&m.jsx(z,{onClose:()=>H(!1),onSuccess:()=>{H(!1),Q(null),re()},recording:Y,courses:ie(),teachers:te(),currentTeacher:X,isAdmin:"admin"===ee})]})};export{O as default};
