import{j as e,L as s}from"./index-fde0d62d.js";import{r as t}from"./vendor-0a74ad82.js";import{u as a}from"./userService-11868d81.js";import{s as r}from"./sessionService-e4efedfb.js";import{r as l}from"./recordingService-ea5c15f3.js";import{c as i}from"./courseService-0222f79f.js";import{c as d,B as x}from"./Button-e4864804.js";import{u as n}from"./useTranslation-b39a34c2.js";import{D as c}from"./download-d1e15a84.js";import{T as m}from"./trending-up-a9e06369.js";import{U as o}from"./users-dacba3b8.js";import{B as h}from"./book-open-f786a2db.js";import{P as g}from"./play-circle-3e70d83b.js";import{V as p}from"./video-0db73cd2.js";import{P as j}from"./pie-chart-e6b2dafe.js";import{B as u}from"./bar-chart-3-c0cb83cc.js";import{C as f}from"./clock-ef5a2b60.js";import{F as y}from"./file-video-31cd48fb.js";import{C as b}from"./calendar-7494118b.js";import{U as w}from"./user-plus-29b96d9a.js";import{B as N}from"./bookmark-d6f353c3.js";import"./router-80e9042b.js";import"./firebase-383b8577.js";const v=d("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]),k=()=>{n();const[d,k]=t.useState({}),[S,U]=t.useState("30days"),[T,R]=t.useState(!0),[C,D]=t.useState(!1);t.useEffect(()=>{M()},[S]);const M=async()=>{try{R(!0);const[e,s,t,d]=await Promise.all([a.getAllUsers().catch(()=>[]),i.getAllCourses().catch(()=>[]),r.getAllSessions().catch(()=>[]),l.getAllRecordings().catch(()=>[])]),x=new Date,n={"7days":6048e5,"30days":2592e6,"90days":7776e6}[S],c=e.filter(e=>e.createdAt&&x-new Date(e.createdAt)<n),m=t.filter(e=>e.createdAt&&x-new Date(e.createdAt)<n),o=d.filter(e=>e.createdAt&&x-new Date(e.createdAt)<n),h=d.reduce((e,s)=>e+(s.duration||0),0),g=1024*d.reduce((e,s)=>e+(s.fileSize||0),0)*1024,p=e.filter(e=>"student"===e.role).length,j=e.filter(e=>"student"===e.role&&e.lastLogin&&x-new Date(e.lastLogin)<6048e5).length;k({totalUsers:e.length,totalCourses:s.length,totalSessions:t.length,totalRecordings:d.length,newUsers:c.length,activeSessions:t.filter(e=>"live"===e.status).length,completedSessions:t.filter(e=>"completed"===e.status).length,scheduledSessions:t.filter(e=>"scheduled"===e.status).length,totalWatchTime:h,storageUsed:g,userGrowth:c.length,sessionGrowth:m.length,recordingGrowth:o.length,activeStudents:j,engagementRate:p>0?j/p*100:0,userDistribution:{students:e.filter(e=>"student"===e.role).length,teachers:e.filter(e=>"teacher"===e.role).length,admins:e.filter(e=>"admin"===e.role).length},sessionDistribution:{scheduled:t.filter(e=>"scheduled"===e.status).length,live:t.filter(e=>"live"===e.status).length,completed:t.filter(e=>"completed"===e.status).length}})}catch(e){}finally{R(!1)}},A=e=>e?e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString():"0",B=e=>{if(!e||0===e)return"0 B";const s=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,s)*100)/100+" "+["B","KB","MB","GB","TB"][s]};return T?e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsx(s,{size:"lg"})}):e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white break-words",children:"Platform Analytics"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1 text-sm sm:text-base",children:"Detailed insights and platform metrics"})]}),e.jsxs("div",{className:"flex flex-col xs:flex-row gap-3 w-full sm:w-auto",children:[e.jsxs("select",{value:S,onChange:e=>U(e.target.value),className:"w-full sm:w-auto px-3 sm:px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base",children:[e.jsx("option",{value:"7days",children:"Last 7 days"}),e.jsx("option",{value:"30days",children:"Last 30 days"}),e.jsx("option",{value:"90days",children:"Last 90 days"})]}),e.jsxs(x,{variant:"outline",onClick:async()=>{try{D(!0),await new Promise(e=>setTimeout(e,1500));const e=[["Metric","Value","Time Range"],["Total Users",d.totalUsers,S],["Total Courses",d.totalCourses,S],["Total Sessions",d.totalSessions,S],["Total Recordings",d.totalRecordings,S],["New Users",d.newUsers,S],["Active Sessions",d.activeSessions,S],["Completed Sessions",d.completedSessions,S],["Total Watch Time (minutes)",d.totalWatchTime,S],["Storage Used",B(d.storageUsed),S]].map(e=>e.join(",")).join("\n"),s=new Blob([e],{type:"text/csv"}),t=window.URL.createObjectURL(s),a=document.createElement("a");a.href=t,a.download=`analytics-report-${S}-${(new Date).toISOString().split("T")[0]}.csv`,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(t)}catch(e){}finally{D(!1)}},disabled:C,className:"w-full sm:w-auto justify-center",children:[C?e.jsx(s,{size:"sm",className:"mr-2"}):e.jsx(c,{className:"h-4 w-4 mr-2"}),C?"Exporting...":"Export Report"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 xs:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 lg:gap-6",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 shadow-lg border border-gray-200 dark:border-gray-700 hover:shadow-xl transition-shadow duration-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-gray-600 dark:text-gray-400 truncate",children:"Total Users"}),e.jsx("p",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white mt-1",children:A(d.totalUsers)}),e.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400 mt-1 flex items-center",children:[e.jsx(m,{className:"h-3 w-3 mr-1"}),"+",d.userGrowth," new"]})]}),e.jsx("div",{className:"p-2 sm:p-3 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex-shrink-0 ml-3",children:e.jsx(o,{className:"h-5 w-5 sm:h-6 sm:w-6 text-blue-600 dark:text-blue-400"})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 shadow-lg border border-gray-200 dark:border-gray-700 hover:shadow-xl transition-shadow duration-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-gray-600 dark:text-gray-400 truncate",children:"Total Courses"}),e.jsx("p",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white mt-1",children:A(d.totalCourses)}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Active learning"})]}),e.jsx("div",{className:"p-2 sm:p-3 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex-shrink-0 ml-3",children:e.jsx(h,{className:"h-5 w-5 sm:h-6 sm:w-6 text-purple-600 dark:text-purple-400"})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 shadow-lg border border-gray-200 dark:border-gray-700 hover:shadow-xl transition-shadow duration-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-gray-600 dark:text-gray-400 truncate",children:"Total Sessions"}),e.jsx("p",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white mt-1",children:A(d.totalSessions)}),e.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400 mt-1 flex items-center",children:[e.jsx(g,{className:"h-3 w-3 mr-1"}),d.activeSessions," live"]})]}),e.jsx("div",{className:"p-2 sm:p-3 bg-green-100 dark:bg-green-900/30 rounded-lg flex-shrink-0 ml-3",children:e.jsx(p,{className:"h-5 w-5 sm:h-6 sm:w-6 text-green-600 dark:text-green-400"})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 shadow-lg border border-gray-200 dark:border-gray-700 hover:shadow-xl transition-shadow duration-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-gray-600 dark:text-gray-400 truncate",children:"Storage Used"}),e.jsx("p",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white mt-1",children:B(d.storageUsed)}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Recordings & files"})]}),e.jsx("div",{className:"p-2 sm:p-3 bg-orange-100 dark:bg-orange-900/30 rounded-lg flex-shrink-0 ml-3",children:e.jsx(v,{className:"h-5 w-5 sm:h-6 sm:w-6 text-orange-600 dark:text-orange-400"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 shadow-lg border border-gray-200 dark:border-gray-700 lg:col-span-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(j,{className:"h-5 w-5 text-blue-500"}),e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white",children:"User Distribution"})]}),e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full flex-shrink-0"}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:"Students"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-xs sm:text-sm font-semibold text-gray-900 dark:text-white block",children:d.userDistribution?.students||0}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[d.totalUsers?Math.round(d.userDistribution?.students/d.totalUsers*100):0,"%"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full flex-shrink-0"}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:"Teachers"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-xs sm:text-sm font-semibold text-gray-900 dark:text-white block",children:d.userDistribution?.teachers||0}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[d.totalUsers?Math.round(d.userDistribution?.teachers/d.totalUsers*100):0,"%"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-3 h-3 bg-purple-500 rounded-full flex-shrink-0"}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:"Admins"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-xs sm:text-sm font-semibold text-gray-900 dark:text-white block",children:d.userDistribution?.admins||0}),e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[d.totalUsers?Math.round(d.userDistribution?.admins/d.totalUsers*100):0,"%"]})]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 shadow-lg border border-gray-200 dark:border-gray-700 lg:col-span-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(u,{className:"h-5 w-5 text-green-500"}),e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white",children:"Session Analytics"})]}),e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(f,{className:"h-4 w-4 text-blue-500 flex-shrink-0"}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:"Total Watch Time"})]}),e.jsx("span",{className:"text-xs sm:text-sm font-semibold text-gray-900 dark:text-white text-right",children:(e=>{if(!e)return"0h 0m";const s=Math.floor(e/3600),t=Math.floor(e%3600/60);return 0===s?`${t}m`:0===t?`${s}h`:`${s}h ${t}m`})(d.totalWatchTime)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(p,{className:"h-4 w-4 text-green-500 flex-shrink-0"}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:"Completed Sessions"})]}),e.jsx("span",{className:"text-xs sm:text-sm font-semibold text-gray-900 dark:text-white",children:d.completedSessions||0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(y,{className:"h-4 w-4 text-purple-500 flex-shrink-0"}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:"Total Recordings"})]}),e.jsx("span",{className:"text-xs sm:text-sm font-semibold text-gray-900 dark:text-white",children:d.totalRecordings||0})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(b,{className:"h-4 w-4 text-orange-500 flex-shrink-0"}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:"Scheduled Sessions"})]}),e.jsx("span",{className:"text-xs sm:text-sm font-semibold text-gray-900 dark:text-white",children:d.scheduledSessions||0})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 shadow-lg border border-gray-200 dark:border-gray-700 lg:col-span-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(m,{className:"h-5 w-5 text-purple-500"}),e.jsxs("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white",children:["Growth Metrics (",S.replace("days"," days"),")"]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-1 xl:grid-cols-3 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 sm:w-14 sm:h-14 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-2",children:e.jsx(w,{className:"h-5 w-5 sm:h-6 sm:w-6 text-green-600 dark:text-green-400"})}),e.jsxs("p",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-white",children:["+",d.userGrowth||0]}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"New Users"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 sm:w-14 sm:h-14 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center mx-auto mb-2",children:e.jsx(p,{className:"h-5 w-5 sm:h-6 sm:w-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("p",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-white",children:["+",d.sessionGrowth||0]}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"New Sessions"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 sm:w-14 sm:h-14 bg-purple-100 dark:bg-purple-900/30 rounded-full flex items-center justify-center mx-auto mb-2",children:e.jsx(N,{className:"h-5 w-5 sm:h-6 sm:w-6 text-purple-600 dark:text-purple-400"})}),e.jsxs("p",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-white",children:[Math.round(d.completedSessions/Math.max(d.totalSessions,1)*100),"%"]}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Completion Rate"})]})]}),e.jsx("div",{className:"mt-4 sm:mt-6 pt-4 sm:pt-6 border-t border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-white",children:[Math.round(d.engagementRate||0),"%"]}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Engagement"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-white",children:["+",d.recordingGrowth||0]}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"New Recordings"})]})]})})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl p-4 sm:p-6 text-white",children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg sm:text-2xl font-bold",children:d.activeSessions||0}),e.jsx("p",{className:"text-xs sm:text-sm opacity-90",children:"Live Now"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg sm:text-2xl font-bold",children:d.activeStudents||0}),e.jsx("p",{className:"text-xs sm:text-sm opacity-90",children:"Active Students"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg sm:text-2xl font-bold",children:d.totalRecordings||0}),e.jsx("p",{className:"text-xs sm:text-sm opacity-90",children:"Recordings"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg sm:text-2xl font-bold",children:d.totalCourses?Math.round(d.totalUsers/d.totalCourses):0}),e.jsx("p",{className:"text-xs sm:text-sm opacity-90",children:"Users/Course"})]})]})})]})};export{k as default};
