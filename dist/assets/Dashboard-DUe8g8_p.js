var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,l=(t,r,s)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s,n=(e,t)=>{for(var r in t||(t={}))a.call(t,r)&&l(e,r,t[r]);if(s)for(var r of s(t))i.call(t,r)&&l(e,r,t[r]);return e},o=(e,s)=>t(e,r(s));import{a as c,b as d,n as u,i as h,c as m,t as g,f as x,r as p,g as f,s as b,e as v,h as y,S as w,k as j,l as N,m as k,o as R,p as S,u as C,j as P,L as T}from"./index-CI4zpFZI.js";import{a as O,r as I}from"./router-C3Im-STG.js";import{s as E}from"./utils-FV6rFRcL.js";import{u as Q}from"./userService-DSfDdgOB.js";import{s as L}from"./sessionService-CZ53Cjk9.js";import{r as F}from"./recordingService-DLOKybmB.js";import{c as U}from"./courseService-AQ5gPFVj.js";import{B as A}from"./Button-ye-G-80u.js";import{I as M}from"./Input-CA4gnFRs.js";import{u as $}from"./useTranslation-D7bftQm-.js";import{B as D,V as B,b as W,T as z,j as q,R as Y,A as J,d as K,k as V,l as _,U as G,C as H,m as X,n as Z,o as ee,a as te,p as re}from"./ui-BAjx5vmw.js";import"./vendor-BhyxaAfg.js";import"./firebase-BFqJWPH6.js";import"./utils-nJVaOoPq.js";var se=function(e){function t(t,r){var s;return(s=e.call(this)||this).client=t,s.options=r,s.trackedProps=[],s.selectError=null,s.bindMethods(),s.setOptions(r),s}c(t,e);var r=t.prototype;return r.bindMethods=function(){this.remove=this.remove.bind(this),this.refetch=this.refetch.bind(this)},r.onSubscribe=function(){1===this.listeners.length&&(this.currentQuery.addObserver(this),ae(this.currentQuery,this.options)&&this.executeFetch(),this.updateTimers())},r.onUnsubscribe=function(){this.listeners.length||this.destroy()},r.shouldFetchOnReconnect=function(){return ie(this.currentQuery,this.options,this.options.refetchOnReconnect)},r.shouldFetchOnWindowFocus=function(){return ie(this.currentQuery,this.options,this.options.refetchOnWindowFocus)},r.destroy=function(){this.listeners=[],this.clearTimers(),this.currentQuery.removeObserver(this)},r.setOptions=function(e,t){var r=this.options,s=this.currentQuery;if(this.options=this.client.defaultQueryObserverOptions(e),void 0!==this.options.enabled&&"boolean"!=typeof this.options.enabled)throw new Error("Expected enabled to be a boolean");this.options.queryKey||(this.options.queryKey=r.queryKey),this.updateQuery();var a=this.hasListeners();a&&le(this.currentQuery,s,this.options,r)&&this.executeFetch(),this.updateResult(t),!a||this.currentQuery===s&&this.options.enabled===r.enabled&&this.options.staleTime===r.staleTime||this.updateStaleTimeout();var i=this.computeRefetchInterval();!a||this.currentQuery===s&&this.options.enabled===r.enabled&&i===this.currentRefetchInterval||this.updateRefetchInterval(i)},r.getOptimisticResult=function(e){var t=this.client.defaultQueryObserverOptions(e),r=this.client.getQueryCache().build(this.client,t);return this.createResult(r,t)},r.getCurrentResult=function(){return this.currentResult},r.trackResult=function(e,t){var r=this,s={},a=function(e){r.trackedProps.includes(e)||r.trackedProps.push(e)};return Object.keys(e).forEach(function(t){Object.defineProperty(s,t,{configurable:!1,enumerable:!0,get:function(){return a(t),e[t]}})}),(t.useErrorBoundary||t.suspense)&&a("error"),s},r.getNextResult=function(e){var t=this;return new Promise(function(r,s){var a=t.subscribe(function(t){t.isFetching||(a(),t.isError&&(null==e?void 0:e.throwOnError)?s(t.error):r(t))})})},r.getCurrentQuery=function(){return this.currentQuery},r.remove=function(){this.client.getQueryCache().remove(this.currentQuery)},r.refetch=function(e){return this.fetch(d({},e,{meta:{refetchPage:null==e?void 0:e.refetchPage}}))},r.fetchOptimistic=function(e){var t=this,r=this.client.defaultQueryObserverOptions(e),s=this.client.getQueryCache().build(this.client,r);return s.fetch().then(function(){return t.createResult(s,r)})},r.fetch=function(e){var t=this;return this.executeFetch(e).then(function(){return t.updateResult(),t.currentResult})},r.executeFetch=function(e){this.updateQuery();var t=this.currentQuery.fetch(this.options,e);return(null==e?void 0:e.throwOnError)||(t=t.catch(u)),t},r.updateStaleTimeout=function(){var e=this;if(this.clearStaleTimeout(),!h&&!this.currentResult.isStale&&m(this.options.staleTime)){var t=g(this.currentResult.dataUpdatedAt,this.options.staleTime)+1;this.staleTimeoutId=setTimeout(function(){e.currentResult.isStale||e.updateResult()},t)}},r.computeRefetchInterval=function(){var e;return"function"==typeof this.options.refetchInterval?this.options.refetchInterval(this.currentResult.data,this.currentQuery):null!=(e=this.options.refetchInterval)&&e},r.updateRefetchInterval=function(e){var t=this;this.clearRefetchInterval(),this.currentRefetchInterval=e,!h&&!1!==this.options.enabled&&m(this.currentRefetchInterval)&&0!==this.currentRefetchInterval&&(this.refetchIntervalId=setInterval(function(){(t.options.refetchIntervalInBackground||x.isFocused())&&t.executeFetch()},this.currentRefetchInterval))},r.updateTimers=function(){this.updateStaleTimeout(),this.updateRefetchInterval(this.computeRefetchInterval())},r.clearTimers=function(){this.clearStaleTimeout(),this.clearRefetchInterval()},r.clearStaleTimeout=function(){this.staleTimeoutId&&(clearTimeout(this.staleTimeoutId),this.staleTimeoutId=void 0)},r.clearRefetchInterval=function(){this.refetchIntervalId&&(clearInterval(this.refetchIntervalId),this.refetchIntervalId=void 0)},r.createResult=function(e,t){var r,s=this.currentQuery,a=this.options,i=this.currentResult,l=this.currentResultState,n=this.currentResultOptions,o=e!==s,c=o?e.state:this.currentQueryInitialState,d=o?this.currentResult:this.previousQueryResult,u=e.state,h=u.dataUpdatedAt,m=u.error,g=u.errorUpdatedAt,x=u.isFetching,b=u.status,v=!1,y=!1;if(t.optimisticResults){var w=this.hasListeners(),j=!w&&ae(e,t),N=w&&le(e,s,t,a);(j||N)&&(x=!0,h||(b="loading"))}if(t.keepPreviousData&&!u.dataUpdateCount&&(null==d?void 0:d.isSuccess)&&"error"!==b)r=d.data,h=d.dataUpdatedAt,b=d.status,v=!0;else if(t.select&&void 0!==u.data)if(i&&u.data===(null==l?void 0:l.data)&&t.select===this.selectFn)r=this.selectResult;else try{this.selectFn=t.select,r=t.select(u.data),!1!==t.structuralSharing&&(r=p(null==i?void 0:i.data,r)),this.selectResult=r,this.selectError=null}catch(R){f().error(R),this.selectError=R}else r=u.data;if(void 0!==t.placeholderData&&void 0===r&&("loading"===b||"idle"===b)){var k;if((null==i?void 0:i.isPlaceholderData)&&t.placeholderData===(null==n?void 0:n.placeholderData))k=i.data;else if(k="function"==typeof t.placeholderData?t.placeholderData():t.placeholderData,t.select&&void 0!==k)try{k=t.select(k),!1!==t.structuralSharing&&(k=p(null==i?void 0:i.data,k)),this.selectError=null}catch(R){f().error(R),this.selectError=R}void 0!==k&&(b="success",r=k,y=!0)}return this.selectError&&(m=this.selectError,r=this.selectResult,g=Date.now(),b="error"),{status:b,isLoading:"loading"===b,isSuccess:"success"===b,isError:"error"===b,isIdle:"idle"===b,data:r,dataUpdatedAt:h,error:m,errorUpdatedAt:g,failureCount:u.fetchFailureCount,errorUpdateCount:u.errorUpdateCount,isFetched:u.dataUpdateCount>0||u.errorUpdateCount>0,isFetchedAfterMount:u.dataUpdateCount>c.dataUpdateCount||u.errorUpdateCount>c.errorUpdateCount,isFetching:x,isRefetching:x&&"loading"!==b,isLoadingError:"error"===b&&0===u.dataUpdatedAt,isPlaceholderData:y,isPreviousData:v,isRefetchError:"error"===b&&0!==u.dataUpdatedAt,isStale:ne(e,t),refetch:this.refetch,remove:this.remove}},r.shouldNotifyListeners=function(e,t){if(!t)return!0;var r=this.options,s=r.notifyOnChangeProps,a=r.notifyOnChangePropsExclusions;if(!s&&!a)return!0;if("tracked"===s&&!this.trackedProps.length)return!0;var i="tracked"===s?this.trackedProps:s;return Object.keys(e).some(function(r){var s=r,l=e[s]!==t[s],n=null==i?void 0:i.some(function(e){return e===r}),o=null==a?void 0:a.some(function(e){return e===r});return l&&!o&&(!i||n)})},r.updateResult=function(e){var t=this.currentResult;if(this.currentResult=this.createResult(this.currentQuery,this.options),this.currentResultState=this.currentQuery.state,this.currentResultOptions=this.options,!b(this.currentResult,t)){var r={cache:!0};!1!==(null==e?void 0:e.listeners)&&this.shouldNotifyListeners(this.currentResult,t)&&(r.listeners=!0),this.notify(d({},r,e))}},r.updateQuery=function(){var e=this.client.getQueryCache().build(this.client,this.options);if(e!==this.currentQuery){var t=this.currentQuery;this.currentQuery=e,this.currentQueryInitialState=e.state,this.previousQueryResult=this.currentResult,this.hasListeners()&&(null==t||t.removeObserver(this),e.addObserver(this))}},r.onQueryUpdate=function(e){var t={};"success"===e.type?t.onSuccess=!0:"error"!==e.type||v(e.error)||(t.onError=!0),this.updateResult(t),this.hasListeners()&&this.updateTimers()},r.notify=function(e){var t=this;y.batch(function(){e.onSuccess?(null==t.options.onSuccess||t.options.onSuccess(t.currentResult.data),null==t.options.onSettled||t.options.onSettled(t.currentResult.data,null)):e.onError&&(null==t.options.onError||t.options.onError(t.currentResult.error),null==t.options.onSettled||t.options.onSettled(void 0,t.currentResult.error)),e.listeners&&t.listeners.forEach(function(e){e(t.currentResult)}),e.cache&&t.client.getQueryCache().notify({query:t.currentQuery,type:"observerResultsUpdated"})})},t}(w);function ae(e,t){return function(e,t){return!(!1===t.enabled||e.state.dataUpdatedAt||"error"===e.state.status&&!1===t.retryOnMount)}(e,t)||e.state.dataUpdatedAt>0&&ie(e,t,t.refetchOnMount)}function ie(e,t,r){if(!1!==t.enabled){var s="function"==typeof r?r(e):r;return"always"===s||!1!==s&&ne(e,t)}return!1}function le(e,t,r,s){return!1!==r.enabled&&(e!==t||!1===s.enabled)&&(!r.suspense||"error"!==e.state.status)&&ne(e,r)}function ne(e,t){return e.isStaleByTime(t.staleTime)}var oe=function(e){function t(t,r){return e.call(this,t,r)||this}c(t,e);var r=t.prototype;return r.bindMethods=function(){e.prototype.bindMethods.call(this),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)},r.setOptions=function(t,r){e.prototype.setOptions.call(this,d({},t,{behavior:j()}),r)},r.getOptimisticResult=function(t){return t.behavior=j(),e.prototype.getOptimisticResult.call(this,t)},r.fetchNextPage=function(e){var t;return this.fetch({cancelRefetch:null==(t=null==e?void 0:e.cancelRefetch)||t,throwOnError:null==e?void 0:e.throwOnError,meta:{fetchMore:{direction:"forward",pageParam:null==e?void 0:e.pageParam}}})},r.fetchPreviousPage=function(e){var t;return this.fetch({cancelRefetch:null==(t=null==e?void 0:e.cancelRefetch)||t,throwOnError:null==e?void 0:e.throwOnError,meta:{fetchMore:{direction:"backward",pageParam:null==e?void 0:e.pageParam}}})},r.createResult=function(t,r){var s,a,i,l,n,o,c=t.state,u=e.prototype.createResult.call(this,t,r);return d({},u,{fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:k(r,null==(s=c.data)?void 0:s.pages),hasPreviousPage:N(r,null==(a=c.data)?void 0:a.pages),isFetchingNextPage:c.isFetching&&"forward"===(null==(i=c.fetchMeta)||null==(l=i.fetchMore)?void 0:l.direction),isFetchingPreviousPage:c.isFetching&&"backward"===(null==(n=c.fetchMeta)||null==(o=n.fetchMore)?void 0:o.direction)})},t}(se);var ce,de=O.createContext((ce=!1,{clearReset:function(){ce=!1},reset:function(){ce=!0},isReset:function(){return ce}}));function ue(e,t){var r=O.useRef(!1),s=O.useState(0)[1],a=R(),i=O.useContext(de),l=a.defaultQueryObserverOptions(e);l.optimisticResults=!0,l.onError&&(l.onError=y.batchCalls(l.onError)),l.onSuccess&&(l.onSuccess=y.batchCalls(l.onSuccess)),l.onSettled&&(l.onSettled=y.batchCalls(l.onSettled)),l.suspense&&("number"!=typeof l.staleTime&&(l.staleTime=1e3),0===l.cacheTime&&(l.cacheTime=1)),(l.suspense||l.useErrorBoundary)&&(i.isReset()||(l.retryOnMount=!1));var n=O.useState(function(){return new t(a,l)})[0],o=n.getOptimisticResult(l);if(O.useEffect(function(){r.current=!0,i.clearReset();var e=n.subscribe(y.batchCalls(function(){r.current&&s(function(e){return e+1})}));return n.updateResult(),function(){r.current=!1,e()}},[i,n]),O.useEffect(function(){n.setOptions(l,{listeners:!1})},[l,n]),l.suspense&&o.isLoading)throw n.fetchOptimistic(l).then(function(e){var t=e.data;null==l.onSuccess||l.onSuccess(t),null==l.onSettled||l.onSettled(t,null)}).catch(function(e){i.clearReset(),null==l.onError||l.onError(e),null==l.onSettled||l.onSettled(void 0,e)});if(o.isError&&!i.isReset()&&!o.isFetching&&E(l.suspense,l.useErrorBoundary,[o.error,n.getCurrentQuery()]))throw o.error;return"tracked"===l.notifyOnChangeProps&&(o=n.trackResult(o,l)),o}function he(e,t,r){return ue(S(e,t,r),se)}const me=[{value:"createdAt",label:"Date Added"},{value:"title",label:"Title"},{value:"duration",label:"Duration"},{value:"views",label:"Popularity"},{value:"rating",label:"Rating"}],ge=[{value:"all",label:"All Categories"},{value:"lecture",label:"Lectures"},{value:"tutorial",label:"Tutorials"},{value:"workshop",label:"Workshops"},{value:"qna",label:"Q&A Sessions"}],xe=[{value:"all",label:"All Status"},{value:"new",label:"New"},{value:"watched",label:"Watched"},{value:"completed",label:"Completed"},{value:"processing",label:"Processing"}],pe=e=>{if(!e)return"0:00";const t=Math.floor(e/3600),r=Math.floor(e%3600/60),s=Math.floor(e%60);return t>0?`${t}:${r.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`:`${r}:${s.toString().padStart(2,"0")}`},fe=e=>{switch(e){case"completed":return"from-green-500 to-emerald-500";case"processing":return"from-yellow-500 to-orange-500";case"recording":return"from-blue-500 to-cyan-500";case"failed":return"from-red-500 to-pink-500";default:return"from-gray-500 to-gray-600"}},be=e=>e>=90?"from-green-500 to-emerald-500":e>=50?"from-yellow-500 to-orange-500":"from-blue-500 to-cyan-500",ve=O.memo(({recording:e,onWatch:t,actionLoading:r,getTeacherName:s,teachers:a})=>{var i;const l=(e=>{switch(e){case"completed":return Z;case"processing":return H;case"recording":return X;case"failed":return re;default:return B}})(e.status),n=e.progress||(e.watched?100:0),o=e.instructorName||s(e.instructorId);return P.jsx("div",{className:"group bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-3xl border border-white/30 dark:border-gray-700/40 p-6 shadow-2xl hover:shadow-2xl transition-all duration-300 hover:scale-105",children:P.jsxs("div",{className:"flex items-start justify-between",children:[P.jsxs("div",{className:"flex items-start space-x-4 flex-1 min-w-0",children:[P.jsx("div",{className:`p-3 rounded-2xl bg-gradient-to-br ${fe(e.status)}`,children:P.jsx(l,{className:"h-6 w-6 text-white"})}),P.jsxs("div",{className:"flex-1 min-w-0",children:[P.jsxs("div",{className:"flex items-start justify-between mb-2",children:[P.jsxs("h4",{className:"font-semibold text-gray-900 dark:text-white text-lg line-clamp-1 flex-1",children:[e.title,e.meetLink&&P.jsx("span",{className:"ml-2 px-2 py-1 text-xs bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300 rounded-full",children:"Google Meet"})]}),P.jsxs("div",{className:"flex items-center space-x-2 ml-3",children:[e.watched&&P.jsx(Z,{className:"h-4 w-4 text-green-500"}),e.isFeatured&&P.jsx(ee,{className:"h-4 w-4 text-yellow-500 fill-current"})]})]}),P.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm mb-3 line-clamp-2",children:e.description||"No description provided"}),P.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-600 dark:text-gray-400 mb-3",children:[o&&P.jsxs("span",{className:"flex items-center",children:[P.jsx(G,{className:"h-3 w-3 mr-1"}),o]}),e.category&&P.jsx("span",{className:"px-2 py-1 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300",children:e.category})]}),P.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-600 dark:text-gray-400",children:[P.jsxs("span",{className:"flex items-center",children:[P.jsx(te,{className:"h-3 w-3 mr-1"}),e.views||0," views"]}),P.jsxs("span",{className:"flex items-center",children:[P.jsx(H,{className:"h-3 w-3 mr-1"}),pe(e.duration)]}),e.averageRating>0&&P.jsxs("span",{className:"flex items-center",children:[P.jsx(ee,{className:"h-3 w-3 mr-1 text-yellow-500 fill-current"}),e.averageRating.toFixed(1)]}),P.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium capitalize "+("completed"===e.status?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300":"processing"===e.status?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300":"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300"),children:e.status})]}),n>0&&n<100&&P.jsxs("div",{className:"mt-3",children:[P.jsxs("div",{className:"flex justify-between text-xs text-gray-600 dark:text-gray-400 mb-1",children:[P.jsx("span",{children:"Progress"}),P.jsxs("span",{children:[n,"%"]})]}),P.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:P.jsx("div",{className:`h-2 rounded-full bg-gradient-to-r ${be(n)} transition-all duration-500`,style:{width:`${n}%`}})})]}),e.tags&&e.tags.length>0&&P.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[e.tags.slice(0,3).map((t,r)=>P.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300",children:t},`tag-${e.id}-${r}`)),e.tags.length>3&&P.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400",children:["+",e.tags.length-3," more"]})]})]})]}),P.jsx("div",{className:"flex space-x-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 ml-4",children:P.jsxs(A,{size:"sm",onClick:()=>t(e),disabled:r[e.id],className:"bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600",children:[r[e.id]?P.jsx(T,{size:"sm",className:"mr-1"}):P.jsx(X,{className:"h-3 w-3 mr-1"}),(null==(i=e.recordingUrl)?void 0:i.includes("drive.google.com"))?"Watch on Drive":"Watch"]})})]})})}),ye=O.memo(({session:e,onJoin:t,getTeacherName:r,teachers:s,type:a="teacher"})=>{const i=(e=>{if(!e)return{date:"TBD",time:"",full:"TBD"};const t=new Date(e);return{date:t.toLocaleDateString(),time:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),full:t.toLocaleString()}})(e.scheduledTime),l=r(e.createdBy);return P.jsxs("div",{className:"flex items-center p-3 rounded-2xl bg-white/50 dark:bg-gray-700/50 backdrop-blur-lg border border-white/40 dark:border-gray-600/40 hover:bg-white/80 dark:hover:bg-gray-600/80 transition-all duration-200 group cursor-pointer",onClick:()=>t(e),children:[P.jsxs("div",{className:"flex-1 min-w-0",children:[P.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:e.topic||e.title||"Untitled Session"}),"teacher"===a&&P.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[P.jsx(G,{className:"h-3 w-3 text-gray-500"}),P.jsx("p",{className:"text-xs text-gray-700 dark:text-gray-300 truncate",children:l})]}),P.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[P.jsx(H,{className:"h-3 w-3 text-gray-500"}),P.jsxs("p",{className:"text-xs text-gray-700 dark:text-gray-300",children:[i.date," at ",i.time]})]})]}),P.jsxs("div",{className:"flex items-center space-x-2",children:[P.jsx("div",{className:"w-2 h-2 rounded-full animate-pulse "+("teacher"===a?"bg-green-500":"bg-red-500")}),P.jsx(X,{className:"h-4 w-4 text-green-500 opacity-0 group-hover:opacity-100 transition-opacity"})]})]})}),we=()=>{var e,t,r;const{t:s}=$(),{user:a,userProfile:i,loading:l}=C(),[c,d]=I.useState(""),[u,h]=I.useState("all"),[m,g]=I.useState("all"),[x,p]=I.useState("all"),[f,b]=I.useState("createdAt"),[v,y]=I.useState("desc"),[w,j]=I.useState({}),[N,k]=I.useState(!1),R=null==a?void 0:a.uid,O=null==i?void 0:i.isActive,E=(null==i?void 0:i.displayName)||(null==(e=null==a?void 0:a.email)?void 0:e.split("@")[0]),{data:G,isLoading:H}=he(["studentSessions",R],async()=>{const[e,t]=await Promise.all([L.getPublicSessions({status:"scheduled",dateRange:"upcoming",limit:10}),L.getTeacherSessionsForStudents({limit:20,daysAhead:30})]);return{recentSessions:e,teacherSessions:t}},{enabled:!!R&&O,staleTime:3e5,refetchOnWindowFocus:!1}),X=(null==G?void 0:G.recentSessions)||[],Z=(null==G?void 0:G.teacherSessions)||[],{data:ee,fetchNextPage:te,hasNextPage:re,isFetchingNextPage:se,isLoading:ae,error:ie,refetch:le,isRefetching:ne}=ue(S(["studentRecordings",R,f,v],({pageParam:e=null})=>F.getAvailableRecordings({studentId:R,cursor:e,limit:12,sortBy:f,sortOrder:v}),{getNextPageParam:e=>e.nextCursor||void 0,enabled:!!R&&O,retry:2,staleTime:3e5,refetchOnWindowFocus:!1}),oe);const{data:ce=[],isLoading:de,error:pe}=he(["studentCourses",R],()=>U.getPublishedCourses(20),{enabled:!!R&&O,staleTime:6e5}),{data:fe=[],isLoading:be,error:we}=he(["teachers"],()=>Q.getAllUsers({role:"teacher",status:"active"}),{enabled:!!R&&O,select:e=>e.filter(e=>"teacher"===e.role&&e.isActive)}),je=(null==ee?void 0:ee.pages.flatMap(e=>e.recordings||[]))||[],Ne=I.useMemo(()=>{if(!je.length)return[];let e=je;if(c){const t=c.toLowerCase();e=e.filter(e=>{var r,s,a,i;return(null==(r=e.title)?void 0:r.toLowerCase().includes(t))||(null==(s=e.description)?void 0:s.toLowerCase().includes(t))||(null==(a=e.tags)?void 0:a.some(e=>e.toLowerCase().includes(t)))||(null==(i=e.instructorName)?void 0:i.toLowerCase().includes(t))})}return"all"!==u&&(e=e.filter(e=>e.status===u||"watched"===u&&e.watched||"new"===u&&!e.watched)),"all"!==m&&(e=e.filter(e=>e.category===m)),"all"!==x&&(e=e.filter(e=>e.instructorId===x)),e.sort((e,t)=>{let r=e[f]||0,s=t[f]||0;return"createdAt"!==f&&"updatedAt"!==f&&"scheduledTime"!==f||(r=new Date(r).getTime(),s=new Date(s).getTime()),"desc"===v?s-r:r-s})},[je,c,u,m,x,f,v]),ke=I.useMemo(()=>"all"===x?Z:Z.filter(e=>e.createdBy===x),[Z,x]),Re=I.useMemo(()=>{const e=je.filter(e=>e.watched).length,t=je.length>0?Math.round(e/je.length*100):0;return{enrolledClasses:ce.length,availableRecordings:je.filter(e=>e.isPublished&&"completed"===e.status).length,teachers:fe.length,totalWatchTime:je.reduce((e,t)=>e+(t.duration||0),0),completedRecordings:e,upcomingSessions:X.length,teacherUpcomingSessions:ke.length,googleMeetSessions:je.filter(e=>e.meetLink).length,totalProgress:t}},[ce,je,fe,X,ke]),Se=I.useCallback(e=>{var t;const r=fe.find(t=>t.uid===e);return(null==r?void 0:r.displayName)||(null==(t=null==r?void 0:r.email)?void 0:t.split("@")[0])||"Unknown Teacher"},[fe]),Ce=I.useCallback(()=>{le()},[le]),Pe=I.useCallback(e=>{e.recordingUrl&&(j(t=>o(n({},t),{[e.id]:!0})),e.recordingUrl.includes("drive.google.com")&&window.open(e.recordingUrl,"_blank"),setTimeout(()=>{j(t=>o(n({},t),{[e.id]:!1}))},1e3))},[]),Te=I.useCallback(e=>{(e.meetLink||e.googleMeetLink)&&window.open(e.meetLink||e.googleMeetLink,"_blank")},[]),Oe=I.useMemo(()=>[{id:"enrolled-classes",name:"Enrolled Classes",value:Re.enrolledClasses.toString(),icon:D,change:`${ce.filter(e=>e.isPublished).length} active`,changeType:"positive",color:"from-blue-500 to-cyan-500",bgColor:"from-blue-500/10 to-cyan-500/10",description:"Your learning journey",loading:de},{id:"available-recordings",name:"Available Recordings",value:Re.availableRecordings.toString(),icon:B,change:`${Re.completedRecordings} watched`,changeType:Re.completedRecordings>0?"positive":"neutral",color:"from-green-500 to-emerald-500",bgColor:"from-green-500/10 to-emerald-500/10",description:"Ready to watch",loading:ae},{id:"teachers",name:"Teachers",value:Re.teachers.toString(),icon:W,change:`${Re.teacherUpcomingSessions} upcoming`,changeType:"neutral",color:"from-purple-500 to-pink-500",bgColor:"from-purple-500/10 to-pink-500/10",description:"Expert instructors",loading:be},{id:"learning-progress",name:"Learning Progress",value:`${Re.totalProgress}%`,icon:z,change:`${Math.round(Re.totalWatchTime/3600)} hours watched`,changeType:Re.totalProgress>50?"positive":"neutral",color:"from-orange-500 to-red-500",bgColor:"from-orange-500/10 to-red-500/10",description:"Your overall progress",loading:ae}],[Re,ce,de,ae,be]),Ie=I.useMemo(()=>[{value:"all",label:"All Teachers"},...fe.map(e=>{var t;return{value:e.uid,label:e.displayName||(null==(t=e.email)?void 0:t.split("@")[0])||"Unknown Teacher"}})],[fe]),Ee=ie||pe||we;return l?P.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-50 via-white to-cyan-50 dark:from-gray-900 dark:via-gray-800 dark:to-blue-900",children:P.jsxs("div",{className:"text-center",children:[P.jsx(T,{size:"lg"}),P.jsx("p",{className:"mt-3 text-sm text-gray-500 dark:text-gray-400",children:"Loading your dashboard..."})]})}):R?O?P.jsxs("div",{className:"space-y-6 sm:space-y-8 p-4 sm:p-6 lg:p-8 bg-gradient-to-br from-blue-50 via-white to-cyan-50 dark:from-gray-900 dark:via-gray-800 dark:to-blue-900 min-h-screen",children:[P.jsx("div",{className:"text-center lg:text-left",children:P.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[P.jsxs("div",{children:[P.jsx("h1",{className:"text-3xl sm:text-4xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-cyan-600 bg-clip-text text-transparent mb-2 sm:mb-3",children:"Student Dashboard"}),P.jsx("p",{className:"text-base sm:text-lg text-gray-700 dark:text-gray-300 max-w-2xl",children:"Access your classes, recordings, and learning materials"}),E&&P.jsxs("div",{className:"flex items-center mt-2 space-x-2",children:[P.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Welcome back, ",P.jsx("span",{className:"font-semibold text-gray-800 dark:text-gray-200",children:E})]}),"premium"===(null==(t=null==i?void 0:i.subscription)?void 0:t.plan)&&P.jsxs("span",{className:"px-2 py-1 text-xs bg-gradient-to-r from-yellow-500 to-orange-500 text-white rounded-full flex items-center",children:[P.jsx(q,{className:"h-3 w-3 mr-1"}),"Premium Student"]})]})]}),P.jsxs("div",{className:"flex items-center gap-3",children:[P.jsxs(A,{onClick:Ce,variant:"outline",disabled:ne,className:"hidden lg:flex items-center",children:[P.jsx(Y,{className:"h-4 w-4 mr-2 "+(ne?"animate-spin":"")}),"Refresh"]}),P.jsxs(A,{onClick:()=>window.location.href="/courses",className:"bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 shadow-lg",children:[P.jsx(D,{className:"h-4 w-4 mr-2"}),"Browse Classes"]})]})]})}),Ee&&P.jsxs("div",{className:"bg-red-50/80 dark:bg-red-900/30 backdrop-blur-lg border border-red-200/50 dark:border-red-800/50 rounded-2xl p-4 flex items-center",children:[P.jsx(J,{className:"h-5 w-5 text-red-500 mr-3 flex-shrink-0"}),P.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm flex-1",children:"Failed to load content. Please try refreshing."}),P.jsx("button",{onClick:Ce,className:"ml-4 text-red-500 hover:text-red-700 flex-shrink-0",children:P.jsx(Y,{className:"h-4 w-4"})})]}),P.jsx("div",{className:"grid grid-cols-1 gap-4 sm:gap-6 sm:grid-cols-2 xl:grid-cols-4",children:Oe.map(e=>{const t=e.icon;return P.jsxs("div",{className:"group relative overflow-hidden rounded-3xl bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl border border-white/30 dark:border-gray-700/40 p-4 sm:p-6 shadow-2xl hover:shadow-2xl transition-all duration-500 hover:scale-105",children:[P.jsx("div",{className:`absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-500 bg-gradient-to-br ${e.bgColor} rounded-3xl`}),P.jsxs("div",{className:"relative z-10",children:[P.jsxs("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:[P.jsx("div",{className:`p-2 sm:p-3 rounded-2xl bg-gradient-to-br ${e.color} shadow-lg`,children:P.jsx(t,{className:"h-5 w-5 sm:h-6 sm:w-6 text-white"})}),P.jsxs("div",{className:"flex items-center space-x-1",children:["positive"===e.changeType&&P.jsx(z,{className:"h-4 w-4 text-green-500"}),P.jsx("div",{className:"text-xs sm:text-sm font-semibold "+("positive"===e.changeType?"text-green-600 dark:text-green-400":"text-gray-600 dark:text-gray-400"),children:e.change})]})]}),e.loading?P.jsxs("div",{className:"animate-pulse",children:[P.jsx("div",{className:"h-7 sm:h-8 bg-gray-300 dark:bg-gray-600 rounded mb-2"}),P.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded"})]}):P.jsxs(P.Fragment,{children:[P.jsx("h3",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white mb-1 sm:mb-2",children:e.value}),P.jsx("p",{className:"text-sm font-medium text-gray-800 dark:text-gray-200 mb-1",children:e.name}),P.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:e.description})]})]})]},e.id)})}),P.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-4 gap-6 sm:gap-8",children:[P.jsxs("div",{className:"xl:col-span-1 space-y-6",children:[P.jsxs("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-3xl border border-white/30 dark:border-gray-700/40 p-4 sm:p-6 shadow-2xl hover:shadow-2xl transition-all duration-300",children:[P.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[P.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"Teacher Sessions"}),P.jsx(W,{className:"h-5 w-5 text-purple-500"})]}),P.jsxs("div",{className:"space-y-3",children:[ke.length>0?ke.slice(0,5).map(e=>P.jsx(ye,{session:e,onJoin:Te,getTeacherName:Se,teachers:fe,type:"teacher"},`teacher-session-${e.id}`)):P.jsxs("div",{className:"text-center py-4 text-gray-600 dark:text-gray-400",children:[P.jsx(W,{className:"mx-auto h-8 w-8 mb-2"}),P.jsx("p",{className:"text-sm",children:"No teacher sessions"}),P.jsx("p",{className:"text-xs mt-1",children:"Check back later for updates"})]}),ke.length>5&&P.jsx(A,{variant:"outline",size:"sm",className:"w-full mt-2",onClick:()=>window.location.href="/sessions?view=teachers",children:"View All Teacher Sessions"})]})]}),P.jsxs("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-3xl border border-white/30 dark:border-gray-700/40 p-4 sm:p-6 shadow-2xl hover:shadow-2xl transition-all duration-300",children:[P.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[P.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"Your Upcoming Sessions"}),P.jsx(K,{className:"h-5 w-5 text-blue-500"})]}),P.jsx("div",{className:"space-y-3",children:H?P.jsx("div",{className:"flex justify-center py-4",children:P.jsx(T,{size:"sm"})}):X.length>0?X.map(e=>P.jsx(ye,{session:e,onJoin:Te,getTeacherName:Se,teachers:fe,type:"recent"},`recent-session-${e.id}`)):P.jsxs("div",{className:"text-center py-4 text-gray-600 dark:text-gray-400",children:[P.jsx(K,{className:"mx-auto h-8 w-8 mb-2"}),P.jsx("p",{className:"text-sm",children:"No upcoming sessions"}),P.jsx(A,{variant:"outline",size:"sm",className:"mt-2",onClick:()=>window.location.href="/sessions",children:"View All Sessions"})]})})]})]}),P.jsxs("div",{className:"xl:col-span-3 space-y-6",children:[P.jsx("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-3xl border border-white/30 dark:border-gray-700/40 p-4 sm:p-6 shadow-2xl",children:P.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center space-y-4 lg:space-y-0 lg:space-x-4",children:[P.jsx("div",{className:"flex-1",children:P.jsxs("div",{className:"relative",children:[P.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:P.jsx(V,{className:"h-4 w-4 text-gray-500"})}),P.jsx(M,{type:"text",className:"block w-full pl-10 pr-3 py-3 rounded-2xl bg-white/50 dark:bg-gray-700/50 border-white/40 dark:border-gray-600/40 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 dark:text-white",placeholder:"Search recordings by title, description, or instructor...",value:c,onChange:e=>d(e.target.value)})]})}),P.jsxs(A,{onClick:()=>k(!N),variant:"outline",className:"lg:hidden",children:[P.jsx(_,{className:"h-4 w-4 mr-2"}),"Filters"]}),P.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 "+(N?"flex":"hidden lg:flex"),children:[P.jsx("select",{className:"block w-full sm:w-auto px-3 py-3 text-sm rounded-2xl bg-white/50 dark:bg-gray-700/50 border-white/40 dark:border-gray-600/40 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:x,onChange:e=>p(e.target.value),children:Ie.map(e=>P.jsx("option",{value:e.value,children:e.label},`teacher-${e.value}`))}),P.jsx("select",{className:"block w-full sm:w-auto px-3 py-3 text-sm rounded-2xl bg-white/50 dark:bg-gray-700/50 border-white/40 dark:border-gray-600/40 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:m,onChange:e=>g(e.target.value),children:ge.map(e=>P.jsx("option",{value:e.value,children:e.label},`category-${e.value}`))}),P.jsx("select",{className:"block w-full sm:w-auto px-3 py-3 text-sm rounded-2xl bg-white/50 dark:bg-gray-700/50 border-white/40 dark:border-gray-600/40 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:u,onChange:e=>h(e.target.value),children:xe.map(e=>P.jsx("option",{value:e.value,children:e.label},`status-${e.value}`))}),P.jsx("select",{className:"block w-full sm:w-auto px-3 py-3 text-sm rounded-2xl bg-white/50 dark:bg-gray-700/50 border-white/40 dark:border-gray-600/40 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:f,onChange:e=>b(e.target.value),children:me.map(e=>P.jsx("option",{value:e.value,children:e.label},`sort-${e.value}`))}),P.jsx(A,{onClick:()=>y("desc"===v?"asc":"desc"),variant:"outline",className:"px-3",children:"desc"===v?"↓":"↑"}),P.jsx(A,{onClick:Ce,variant:"outline",disabled:ne,children:P.jsx(Y,{className:"h-4 w-4 "+(ne?"animate-spin":"")})})]})]})}),P.jsxs("div",{children:[P.jsxs("div",{className:"flex items-center justify-between mb-4",children:[P.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"Available Recordings"}),P.jsxs("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:[Ne.length," items",c&&` • matching "${c}"`,"all"!==x&&` • by ${null==(r=Ie.find(e=>e.value===x))?void 0:r.label}`]})]}),ae?P.jsx("div",{className:"flex justify-center items-center min-h-64 bg-white/50 dark:bg-gray-800/50 rounded-3xl border border-white/30 dark:border-gray-700/40",children:P.jsxs("div",{className:"text-center",children:[P.jsx(T,{size:"lg"}),P.jsx("p",{className:"mt-3 text-sm text-gray-600 dark:text-gray-400",children:"Loading recordings..."})]})}):Ne.length>0?P.jsxs(P.Fragment,{children:[P.jsx("div",{className:"grid grid-cols-1 gap-4 sm:gap-6",children:Ne.map(e=>P.jsx(ve,{recording:e,onWatch:Pe,actionLoading:w,getTeacherName:Se,teachers:fe},`recording-${e.id}`))}),re&&P.jsx("div",{className:"flex justify-center mt-8",children:P.jsx(A,{onClick:()=>te(),disabled:se,variant:"outline",className:"flex items-center",children:se?P.jsxs(P.Fragment,{children:[P.jsx(T,{size:"sm",className:"mr-2"}),"Loading more recordings..."]}):P.jsx(P.Fragment,{children:"Load More Recordings"})})})]}):P.jsxs("div",{className:"text-center py-12 bg-white/50 dark:bg-gray-800/50 rounded-3xl border border-white/30 dark:border-gray-700/40",children:[P.jsx(B,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),P.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:c||"all"!==u||"all"!==m||"all"!==x?"No matching recordings":"No recordings available"}),P.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6 max-w-md mx-auto",children:c||"all"!==u||"all"!==m||"all"!==x?"Try adjusting your search or filters.":"Enroll in a class to access recordings."}),P.jsxs(A,{onClick:()=>window.location.href="/courses",className:"bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600",children:[P.jsx(D,{className:"h-4 w-4 mr-2"}),"Browse Classes"]})]})]})]})]})]}):P.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-50 via-white to-cyan-50 dark:from-gray-900 dark:via-gray-800 dark:to-blue-900",children:P.jsxs("div",{className:"text-center max-w-md p-8",children:[P.jsx(D,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),P.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Pending Approval"}),P.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Your account is awaiting admin approval. You will be notified via email once approved."}),P.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-xl p-4",children:P.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:"Please contact the administrator if you have been waiting for more than 24 hours."})})]})}):P.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-50 via-white to-cyan-50 dark:from-gray-900 dark:via-gray-800 dark:to-blue-900",children:P.jsxs("div",{className:"text-center max-w-md p-8",children:[P.jsx(D,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),P.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Authentication Required"}),P.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Please log in to access the student dashboard."}),P.jsx(A,{onClick:()=>window.location.href="/login",className:"bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 shadow-lg",children:"Sign in"})]})})};export{we as default};
