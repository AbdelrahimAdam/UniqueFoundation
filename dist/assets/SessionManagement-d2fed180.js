import{j as e,L as s}from"./index-5767ddf8.js";import{r as t}from"./vendor-0a74ad82.js";import"./firebase-383b8577.js";import{s as r}from"./sessionService-6e8a4b4a.js";import{r as a}from"./recordingService-a3f82448.js";import{c as i}from"./courseService-495bf198.js";import{c as l,B as o}from"./Button-3bd6c448.js";import n from"./CreateSessionModal-576df8ec.js";import{C as d}from"./CreateRecordingModal-2d283263.js";import{u as c}from"./useTranslation-aa9b7537.js";import{U as m}from"./upload-ded68650.js";import{P as u}from"./plus-0f0e053e.js";import{R as x}from"./refresh-cw-c53519ba.js";import{S as g}from"./search-574a4b7f.js";import{C as h}from"./calendar-db1a81dc.js";import{V as p}from"./video-9bd5ab91.js";import{U as f}from"./users-499efd4b.js";import{P as j}from"./play-circle-c1f21b6b.js";import{E as y}from"./eye-b2ee8344.js";import{P as w}from"./pen-square-ef6ec0ae.js";import{C as b}from"./clock-7df3ab35.js";import{C as v}from"./check-circle-0b4512e8.js";import"./router-80e9042b.js";import"./index.esm-e04fd8e7.js";import"./Select-c7823c9b.js";import"./utils-db1934d6.js";import"./chevron-down-d5b28354.js";import"./alert-circle-b175e642.js";import"./check-290a7886.js";import"./camera-990b09b3.js";import"./x-231358ce.js";import"./file-text-55423f48.js";import"./link-3c8a4adf.js";import"./book-open-cf5b879f.js";import"./user-88eaccbf.js";import"./download-ee602c74.js";import"./external-link-81bc50d5.js";const k=l("FileVideo",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"m10 11 5 3-5 3v-6Z",key:"7ntvm4"}]]),N=l("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),S=()=>{c();const[l,b]=t.useState([]),[S,C]=t.useState([]),[R,L]=t.useState([]),[I,P]=t.useState(!0),[E,A]=t.useState(""),[F,B]=t.useState("all"),[z,M]=t.useState("all"),[T,U]=t.useState(!1),[D,V]=t.useState(!1),[$,G]=t.useState({}),[H,J]=t.useState(null);t.useEffect(()=>{O()},[]);const O=async()=>{try{P(!0);const[e,s,t]=await Promise.all([r.getAllSessions().catch(e=>[]),a.getAllRecordings().catch(e=>[]),i.getAllCourses().catch(e=>[])]),l=e.map(e=>({...e,collection:"sessions",isFromRecordingsCollection:!1})),o=s.filter(e=>e.meetLink||"scheduled"===e.status||"live"===e.status).map(e=>({...e,collection:"recordings",isFromRecordingsCollection:!0})),n=s.filter(e=>!e.meetLink&&("completed"===e.status||"recorded"===e.status)).map(e=>({...e,collection:"recordings",isFromRecordingsCollection:!1}));b([...l,...o]),C(n),L(t)}catch(e){}finally{P(!1)}},q=e=>{e.meetLink&&window.open(e.meetLink,"_blank")},_=async e=>{try{G(s=>({...s,[e]:!0}));const s=await a.getRecordingById(e);if(!s||!s.meetLink)throw new Error("Session not found in recordings collection");await r.createSession({meetLink:s.meetLink,title:s.title,description:s.description,scheduledTime:s.scheduledTime,duration:s.duration,category:s.category,visibility:s.visibility,maxParticipants:s.maxParticipants,courseId:s.courseId,enableRecording:s.enableRecording,status:s.status,recordingStatus:s.recordingStatus,isPublished:s.isPublished,instructorId:s.instructorId,instructorEmail:s.instructorEmail,instructorName:s.instructorName,createdBy:s.createdBy});await O()}catch(s){alert("Failed to migrate session: "+s.message)}finally{G(s=>({...s,[e]:!1}))}},K=l.filter(e=>{const s=e.title?.toLowerCase().includes(E.toLowerCase())||e.topic?.toLowerCase().includes(E.toLowerCase())||e.description?.toLowerCase().includes(E.toLowerCase())||e.instructorName?.toLowerCase().includes(E.toLowerCase()),t="all"===F||e.status===F;return s&&t}),Q=S.filter(e=>{const s=e.title?.toLowerCase().includes(E.toLowerCase())||e.description?.toLowerCase().includes(E.toLowerCase())||e.instructorName?.toLowerCase().includes(E.toLowerCase())||e.category?.toLowerCase().includes(E.toLowerCase()),t="all"===F||e.status===F;return s&&t}),W=e=>{switch(e){case"scheduled":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300";case"live":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300";case"completed":case"available":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300";case"recorded":return"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-300"}};if(I)return e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsx(s,{size:"lg"})});const Y="sessions"===z?K:"recordings"===z?Q:[...K,...Q],Z=l.filter(e=>"recordings"===e.collection),X=l.filter(e=>"sessions"===e.collection);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Session & Recording Management"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Manage Google Meet sessions and recordings"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs(o,{onClick:()=>{J(null),V(!0)},variant:"outline",className:"bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white",children:[e.jsx(m,{className:"h-4 w-4 mr-2"}),"Add Recording"]}),e.jsxs(o,{onClick:()=>{J(null),U(!0)},className:"bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600",children:[e.jsx(u,{className:"h-4 w-4 mr-2"}),"Schedule Session"]})]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:X.length}),e.jsx("div",{className:"text-sm text-blue-700 dark:text-blue-300",children:"Sessions in Sessions Collection"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600 dark:text-orange-400",children:Z.length}),e.jsx("div",{className:"text-sm text-orange-700 dark:text-orange-300",children:"Sessions in Recordings Collection"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600 dark:text-purple-400",children:S.length}),e.jsx("div",{className:"text-sm text-purple-700 dark:text-purple-300",children:"Standalone Recordings"})]})]}),Z.length>0&&e.jsxs(o,{onClick:()=>{window.confirm(`Migrate ${Z.length} sessions from recordings to sessions collection?`)&&Z.forEach(e=>{_(e.id)})},variant:"outline",className:"bg-orange-500 hover:bg-orange-600 text-white",children:[e.jsx(x,{className:"h-4 w-4 mr-2"}),"Migrate All Sessions"]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center space-y-4 lg:space-y-0 lg:space-x-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(g,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search sessions and recordings...",value:E,onChange:e=>A(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("select",{value:z,onChange:e=>M(e.target.value),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"sessions",children:"Sessions Only"}),e.jsx("option",{value:"recordings",children:"Recordings Only"})]}),e.jsxs("select",{value:F,onChange:e=>B(e.target.value),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"scheduled",children:"Scheduled"}),e.jsx("option",{value:"live",children:"Live"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"recorded",children:"Recorded"}),e.jsx("option",{value:"available",children:"Available"})]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:Y.map(t=>{const i=(e=>e.meetLink?"session":"recording")(t),n="session"===i,d="recording"===i;(e=>{switch(e){case"scheduled":return h;case"live":return j;case"completed":case"available":return v;case"recorded":return k;default:;}})(t.status);const c="live"===t.status,m="scheduled"===t.status,u=t.recordingUrl||t.isRecorded,g=t.isPublished,b=(e=>"recordings"===e.collection&&e.meetLink)(t);return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden hover:shadow-xl transition-all duration-300",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[n&&e.jsx(h,{className:"h-4 w-4 text-blue-500"}),d&&e.jsx(p,{className:"h-4 w-4 text-purple-500"}),e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${W(t.status)}`,children:[n?"Session":"Recording"," â€¢ ",t.status]}),!g&&e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300",children:"Draft"}),n&&b&&e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-300",children:"From Recordings"})]}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white text-lg line-clamp-2",children:t.title||t.topic}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm mt-1 line-clamp-2",children:t.description})]})}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(f,{className:"h-4 w-4 mr-1"}),t.instructorName||"Unknown"]}),t.scheduledTime&&e.jsxs("span",{className:"flex items-center",children:[e.jsx(h,{className:"h-4 w-4 mr-1"}),new Date(t.scheduledTime).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"space-y-3",children:[t.scheduledTime&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Time"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:new Date(t.scheduledTime).toLocaleTimeString()})]}),t.duration&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Duration"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[t.duration," min"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Recording"}),e.jsx("span",{className:"text-sm font-medium "+(u?"text-green-600 dark:text-green-400":"text-gray-500 dark:text-gray-400"),children:u?"Available":"Not available"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-6",children:[n&&c&&e.jsxs(o,{onClick:()=>q(t),className:"flex-1 bg-red-600 hover:bg-red-700 text-white",children:[e.jsx(j,{className:"h-4 w-4 mr-2"}),"Join Live"]}),n&&m&&e.jsxs(o,{onClick:()=>q(t),variant:"outline",className:"flex-1",children:[e.jsx(h,{className:"h-4 w-4 mr-2"}),"Join"]}),n&&!u&&"completed"===t.status&&e.jsxs(o,{onClick:()=>(async(e,s=!1)=>{const t=prompt("Enter Google Drive recording URL:");if(t)try{let i;if(G(s=>({...s,[e]:!0})),i=s?S.find(s=>s.id===e&&s.meetLink):l.find(s=>s.id===e),!i)throw new Error("Session not found");s?await a.updateRecording(e,{recordingUrl:t,isRecorded:!0,recordingStatus:"available",status:"completed"}):await r.markAsRecorded(e,t),await a.createRecording({title:`${i.title} - Recording`,description:`Recording of ${i.title}`,recordingUrl:t,duration:i.duration||60,fileSize:250,quality:"1080p",courseId:i.courseId,instructorId:i.instructorId,instructorEmail:i.instructorEmail,instructorName:i.instructorName,visibility:i.visibility||"public",category:i.category||"general",status:"recorded",recordingStatus:"available",isPublished:!0}),await O()}catch(i){alert("Failed to add recording: "+i.message)}finally{G(s=>({...s,[e]:!1}))}})(t.id,b),disabled:$[t.id],className:"flex-1 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600",children:[$[t.id]?e.jsx(s,{size:"sm",className:"mr-2"}):e.jsx(p,{className:"h-4 w-4 mr-2"}),"Add Recording"]}),u&&e.jsx("a",{href:t.recordingUrl,target:"_blank",rel:"noopener noreferrer",className:"flex-1",children:e.jsxs(o,{variant:"outline",className:"w-full",children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"View Recording"]})}),n&&e.jsxs(e.Fragment,{children:[m&&e.jsx(o,{onClick:()=>(async(e,s=!1)=>{try{if(G(s=>({...s,[e]:!0})),s)await a.updateRecording(e,{status:"live"});else if(await r.getSessionById(e))await r.updateSessionStatus(e,"live");else{const s=await a.getRecordingById(e);if(!s||!s.meetLink)throw new Error("Session not found in any collection");await a.updateRecording(e,{status:"live"})}await O()}catch(t){alert("Failed to start session: "+t.message)}finally{G(s=>({...s,[e]:!1}))}})(t.id,b),variant:"outline",size:"sm",children:"Start"}),c&&e.jsx(o,{onClick:()=>(async(e,s=!1)=>{try{if(G(s=>({...s,[e]:!0})),s)await a.updateRecording(e,{status:"completed"});else if(await r.getSessionById(e))await r.updateSessionStatus(e,"completed");else{const s=await a.getRecordingById(e);if(!s||!s.meetLink)throw new Error("Session not found in any collection");await a.updateRecording(e,{status:"completed"})}await O()}catch(t){alert("Failed to end session: "+t.message)}finally{G(s=>({...s,[e]:!1}))}})(t.id,b),variant:"outline",size:"sm",children:"End"}),g?e.jsx(o,{onClick:()=>(async(e,s=!1)=>{try{if(G(s=>({...s,[e]:!0})),s)await a.updateRecording(e,{isPublished:!1});else if(await r.getSessionById(e))await r.updateSession(e,{isPublished:!1});else{const s=await a.getRecordingById(e);if(!s||!s.meetLink)throw new Error("Session not found in any collection");await a.updateRecording(e,{isPublished:!1})}await O()}catch(t){alert("Failed to unpublish session: "+t.message)}finally{G(s=>({...s,[e]:!1}))}})(t.id,b),variant:"outline",size:"sm",children:"Unpublish"}):e.jsx(o,{onClick:()=>(async(e,s=!1)=>{try{if(G(s=>({...s,[e]:!0})),s)await a.updateRecording(e,{isPublished:!0});else if(await r.getSessionById(e))await r.updateSession(e,{isPublished:!0});else{const s=await a.getRecordingById(e);if(!s||!s.meetLink)throw new Error("Session not found in any collection");await a.updateRecording(e,{isPublished:!0})}await O()}catch(t){alert("Failed to publish session: "+t.message)}finally{G(s=>({...s,[e]:!1}))}})(t.id,b),variant:"outline",size:"sm",children:"Publish"})]}),n&&b&&e.jsxs(o,{onClick:()=>_(t.id),disabled:$[t.id],variant:"outline",size:"sm",className:"text-orange-600 hover:text-orange-700 hover:bg-orange-50 dark:hover:bg-orange-900/20",children:[$[t.id]?e.jsx(s,{size:"sm",className:"mr-1"}):e.jsx(x,{className:"h-4 w-4 mr-1"}),"Migrate"]}),e.jsx(o,{onClick:()=>n?(J(t),void U(!0)):(J(t),void V(!0)),variant:"outline",size:"sm",children:e.jsx(w,{className:"h-4 w-4"})}),e.jsx(o,{onClick:()=>n?(async(e,s=!1)=>{if(window.confirm("Are you sure you want to delete this session?"))try{G(s=>({...s,[e]:!0})),s?await a.deleteRecording(e):await r.deleteSession(e),await O()}catch(t){alert("Failed to delete session: "+t.message)}finally{G(s=>({...s,[e]:!1}))}})(t.id,b):(async e=>{if(window.confirm("Are you sure you want to delete this recording?"))try{G(s=>({...s,[e]:!0})),await a.deleteRecording(e),await O()}catch(s){alert("Failed to delete recording: "+s.message)}finally{G(s=>({...s,[e]:!1}))}})(t.id),variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20",children:e.jsx(N,{className:"h-4 w-4"})})]})]})]},t.id)})}),0===Y.length&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(p,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"No sessions or recordings found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:E||"all"!==F||"all"!==z?"Try adjusting your search or filters":"Get started by scheduling your first session or adding a recording"}),e.jsxs("div",{className:"flex justify-center space-x-3",children:[e.jsxs(o,{onClick:()=>V(!0),variant:"outline",className:"bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white",children:[e.jsx(m,{className:"h-4 w-4 mr-2"}),"Add Recording"]}),e.jsxs(o,{onClick:()=>U(!0),className:"bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600",children:[e.jsx(u,{className:"h-4 w-4 mr-2"}),"Schedule Session"]})]})]}),T&&e.jsx(n,{onClose:()=>U(!1),onSuccess:()=>{U(!1),O()},session:H}),D&&e.jsx(d,{onClose:()=>V(!1),onSuccess:()=>{V(!1),O()},recording:H})]})};export{S as default};
