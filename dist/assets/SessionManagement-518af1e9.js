var e=Object.defineProperty,s=Object.defineProperties,r=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,l=(s,r,a)=>r in s?e(s,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[r]=a,n=(e,s)=>{for(var r in s||(s={}))t.call(s,r)&&l(e,r,s[r]);if(a)for(var r of a(s))i.call(s,r)&&l(e,r,s[r]);return e},d=(e,a)=>s(e,r(a));import{e as o,r as c,j as m,s as x,P as u,p as g,V as h,m as y,n as j,K as p,U as b,z as f,g as v,Y as w,_ as N,C as k,x as S,$ as C}from"./vendor-react-b59152ff.js";import{u as R}from"./userService-3683d387.js";import{s as L}from"./sessionService-cec466cd.js";import{r as P}from"./recordingService-f09f52a5.js";import{c as A}from"./courseService-97d71fc9.js";import{B as T}from"./Button-d86c7bdc.js";import{L as F}from"./index-cde8ec3e.js";import U from"./CreateSessionModal-1e8985fa.js";import{C as z}from"./CreateRecordingModal-a4017e6b.js";import"./vendor-c2e5c299.js";import"./firebase-a4f86f3d.js";import"./i18n-417c627b.js";import"./Select-30c0a963.js";const O=()=>{o();const[e,s]=c.useState([]),[r,a]=c.useState([]),[t,i]=c.useState([]),[l,k]=c.useState([]),[O,I]=c.useState(!0),[D,E]=c.useState(""),[B,M]=c.useState("all"),[J,V]=c.useState("all"),[$,_]=c.useState(!1),[G,q]=c.useState(!1),[K,W]=c.useState({}),[Y,H]=c.useState(null),[Q,X]=c.useState(null),[Z,ee]=c.useState("");c.useEffect(()=>{se()},[]);const se=async()=>{try{I(!0);const e=await authService.getCurrentUser();if(X(e),ee((null==e?void 0:e.role)||""),"admin"===(null==e?void 0:e.role)){const[e,r,t,l]=await Promise.all([L.getAllSessions().catch(e=>[]),P.getAllRecordings().catch(e=>[]),A.getAllCourses().catch(e=>[]),R.getUsersByRole("teacher").catch(e=>[])]);s(e),a(r),i(t),k(l)}else if("teacher"===(null==e?void 0:e.role)){const[r,t,l]=await Promise.all([L.getSessionsByTeacher(e.uid).catch(e=>[]),P.getRecordingsByTeacher(e.uid).catch(e=>[]),A.getCoursesByTeacher(e.uid).catch(e=>[])]);s(r),a(t),i(l)}else if("student"===(null==e?void 0:e.role)){const[e,r,t]=await Promise.all([L.getPublishedSessions().catch(e=>[]),P.getPublishedRecordings().catch(e=>[]),A.getAllCourses().catch(e=>[])]);s(e),a(r),i(t)}}catch(e){}finally{I(!1)}},re=e=>{e.meetLink&&window.open(e.meetLink,"_blank")},ae=()=>l,te=()=>t,ie=e.filter(e=>{var s,r,a,t;const i=(null==(s=e.title)?void 0:s.toLowerCase().includes(D.toLowerCase()))||(null==(r=e.topic)?void 0:r.toLowerCase().includes(D.toLowerCase()))||(null==(a=e.description)?void 0:a.toLowerCase().includes(D.toLowerCase()))||(null==(t=e.instructorName)?void 0:t.toLowerCase().includes(D.toLowerCase())),l="all"===B||e.status===B;return i&&l}),le=r.filter(e=>{var s,r,a,t;const i=(null==(s=e.title)?void 0:s.toLowerCase().includes(D.toLowerCase()))||(null==(r=e.description)?void 0:r.toLowerCase().includes(D.toLowerCase()))||(null==(a=e.instructorName)?void 0:a.toLowerCase().includes(D.toLowerCase()))||(null==(t=e.category)?void 0:t.toLowerCase().includes(D.toLowerCase())),l="all"===B||e.status===B;return i&&l}),ne=e=>{switch(e){case"scheduled":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300";case"live":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300";case"completed":case"available":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300";case"recorded":return"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-300"}},de=e=>{const s=t.find(s=>s.id===e);return s?s.name:"Unknown Course"},oe=e=>{if(!l||"admin"!==Z)return"Unknown Teacher";const s=l.find(s=>s.id===e);return s?s.displayName:"Unknown Teacher"};if(O)return m.jsx("div",{className:"flex items-center justify-center min-h-96",children:m.jsx(F,{size:"lg"})});const ce="sessions"===J?ie:"recordings"===J?le:[...ie,...le];return m.jsxs("div",{className:"space-y-6",children:[m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:["admin"===Z&&"Session & Recording Management","teacher"===Z&&"My Sessions & Recordings","student"===Z&&"Available Sessions & Recordings"]}),m.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:["admin"===Z&&"Manage all sessions and recordings across the platform","teacher"===Z&&"Manage your teaching sessions and recordings","student"===Z&&"View available sessions and recordings"]})]}),m.jsx("div",{className:"flex space-x-3",children:("admin"===Z||"teacher"===Z)&&m.jsxs(m.Fragment,{children:["admin"===Z&&m.jsxs(T,{onClick:()=>{H(null),q(!0)},variant:"outline",className:"bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white",children:[m.jsx(x,{className:"h-4 w-4 mr-2"}),"Add Recording"]}),m.jsxs(T,{onClick:()=>{H(null),_(!0)},className:"bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600",children:[m.jsx(u,{className:"h-4 w-4 mr-2"}),"Schedule Session"]})]})})]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[m.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow border border-gray-200 dark:border-gray-700",children:m.jsxs("div",{className:"flex items-center",children:[m.jsx(g,{className:"h-8 w-8 text-blue-500 mr-3"}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"student"===Z?"Available Sessions":"Total Sessions"}),m.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:e.length})]})]})}),m.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow border border-gray-200 dark:border-gray-700",children:m.jsxs("div",{className:"flex items-center",children:[m.jsx(h,{className:"h-8 w-8 text-purple-500 mr-3"}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"student"===Z?"Available Recordings":"Total Recordings"}),m.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:r.length})]})]})}),m.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow border border-gray-200 dark:border-gray-700",children:m.jsxs("div",{className:"flex items-center",children:[m.jsx(y,{className:"h-8 w-8 text-green-500 mr-3"}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Courses"}),m.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:t.length})]})]})}),m.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 shadow border border-gray-200 dark:border-gray-700",children:m.jsxs("div",{className:"flex items-center",children:[m.jsx(j,{className:"h-8 w-8 text-orange-500 mr-3"}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Live Sessions"}),m.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:e.filter(e=>"live"===e.status).length})]})]})})]}),m.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-200 dark:border-gray-700",children:m.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center space-y-4 lg:space-y-0 lg:space-x-4",children:[m.jsx("div",{className:"flex-1",children:m.jsxs("div",{className:"relative",children:[m.jsx(p,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),m.jsx("input",{type:"text",placeholder:"student"===Z?"Search available sessions and recordings...":"Search sessions and recordings...",value:D,onChange:e=>E(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),m.jsxs("div",{className:"flex space-x-4",children:[m.jsxs("select",{value:J,onChange:e=>V(e.target.value),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[m.jsx("option",{value:"all",children:"All Types"}),m.jsx("option",{value:"sessions",children:"Sessions Only"}),m.jsx("option",{value:"recordings",children:"Recordings Only"})]}),m.jsxs("select",{value:B,onChange:e=>M(e.target.value),className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[m.jsx("option",{value:"all",children:"All Status"}),m.jsx("option",{value:"scheduled",children:"Scheduled"}),m.jsx("option",{value:"live",children:"Live"}),m.jsx("option",{value:"completed",children:"Completed"}),m.jsx("option",{value:"recorded",children:"Recorded"})]})]})]})}),m.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:ce.map(s=>{const r=(e=>e.meetLink?"session":"recording")(s),a="session"===r,t="recording"===r;(e=>{switch(e){case"scheduled":return g;case"live":return f;case"completed":case"available":return S;case"recorded":return C;default:;}})(s.status);const i="live"===s.status,l="scheduled"===s.status,o=s.recordingUrl||s.isRecorded,c=s.isPublished,x=(e=>"admin"===Z||"teacher"===Z&&e.instructorId===(null==Q?void 0:Q.uid))(s);return m.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden hover:shadow-xl transition-all duration-300",children:[m.jsxs("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[m.jsx("div",{className:"flex items-start justify-between mb-3",children:m.jsxs("div",{className:"flex-1",children:[m.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[a&&m.jsx(g,{className:"h-4 w-4 text-blue-500"}),t&&m.jsx(h,{className:"h-4 w-4 text-purple-500"}),m.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${ne(s.status)}`,children:[a?"Session":"Recording"," â€¢ ",s.status]}),!c&&"student"!==Z&&m.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300",children:"Draft"})]}),m.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white text-lg line-clamp-2",children:s.title||s.topic}),m.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm mt-1 line-clamp-2",children:s.description})]})}),m.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500 dark:text-gray-400",children:[m.jsxs("span",{className:"flex items-center",children:[m.jsx(b,{className:"h-4 w-4 mr-1"}),s.instructorName||"Unknown Instructor"]}),s.scheduledTime&&m.jsxs("span",{className:"flex items-center",children:[m.jsx(g,{className:"h-4 w-4 mr-1"}),new Date(s.scheduledTime).toLocaleDateString()]})]})]}),m.jsxs("div",{className:"p-6",children:[m.jsxs("div",{className:"space-y-3",children:[s.scheduledTime&&m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Time"}),m.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:new Date(s.scheduledTime).toLocaleTimeString()})]}),s.duration&&m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Duration"}),m.jsxs("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[s.duration," min"]})]}),m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Course"}),m.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:de(s.courseId)})]}),"admin"===Z&&m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Teacher"}),m.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:oe(s.instructorId)})]}),m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Recording"}),m.jsx("span",{className:"text-sm font-medium "+(o?"text-green-600 dark:text-green-400":"text-gray-500 dark:text-gray-400"),children:o?"Available":"Not available"})]})]}),m.jsxs("div",{className:"flex flex-wrap gap-2 mt-6",children:[("student"===Z||!x)&&m.jsxs(m.Fragment,{children:[a&&i&&m.jsxs(T,{onClick:()=>re(s),className:"flex-1 bg-red-600 hover:bg-red-700 text-white",children:[m.jsx(f,{className:"h-4 w-4 mr-2"}),"Join Live"]}),a&&l&&m.jsxs(T,{onClick:()=>re(s),variant:"outline",className:"flex-1",children:[m.jsx(g,{className:"h-4 w-4 mr-2"}),"Join Session"]}),o&&m.jsx("a",{href:s.recordingUrl,target:"_blank",rel:"noopener noreferrer",className:"flex-1",children:m.jsxs(T,{variant:"outline",className:"w-full",children:[m.jsx(v,{className:"h-4 w-4 mr-2"}),a?"View Recording":"Watch Recording"]})})]}),x&&m.jsxs(m.Fragment,{children:[a&&i&&m.jsxs(T,{onClick:()=>re(s),className:"flex-1 bg-red-600 hover:bg-red-700 text-white",children:[m.jsx(f,{className:"h-4 w-4 mr-2"}),"Join Live"]}),a&&l&&m.jsxs(T,{onClick:()=>re(s),variant:"outline",className:"flex-1",children:[m.jsx(g,{className:"h-4 w-4 mr-2"}),"Join"]}),a&&!o&&"completed"===s.status&&m.jsxs(T,{onClick:()=>(async s=>{const r=prompt("Enter Google Drive recording URL:");if(r)try{W(e=>d(n({},e),{[s]:!0}));const a=e.find(e=>e.id===s);if(!a)throw new Error("Session not found");await L.markAsRecorded(s,r),await P.createRecording({title:`${a.title} - Recording`,description:`Recording of ${a.title}`,recordingUrl:r,duration:a.duration||60,fileSize:250,quality:"1080p",courseId:a.courseId,instructorId:a.instructorId,instructorEmail:a.instructorEmail,instructorName:a.instructorName,visibility:a.visibility||"public",category:a.category||"general",status:"recorded",recordingStatus:"available",isPublished:a.isPublished||!1}),await se()}catch(a){alert("Failed to add recording: "+a.message)}finally{W(e=>d(n({},e),{[s]:!1}))}})(s.id),disabled:K[s.id],className:"flex-1 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600",children:[K[s.id]?m.jsx(F,{size:"sm",className:"mr-2"}):m.jsx(h,{className:"h-4 w-4 mr-2"}),"Add Recording"]}),o&&m.jsx("a",{href:s.recordingUrl,target:"_blank",rel:"noopener noreferrer",className:"flex-1",children:m.jsxs(T,{variant:"outline",className:"w-full",children:[m.jsx(v,{className:"h-4 w-4 mr-2"}),"View Recording"]})}),a&&m.jsxs(m.Fragment,{children:[l&&m.jsx(T,{onClick:()=>(async e=>{try{W(s=>d(n({},s),{[e]:!0})),await L.updateSessionStatus(e,"live"),await se()}catch(s){alert("Failed to start session: "+s.message)}finally{W(s=>d(n({},s),{[e]:!1}))}})(s.id),variant:"outline",size:"sm",children:"Start"}),i&&m.jsx(T,{onClick:()=>(async e=>{try{W(s=>d(n({},s),{[e]:!0})),await L.updateSessionStatus(e,"completed"),await se()}catch(s){alert("Failed to end session: "+s.message)}finally{W(s=>d(n({},s),{[e]:!1}))}})(s.id),variant:"outline",size:"sm",children:"End"}),c?m.jsx(T,{onClick:()=>(async e=>{try{W(s=>d(n({},s),{[e]:!0})),await L.updateSession(e,{isPublished:!1}),await se()}catch(s){alert("Failed to unpublish session: "+s.message)}finally{W(s=>d(n({},s),{[e]:!1}))}})(s.id),variant:"outline",size:"sm",children:"Unpublish"}):m.jsx(T,{onClick:()=>(async e=>{try{W(s=>d(n({},s),{[e]:!0})),await L.updateSession(e,{isPublished:!0}),await se()}catch(s){alert("Failed to publish session: "+s.message)}finally{W(s=>d(n({},s),{[e]:!1}))}})(s.id),variant:"outline",size:"sm",children:"Publish"})]}),t&&m.jsx(m.Fragment,{children:c?m.jsx(T,{onClick:()=>(async e=>{try{W(s=>d(n({},s),{[e]:!0})),await P.updateRecording(e,{isPublished:!1}),await se()}catch(s){alert("Failed to unpublish recording: "+s.message)}finally{W(s=>d(n({},s),{[e]:!1}))}})(s.id),variant:"outline",size:"sm",children:"Unpublish"}):m.jsx(T,{onClick:()=>(async e=>{try{W(s=>d(n({},s),{[e]:!0})),await P.updateRecording(e,{isPublished:!0}),await se()}catch(s){alert("Failed to publish recording: "+s.message)}finally{W(s=>d(n({},s),{[e]:!1}))}})(s.id),variant:"outline",size:"sm",children:"Publish"})}),m.jsx(T,{onClick:()=>a?(H(s),void _(!0)):(H(s),void q(!0)),variant:"outline",size:"sm",children:m.jsx(w,{className:"h-4 w-4"})}),m.jsx(T,{onClick:()=>a?(async e=>{if(window.confirm("Are you sure you want to delete this session?"))try{W(s=>d(n({},s),{[e]:!0})),await L.deleteSession(e),await se()}catch(s){alert("Failed to delete session: "+s.message)}finally{W(s=>d(n({},s),{[e]:!1}))}})(s.id):(async e=>{if(window.confirm("Are you sure you want to delete this recording?"))try{W(s=>d(n({},s),{[e]:!0})),await P.deleteRecording(e),await se()}catch(s){alert("Failed to delete recording: "+s.message)}finally{W(s=>d(n({},s),{[e]:!1}))}})(s.id),variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20",children:m.jsx(N,{className:"h-4 w-4"})})]})]})]})]},s.id)})}),0===ce.length&&m.jsxs("div",{className:"text-center py-12",children:[m.jsx(h,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),m.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"No sessions or recordings found"}),m.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:D||"all"!==B||"all"!==J?"Try adjusting your search or filters":"student"===Z?"No published sessions or recordings available yet":"Get started by scheduling your first session or adding a recording"}),("admin"===Z||"teacher"===Z)&&m.jsxs("div",{className:"flex justify-center space-x-3",children:["admin"===Z&&m.jsxs(T,{onClick:()=>q(!0),variant:"outline",className:"bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white",children:[m.jsx(x,{className:"h-4 w-4 mr-2"}),"Add Recording"]}),m.jsxs(T,{onClick:()=>_(!0),className:"bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600",children:[m.jsx(u,{className:"h-4 w-4 mr-2"}),"Schedule Session"]})]})]}),$&&m.jsx(U,{onClose:()=>_(!1),onSuccess:()=>{_(!1),H(null),se()},session:Y,courses:te(),teachers:ae(),currentTeacher:Q,isAdmin:"admin"===Z}),G&&m.jsx(z,{onClose:()=>q(!1),onSuccess:()=>{q(!1),H(null),se()},recording:Y,courses:te(),teachers:ae(),currentTeacher:Q,isAdmin:"admin"===Z})]})};export{O as default};
