var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,l=(t,r,s)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s,n=(e,t)=>{for(var r in t||(t={}))a.call(t,r)&&l(e,r,t[r]);if(s)for(var r of s(t))i.call(t,r)&&l(e,r,t[r]);return e},o=(e,s)=>t(e,r(s));import{a as c,b as d,n as u,i as h,c as m,t as g,f as x,r as p,g as f,s as b,e as v,h as y,S as w,k as j,l as N,m as k,o as R,p as S,j as C,L as P,u as T}from"./index-c63f14c2.js";import{c as O,r as I}from"./vendor-c3615fdd.js";import{s as E}from"./utils-db1934d6.js";import{u as Q}from"./userService-2e30986f.js";import{s as L}from"./sessionService-69fc7e03.js";import{r as F}from"./recordingService-265d9a9f.js";import{c as U}from"./courseService-fdde1342.js";import{B as A}from"./Button-4635154f.js";import{I as M}from"./Input-fbeac968.js";import{j as $,k as D,U as B,a as W,C as z,l as q,B as Y,V as J,b as K,T as V,m as _,R as G,A as H,d as X,n as Z,o as ee,p as te}from"./ui-e3d8d230.js";import{u as re}from"./useTranslation-89f0f982.js";import"./router-4adec120.js";import"./firebase-9a5fb30d.js";import"./utils-5b9d0682.js";var se=function(e){function t(t,r){var s;return(s=e.call(this)||this).client=t,s.options=r,s.trackedProps=[],s.selectError=null,s.bindMethods(),s.setOptions(r),s}c(t,e);var r=t.prototype;return r.bindMethods=function(){this.remove=this.remove.bind(this),this.refetch=this.refetch.bind(this)},r.onSubscribe=function(){1===this.listeners.length&&(this.currentQuery.addObserver(this),ae(this.currentQuery,this.options)&&this.executeFetch(),this.updateTimers())},r.onUnsubscribe=function(){this.listeners.length||this.destroy()},r.shouldFetchOnReconnect=function(){return ie(this.currentQuery,this.options,this.options.refetchOnReconnect)},r.shouldFetchOnWindowFocus=function(){return ie(this.currentQuery,this.options,this.options.refetchOnWindowFocus)},r.destroy=function(){this.listeners=[],this.clearTimers(),this.currentQuery.removeObserver(this)},r.setOptions=function(e,t){var r=this.options,s=this.currentQuery;if(this.options=this.client.defaultQueryObserverOptions(e),void 0!==this.options.enabled&&"boolean"!=typeof this.options.enabled)throw new Error("Expected enabled to be a boolean");this.options.queryKey||(this.options.queryKey=r.queryKey),this.updateQuery();var a=this.hasListeners();a&&le(this.currentQuery,s,this.options,r)&&this.executeFetch(),this.updateResult(t),!a||this.currentQuery===s&&this.options.enabled===r.enabled&&this.options.staleTime===r.staleTime||this.updateStaleTimeout();var i=this.computeRefetchInterval();!a||this.currentQuery===s&&this.options.enabled===r.enabled&&i===this.currentRefetchInterval||this.updateRefetchInterval(i)},r.getOptimisticResult=function(e){var t=this.client.defaultQueryObserverOptions(e),r=this.client.getQueryCache().build(this.client,t);return this.createResult(r,t)},r.getCurrentResult=function(){return this.currentResult},r.trackResult=function(e,t){var r=this,s={},a=function(e){r.trackedProps.includes(e)||r.trackedProps.push(e)};return Object.keys(e).forEach(function(t){Object.defineProperty(s,t,{configurable:!1,enumerable:!0,get:function(){return a(t),e[t]}})}),(t.useErrorBoundary||t.suspense)&&a("error"),s},r.getNextResult=function(e){var t=this;return new Promise(function(r,s){var a=t.subscribe(function(t){t.isFetching||(a(),t.isError&&(null==e?void 0:e.throwOnError)?s(t.error):r(t))})})},r.getCurrentQuery=function(){return this.currentQuery},r.remove=function(){this.client.getQueryCache().remove(this.currentQuery)},r.refetch=function(e){return this.fetch(d({},e,{meta:{refetchPage:null==e?void 0:e.refetchPage}}))},r.fetchOptimistic=function(e){var t=this,r=this.client.defaultQueryObserverOptions(e),s=this.client.getQueryCache().build(this.client,r);return s.fetch().then(function(){return t.createResult(s,r)})},r.fetch=function(e){var t=this;return this.executeFetch(e).then(function(){return t.updateResult(),t.currentResult})},r.executeFetch=function(e){this.updateQuery();var t=this.currentQuery.fetch(this.options,e);return(null==e?void 0:e.throwOnError)||(t=t.catch(u)),t},r.updateStaleTimeout=function(){var e=this;if(this.clearStaleTimeout(),!h&&!this.currentResult.isStale&&m(this.options.staleTime)){var t=g(this.currentResult.dataUpdatedAt,this.options.staleTime)+1;this.staleTimeoutId=setTimeout(function(){e.currentResult.isStale||e.updateResult()},t)}},r.computeRefetchInterval=function(){var e;return"function"==typeof this.options.refetchInterval?this.options.refetchInterval(this.currentResult.data,this.currentQuery):null!=(e=this.options.refetchInterval)&&e},r.updateRefetchInterval=function(e){var t=this;this.clearRefetchInterval(),this.currentRefetchInterval=e,!h&&!1!==this.options.enabled&&m(this.currentRefetchInterval)&&0!==this.currentRefetchInterval&&(this.refetchIntervalId=setInterval(function(){(t.options.refetchIntervalInBackground||x.isFocused())&&t.executeFetch()},this.currentRefetchInterval))},r.updateTimers=function(){this.updateStaleTimeout(),this.updateRefetchInterval(this.computeRefetchInterval())},r.clearTimers=function(){this.clearStaleTimeout(),this.clearRefetchInterval()},r.clearStaleTimeout=function(){this.staleTimeoutId&&(clearTimeout(this.staleTimeoutId),this.staleTimeoutId=void 0)},r.clearRefetchInterval=function(){this.refetchIntervalId&&(clearInterval(this.refetchIntervalId),this.refetchIntervalId=void 0)},r.createResult=function(e,t){var r,s=this.currentQuery,a=this.options,i=this.currentResult,l=this.currentResultState,n=this.currentResultOptions,o=e!==s,c=o?e.state:this.currentQueryInitialState,d=o?this.currentResult:this.previousQueryResult,u=e.state,h=u.dataUpdatedAt,m=u.error,g=u.errorUpdatedAt,x=u.isFetching,b=u.status,v=!1,y=!1;if(t.optimisticResults){var w=this.hasListeners(),j=!w&&ae(e,t),N=w&&le(e,s,t,a);(j||N)&&(x=!0,h||(b="loading"))}if(t.keepPreviousData&&!u.dataUpdateCount&&(null==d?void 0:d.isSuccess)&&"error"!==b)r=d.data,h=d.dataUpdatedAt,b=d.status,v=!0;else if(t.select&&void 0!==u.data)if(i&&u.data===(null==l?void 0:l.data)&&t.select===this.selectFn)r=this.selectResult;else try{this.selectFn=t.select,r=t.select(u.data),!1!==t.structuralSharing&&(r=p(null==i?void 0:i.data,r)),this.selectResult=r,this.selectError=null}catch(R){f().error(R),this.selectError=R}else r=u.data;if(void 0!==t.placeholderData&&void 0===r&&("loading"===b||"idle"===b)){var k;if((null==i?void 0:i.isPlaceholderData)&&t.placeholderData===(null==n?void 0:n.placeholderData))k=i.data;else if(k="function"==typeof t.placeholderData?t.placeholderData():t.placeholderData,t.select&&void 0!==k)try{k=t.select(k),!1!==t.structuralSharing&&(k=p(null==i?void 0:i.data,k)),this.selectError=null}catch(R){f().error(R),this.selectError=R}void 0!==k&&(b="success",r=k,y=!0)}return this.selectError&&(m=this.selectError,r=this.selectResult,g=Date.now(),b="error"),{status:b,isLoading:"loading"===b,isSuccess:"success"===b,isError:"error"===b,isIdle:"idle"===b,data:r,dataUpdatedAt:h,error:m,errorUpdatedAt:g,failureCount:u.fetchFailureCount,errorUpdateCount:u.errorUpdateCount,isFetched:u.dataUpdateCount>0||u.errorUpdateCount>0,isFetchedAfterMount:u.dataUpdateCount>c.dataUpdateCount||u.errorUpdateCount>c.errorUpdateCount,isFetching:x,isRefetching:x&&"loading"!==b,isLoadingError:"error"===b&&0===u.dataUpdatedAt,isPlaceholderData:y,isPreviousData:v,isRefetchError:"error"===b&&0!==u.dataUpdatedAt,isStale:ne(e,t),refetch:this.refetch,remove:this.remove}},r.shouldNotifyListeners=function(e,t){if(!t)return!0;var r=this.options,s=r.notifyOnChangeProps,a=r.notifyOnChangePropsExclusions;if(!s&&!a)return!0;if("tracked"===s&&!this.trackedProps.length)return!0;var i="tracked"===s?this.trackedProps:s;return Object.keys(e).some(function(r){var s=r,l=e[s]!==t[s],n=null==i?void 0:i.some(function(e){return e===r}),o=null==a?void 0:a.some(function(e){return e===r});return l&&!o&&(!i||n)})},r.updateResult=function(e){var t=this.currentResult;if(this.currentResult=this.createResult(this.currentQuery,this.options),this.currentResultState=this.currentQuery.state,this.currentResultOptions=this.options,!b(this.currentResult,t)){var r={cache:!0};!1!==(null==e?void 0:e.listeners)&&this.shouldNotifyListeners(this.currentResult,t)&&(r.listeners=!0),this.notify(d({},r,e))}},r.updateQuery=function(){var e=this.client.getQueryCache().build(this.client,this.options);if(e!==this.currentQuery){var t=this.currentQuery;this.currentQuery=e,this.currentQueryInitialState=e.state,this.previousQueryResult=this.currentResult,this.hasListeners()&&(null==t||t.removeObserver(this),e.addObserver(this))}},r.onQueryUpdate=function(e){var t={};"success"===e.type?t.onSuccess=!0:"error"!==e.type||v(e.error)||(t.onError=!0),this.updateResult(t),this.hasListeners()&&this.updateTimers()},r.notify=function(e){var t=this;y.batch(function(){e.onSuccess?(null==t.options.onSuccess||t.options.onSuccess(t.currentResult.data),null==t.options.onSettled||t.options.onSettled(t.currentResult.data,null)):e.onError&&(null==t.options.onError||t.options.onError(t.currentResult.error),null==t.options.onSettled||t.options.onSettled(void 0,t.currentResult.error)),e.listeners&&t.listeners.forEach(function(e){e(t.currentResult)}),e.cache&&t.client.getQueryCache().notify({query:t.currentQuery,type:"observerResultsUpdated"})})},t}(w);function ae(e,t){return function(e,t){return!(!1===t.enabled||e.state.dataUpdatedAt||"error"===e.state.status&&!1===t.retryOnMount)}(e,t)||e.state.dataUpdatedAt>0&&ie(e,t,t.refetchOnMount)}function ie(e,t,r){if(!1!==t.enabled){var s="function"==typeof r?r(e):r;return"always"===s||!1!==s&&ne(e,t)}return!1}function le(e,t,r,s){return!1!==r.enabled&&(e!==t||!1===s.enabled)&&(!r.suspense||"error"!==e.state.status)&&ne(e,r)}function ne(e,t){return e.isStaleByTime(t.staleTime)}var oe=function(e){function t(t,r){return e.call(this,t,r)||this}c(t,e);var r=t.prototype;return r.bindMethods=function(){e.prototype.bindMethods.call(this),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)},r.setOptions=function(t,r){e.prototype.setOptions.call(this,d({},t,{behavior:j()}),r)},r.getOptimisticResult=function(t){return t.behavior=j(),e.prototype.getOptimisticResult.call(this,t)},r.fetchNextPage=function(e){var t;return this.fetch({cancelRefetch:null==(t=null==e?void 0:e.cancelRefetch)||t,throwOnError:null==e?void 0:e.throwOnError,meta:{fetchMore:{direction:"forward",pageParam:null==e?void 0:e.pageParam}}})},r.fetchPreviousPage=function(e){var t;return this.fetch({cancelRefetch:null==(t=null==e?void 0:e.cancelRefetch)||t,throwOnError:null==e?void 0:e.throwOnError,meta:{fetchMore:{direction:"backward",pageParam:null==e?void 0:e.pageParam}}})},r.createResult=function(t,r){var s,a,i,l,n,o,c=t.state,u=e.prototype.createResult.call(this,t,r);return d({},u,{fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:N(r,null==(s=c.data)?void 0:s.pages),hasPreviousPage:k(r,null==(a=c.data)?void 0:a.pages),isFetchingNextPage:c.isFetching&&"forward"===(null==(i=c.fetchMeta)||null==(l=i.fetchMore)?void 0:l.direction),isFetchingPreviousPage:c.isFetching&&"backward"===(null==(n=c.fetchMeta)||null==(o=n.fetchMore)?void 0:o.direction)})},t}(se);var ce,de=O.createContext((ce=!1,{clearReset:function(){ce=!1},reset:function(){ce=!0},isReset:function(){return ce}}));function ue(e,t){var r=O.useRef(!1),s=O.useState(0)[1],a=R(),i=O.useContext(de),l=a.defaultQueryObserverOptions(e);l.optimisticResults=!0,l.onError&&(l.onError=y.batchCalls(l.onError)),l.onSuccess&&(l.onSuccess=y.batchCalls(l.onSuccess)),l.onSettled&&(l.onSettled=y.batchCalls(l.onSettled)),l.suspense&&("number"!=typeof l.staleTime&&(l.staleTime=1e3),0===l.cacheTime&&(l.cacheTime=1)),(l.suspense||l.useErrorBoundary)&&(i.isReset()||(l.retryOnMount=!1));var n=O.useState(function(){return new t(a,l)})[0],o=n.getOptimisticResult(l);if(O.useEffect(function(){r.current=!0,i.clearReset();var e=n.subscribe(y.batchCalls(function(){r.current&&s(function(e){return e+1})}));return n.updateResult(),function(){r.current=!1,e()}},[i,n]),O.useEffect(function(){n.setOptions(l,{listeners:!1})},[l,n]),l.suspense&&o.isLoading)throw n.fetchOptimistic(l).then(function(e){var t=e.data;null==l.onSuccess||l.onSuccess(t),null==l.onSettled||l.onSettled(t,null)}).catch(function(e){i.clearReset(),null==l.onError||l.onError(e),null==l.onSettled||l.onSettled(void 0,e)});if(o.isError&&!i.isReset()&&!o.isFetching&&E(l.suspense,l.useErrorBoundary,[o.error,n.getCurrentQuery()]))throw o.error;return"tracked"===l.notifyOnChangeProps&&(o=n.trackResult(o,l)),o}function he(e,t,r){return ue(S(e,t,r),se)}const me=[{value:"createdAt",label:"Date Added"},{value:"title",label:"Title"},{value:"duration",label:"Duration"},{value:"views",label:"Popularity"},{value:"rating",label:"Rating"}],ge=[{value:"all",label:"All Categories"},{value:"lecture",label:"Lectures"},{value:"tutorial",label:"Tutorials"},{value:"workshop",label:"Workshops"},{value:"qna",label:"Q&A Sessions"}],xe=[{value:"all",label:"All Status"},{value:"new",label:"New"},{value:"watched",label:"Watched"},{value:"completed",label:"Completed"},{value:"processing",label:"Processing"}],pe=e=>{if(!e)return"0:00";const t=Math.floor(e/3600),r=Math.floor(e%3600/60),s=Math.floor(e%60);return t>0?`${t}:${r.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`:`${r}:${s.toString().padStart(2,"0")}`},fe=e=>{switch(e){case"completed":return"from-green-500 to-emerald-500";case"processing":return"from-yellow-500 to-orange-500";case"recording":return"from-blue-500 to-cyan-500";case"failed":return"from-red-500 to-pink-500";default:return"from-gray-500 to-gray-600"}},be=e=>e>=90?"from-green-500 to-emerald-500":e>=50?"from-yellow-500 to-orange-500":"from-blue-500 to-cyan-500",ve=O.memo(({recording:e,onWatch:t,actionLoading:r,getTeacherName:s,teachers:a})=>{var i;const l=(e=>{switch(e){case"completed":return $;case"processing":return z;case"recording":return q;case"failed":return te;default:return J}})(e.status),n=e.progress||(e.watched?100:0),o=e.instructorName||s(e.instructorId);return C.jsx("div",{className:"group bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-3xl border border-white/30 dark:border-gray-700/40 p-6 shadow-2xl hover:shadow-2xl transition-all duration-300 hover:scale-105",children:C.jsxs("div",{className:"flex items-start justify-between",children:[C.jsxs("div",{className:"flex items-start space-x-4 flex-1 min-w-0",children:[C.jsx("div",{className:`p-3 rounded-2xl bg-gradient-to-br ${fe(e.status)}`,children:C.jsx(l,{className:"h-6 w-6 text-white"})}),C.jsxs("div",{className:"flex-1 min-w-0",children:[C.jsxs("div",{className:"flex items-start justify-between mb-2",children:[C.jsxs("h4",{className:"font-semibold text-gray-900 dark:text-white text-lg line-clamp-1 flex-1",children:[e.title,e.meetLink&&C.jsx("span",{className:"ml-2 px-2 py-1 text-xs bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300 rounded-full",children:"Google Meet"})]}),C.jsxs("div",{className:"flex items-center space-x-2 ml-3",children:[e.watched&&C.jsx($,{className:"h-4 w-4 text-green-500"}),e.isFeatured&&C.jsx(D,{className:"h-4 w-4 text-yellow-500 fill-current"})]})]}),C.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm mb-3 line-clamp-2",children:e.description||"No description provided"}),C.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-600 dark:text-gray-400 mb-3",children:[o&&C.jsxs("span",{className:"flex items-center",children:[C.jsx(B,{className:"h-3 w-3 mr-1"}),o]}),e.category&&C.jsx("span",{className:"px-2 py-1 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300",children:e.category})]}),C.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-600 dark:text-gray-400",children:[C.jsxs("span",{className:"flex items-center",children:[C.jsx(W,{className:"h-3 w-3 mr-1"}),e.views||0," views"]}),C.jsxs("span",{className:"flex items-center",children:[C.jsx(z,{className:"h-3 w-3 mr-1"}),pe(e.duration)]}),e.averageRating>0&&C.jsxs("span",{className:"flex items-center",children:[C.jsx(D,{className:"h-3 w-3 mr-1 text-yellow-500 fill-current"}),e.averageRating.toFixed(1)]}),C.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium capitalize "+("completed"===e.status?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300":"processing"===e.status?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300":"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300"),children:e.status})]}),n>0&&n<100&&C.jsxs("div",{className:"mt-3",children:[C.jsxs("div",{className:"flex justify-between text-xs text-gray-600 dark:text-gray-400 mb-1",children:[C.jsx("span",{children:"Progress"}),C.jsxs("span",{children:[n,"%"]})]}),C.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:C.jsx("div",{className:`h-2 rounded-full bg-gradient-to-r ${be(n)} transition-all duration-500`,style:{width:`${n}%`}})})]}),e.tags&&e.tags.length>0&&C.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[e.tags.slice(0,3).map((t,r)=>C.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300",children:t},`tag-${e.id}-${r}`)),e.tags.length>3&&C.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400",children:["+",e.tags.length-3," more"]})]})]})]}),C.jsx("div",{className:"flex space-x-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 ml-4",children:C.jsxs(A,{size:"sm",onClick:()=>t(e),disabled:r[e.id],className:"bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600",children:[r[e.id]?C.jsx(P,{size:"sm",className:"mr-1"}):C.jsx(q,{className:"h-3 w-3 mr-1"}),(null==(i=e.recordingUrl)?void 0:i.includes("drive.google.com"))?"Watch on Drive":"Watch"]})})]})})}),ye=O.memo(({session:e,onJoin:t,getTeacherName:r,teachers:s,type:a="teacher"})=>{const i=(e=>{if(!e)return{date:"TBD",time:"",full:"TBD"};const t=new Date(e);return{date:t.toLocaleDateString(),time:t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),full:t.toLocaleString()}})(e.scheduledTime),l=r(e.createdBy);return C.jsxs("div",{className:"flex items-center p-3 rounded-2xl bg-white/50 dark:bg-gray-700/50 backdrop-blur-lg border border-white/40 dark:border-gray-600/40 hover:bg-white/80 dark:hover:bg-gray-600/80 transition-all duration-200 group cursor-pointer",onClick:()=>t(e),children:[C.jsxs("div",{className:"flex-1 min-w-0",children:[C.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:e.topic||e.title||"Untitled Session"}),"teacher"===a&&C.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[C.jsx(B,{className:"h-3 w-3 text-gray-500"}),C.jsx("p",{className:"text-xs text-gray-700 dark:text-gray-300 truncate",children:l})]}),C.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[C.jsx(z,{className:"h-3 w-3 text-gray-500"}),C.jsxs("p",{className:"text-xs text-gray-700 dark:text-gray-300",children:[i.date," at ",i.time]})]})]}),C.jsxs("div",{className:"flex items-center space-x-2",children:[C.jsx("div",{className:"w-2 h-2 rounded-full animate-pulse "+("teacher"===a?"bg-green-500":"bg-red-500")}),C.jsx(q,{className:"h-4 w-4 text-green-500 opacity-0 group-hover:opacity-100 transition-opacity"})]})]})}),we=()=>{var e,t,r;re();const{user:s,userProfile:a,loading:i}=T(),[l,c]=I.useState(""),[d,u]=I.useState("all"),[h,m]=I.useState("all"),[g,x]=I.useState("all"),[p,f]=I.useState("createdAt"),[b,v]=I.useState("desc"),[y,w]=I.useState({}),[j,N]=I.useState(!1),k=null==s?void 0:s.uid,R=null==a?void 0:a.isActive,O=(null==a?void 0:a.displayName)||(null==(e=null==s?void 0:s.email)?void 0:e.split("@")[0]),{data:E,isLoading:$}=he(["studentSessions",k],async()=>{const[e,t]=await Promise.all([L.getPublicSessions({status:"scheduled",dateRange:"upcoming",limit:10}),L.getTeacherSessionsForStudents({limit:20,daysAhead:30})]);return{recentSessions:e,teacherSessions:t}},{enabled:!!k&&R,staleTime:3e5,refetchOnWindowFocus:!1}),D=(null==E?void 0:E.recentSessions)||[],B=(null==E?void 0:E.teacherSessions)||[],{data:W,fetchNextPage:z,hasNextPage:q,isFetchingNextPage:te,isLoading:se,error:ae,refetch:ie,isRefetching:le}=ue(S(["studentRecordings",k,p,b],({pageParam:e=null})=>F.getAvailableRecordings({studentId:k,cursor:e,limit:12,sortBy:p,sortOrder:b}),{getNextPageParam:e=>e.nextCursor||void 0,enabled:!!k&&R,retry:2,staleTime:3e5,refetchOnWindowFocus:!1}),oe);const{data:ne=[],isLoading:ce,error:de}=he(["studentCourses",k],()=>U.getPublishedCourses(20),{enabled:!!k&&R,staleTime:6e5}),{data:pe=[],isLoading:fe,error:be}=he(["teachers"],()=>Q.getAllUsers({role:"teacher",status:"active"}),{enabled:!!k&&R,select:e=>e.filter(e=>"teacher"===e.role&&e.isActive)}),we=(null==W?void 0:W.pages.flatMap(e=>e.recordings||[]))||[],je=I.useMemo(()=>{if(!we.length)return[];let e=we;if(l){const t=l.toLowerCase();e=e.filter(e=>{var r,s,a,i;return(null==(r=e.title)?void 0:r.toLowerCase().includes(t))||(null==(s=e.description)?void 0:s.toLowerCase().includes(t))||(null==(a=e.tags)?void 0:a.some(e=>e.toLowerCase().includes(t)))||(null==(i=e.instructorName)?void 0:i.toLowerCase().includes(t))})}return"all"!==d&&(e=e.filter(e=>e.status===d||"watched"===d&&e.watched||"new"===d&&!e.watched)),"all"!==h&&(e=e.filter(e=>e.category===h)),"all"!==g&&(e=e.filter(e=>e.instructorId===g)),e.sort((e,t)=>{let r=e[p]||0,s=t[p]||0;return"createdAt"!==p&&"updatedAt"!==p&&"scheduledTime"!==p||(r=new Date(r).getTime(),s=new Date(s).getTime()),"desc"===b?s-r:r-s})},[we,l,d,h,g,p,b]),Ne=I.useMemo(()=>"all"===g?B:B.filter(e=>e.createdBy===g),[B,g]),ke=I.useMemo(()=>{const e=we.filter(e=>e.watched).length,t=we.length>0?Math.round(e/we.length*100):0;return{enrolledClasses:ne.length,availableRecordings:we.filter(e=>e.isPublished&&"completed"===e.status).length,teachers:pe.length,totalWatchTime:we.reduce((e,t)=>e+(t.duration||0),0),completedRecordings:e,upcomingSessions:D.length,teacherUpcomingSessions:Ne.length,googleMeetSessions:we.filter(e=>e.meetLink).length,totalProgress:t}},[ne,we,pe,D,Ne]),Re=I.useCallback(e=>{var t;const r=pe.find(t=>t.uid===e);return(null==r?void 0:r.displayName)||(null==(t=null==r?void 0:r.email)?void 0:t.split("@")[0])||"Unknown Teacher"},[pe]),Se=I.useCallback(()=>{ie()},[ie]),Ce=I.useCallback(e=>{e.recordingUrl&&(w(t=>o(n({},t),{[e.id]:!0})),e.recordingUrl.includes("drive.google.com")&&window.open(e.recordingUrl,"_blank"),setTimeout(()=>{w(t=>o(n({},t),{[e.id]:!1}))},1e3))},[]),Pe=I.useCallback(e=>{(e.meetLink||e.googleMeetLink)&&window.open(e.meetLink||e.googleMeetLink,"_blank")},[]),Te=I.useMemo(()=>[{id:"enrolled-classes",name:"Enrolled Classes",value:ke.enrolledClasses.toString(),icon:Y,change:`${ne.filter(e=>e.isPublished).length} active`,changeType:"positive",color:"from-blue-500 to-cyan-500",bgColor:"from-blue-500/10 to-cyan-500/10",description:"Your learning journey",loading:ce},{id:"available-recordings",name:"Available Recordings",value:ke.availableRecordings.toString(),icon:J,change:`${ke.completedRecordings} watched`,changeType:ke.completedRecordings>0?"positive":"neutral",color:"from-green-500 to-emerald-500",bgColor:"from-green-500/10 to-emerald-500/10",description:"Ready to watch",loading:se},{id:"teachers",name:"Teachers",value:ke.teachers.toString(),icon:K,change:`${ke.teacherUpcomingSessions} upcoming`,changeType:"neutral",color:"from-purple-500 to-pink-500",bgColor:"from-purple-500/10 to-pink-500/10",description:"Expert instructors",loading:fe},{id:"learning-progress",name:"Learning Progress",value:`${ke.totalProgress}%`,icon:V,change:`${Math.round(ke.totalWatchTime/3600)} hours watched`,changeType:ke.totalProgress>50?"positive":"neutral",color:"from-orange-500 to-red-500",bgColor:"from-orange-500/10 to-red-500/10",description:"Your overall progress",loading:se}],[ke,ne,ce,se,fe]),Oe=I.useMemo(()=>[{value:"all",label:"All Teachers"},...pe.map(e=>{var t;return{value:e.uid,label:e.displayName||(null==(t=e.email)?void 0:t.split("@")[0])||"Unknown Teacher"}})],[pe]),Ie=ae||de||be;return i?C.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-50 via-white to-cyan-50 dark:from-gray-900 dark:via-gray-800 dark:to-blue-900",children:C.jsxs("div",{className:"text-center",children:[C.jsx(P,{size:"lg"}),C.jsx("p",{className:"mt-3 text-sm text-gray-500 dark:text-gray-400",children:"Loading your dashboard..."})]})}):k?R?C.jsxs("div",{className:"space-y-6 sm:space-y-8 p-4 sm:p-6 lg:p-8 bg-gradient-to-br from-blue-50 via-white to-cyan-50 dark:from-gray-900 dark:via-gray-800 dark:to-blue-900 min-h-screen",children:[C.jsx("div",{className:"text-center lg:text-left",children:C.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[C.jsxs("div",{children:[C.jsx("h1",{className:"text-3xl sm:text-4xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-cyan-600 bg-clip-text text-transparent mb-2 sm:mb-3",children:"Student Dashboard"}),C.jsx("p",{className:"text-base sm:text-lg text-gray-700 dark:text-gray-300 max-w-2xl",children:"Access your classes, recordings, and learning materials"}),O&&C.jsxs("div",{className:"flex items-center mt-2 space-x-2",children:[C.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Welcome back, ",C.jsx("span",{className:"font-semibold text-gray-800 dark:text-gray-200",children:O})]}),"premium"===(null==(t=null==a?void 0:a.subscription)?void 0:t.plan)&&C.jsxs("span",{className:"px-2 py-1 text-xs bg-gradient-to-r from-yellow-500 to-orange-500 text-white rounded-full flex items-center",children:[C.jsx(_,{className:"h-3 w-3 mr-1"}),"Premium Student"]})]})]}),C.jsxs("div",{className:"flex items-center gap-3",children:[C.jsxs(A,{onClick:Se,variant:"outline",disabled:le,className:"hidden lg:flex items-center",children:[C.jsx(G,{className:"h-4 w-4 mr-2 "+(le?"animate-spin":"")}),"Refresh"]}),C.jsxs(A,{onClick:()=>window.location.href="/courses",className:"bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 shadow-lg",children:[C.jsx(Y,{className:"h-4 w-4 mr-2"}),"Browse Classes"]})]})]})}),Ie&&C.jsxs("div",{className:"bg-red-50/80 dark:bg-red-900/30 backdrop-blur-lg border border-red-200/50 dark:border-red-800/50 rounded-2xl p-4 flex items-center",children:[C.jsx(H,{className:"h-5 w-5 text-red-500 mr-3 flex-shrink-0"}),C.jsx("p",{className:"text-red-700 dark:text-red-300 text-sm flex-1",children:"Failed to load content. Please try refreshing."}),C.jsx("button",{onClick:Se,className:"ml-4 text-red-500 hover:text-red-700 flex-shrink-0",children:C.jsx(G,{className:"h-4 w-4"})})]}),C.jsx("div",{className:"grid grid-cols-1 gap-4 sm:gap-6 sm:grid-cols-2 xl:grid-cols-4",children:Te.map(e=>{const t=e.icon;return C.jsxs("div",{className:"group relative overflow-hidden rounded-3xl bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl border border-white/30 dark:border-gray-700/40 p-4 sm:p-6 shadow-2xl hover:shadow-2xl transition-all duration-500 hover:scale-105",children:[C.jsx("div",{className:`absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-500 bg-gradient-to-br ${e.bgColor} rounded-3xl`}),C.jsxs("div",{className:"relative z-10",children:[C.jsxs("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:[C.jsx("div",{className:`p-2 sm:p-3 rounded-2xl bg-gradient-to-br ${e.color} shadow-lg`,children:C.jsx(t,{className:"h-5 w-5 sm:h-6 sm:w-6 text-white"})}),C.jsxs("div",{className:"flex items-center space-x-1",children:["positive"===e.changeType&&C.jsx(V,{className:"h-4 w-4 text-green-500"}),C.jsx("div",{className:"text-xs sm:text-sm font-semibold "+("positive"===e.changeType?"text-green-600 dark:text-green-400":"text-gray-600 dark:text-gray-400"),children:e.change})]})]}),e.loading?C.jsxs("div",{className:"animate-pulse",children:[C.jsx("div",{className:"h-7 sm:h-8 bg-gray-300 dark:bg-gray-600 rounded mb-2"}),C.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded"})]}):C.jsxs(C.Fragment,{children:[C.jsx("h3",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white mb-1 sm:mb-2",children:e.value}),C.jsx("p",{className:"text-sm font-medium text-gray-800 dark:text-gray-200 mb-1",children:e.name}),C.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:e.description})]})]})]},e.id)})}),C.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-4 gap-6 sm:gap-8",children:[C.jsxs("div",{className:"xl:col-span-1 space-y-6",children:[C.jsxs("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-3xl border border-white/30 dark:border-gray-700/40 p-4 sm:p-6 shadow-2xl hover:shadow-2xl transition-all duration-300",children:[C.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[C.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"Teacher Sessions"}),C.jsx(K,{className:"h-5 w-5 text-purple-500"})]}),C.jsxs("div",{className:"space-y-3",children:[Ne.length>0?Ne.slice(0,5).map(e=>C.jsx(ye,{session:e,onJoin:Pe,getTeacherName:Re,teachers:pe,type:"teacher"},`teacher-session-${e.id}`)):C.jsxs("div",{className:"text-center py-4 text-gray-600 dark:text-gray-400",children:[C.jsx(K,{className:"mx-auto h-8 w-8 mb-2"}),C.jsx("p",{className:"text-sm",children:"No teacher sessions"}),C.jsx("p",{className:"text-xs mt-1",children:"Check back later for updates"})]}),Ne.length>5&&C.jsx(A,{variant:"outline",size:"sm",className:"w-full mt-2",onClick:()=>window.location.href="/sessions?view=teachers",children:"View All Teacher Sessions"})]})]}),C.jsxs("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-3xl border border-white/30 dark:border-gray-700/40 p-4 sm:p-6 shadow-2xl hover:shadow-2xl transition-all duration-300",children:[C.jsxs("div",{className:"flex items-center justify-between mb-4 sm:mb-6",children:[C.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"Your Upcoming Sessions"}),C.jsx(X,{className:"h-5 w-5 text-blue-500"})]}),C.jsx("div",{className:"space-y-3",children:$?C.jsx("div",{className:"flex justify-center py-4",children:C.jsx(P,{size:"sm"})}):D.length>0?D.map(e=>C.jsx(ye,{session:e,onJoin:Pe,getTeacherName:Re,teachers:pe,type:"recent"},`recent-session-${e.id}`)):C.jsxs("div",{className:"text-center py-4 text-gray-600 dark:text-gray-400",children:[C.jsx(X,{className:"mx-auto h-8 w-8 mb-2"}),C.jsx("p",{className:"text-sm",children:"No upcoming sessions"}),C.jsx(A,{variant:"outline",size:"sm",className:"mt-2",onClick:()=>window.location.href="/sessions",children:"View All Sessions"})]})})]})]}),C.jsxs("div",{className:"xl:col-span-3 space-y-6",children:[C.jsx("div",{className:"bg-white/70 dark:bg-gray-800/70 backdrop-blur-xl rounded-3xl border border-white/30 dark:border-gray-700/40 p-4 sm:p-6 shadow-2xl",children:C.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center space-y-4 lg:space-y-0 lg:space-x-4",children:[C.jsx("div",{className:"flex-1",children:C.jsxs("div",{className:"relative",children:[C.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:C.jsx(Z,{className:"h-4 w-4 text-gray-500"})}),C.jsx(M,{type:"text",className:"block w-full pl-10 pr-3 py-3 rounded-2xl bg-white/50 dark:bg-gray-700/50 border-white/40 dark:border-gray-600/40 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 dark:text-white",placeholder:"Search recordings by title, description, or instructor...",value:l,onChange:e=>c(e.target.value)})]})}),C.jsxs(A,{onClick:()=>N(!j),variant:"outline",className:"lg:hidden",children:[C.jsx(ee,{className:"h-4 w-4 mr-2"}),"Filters"]}),C.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 "+(j?"flex":"hidden lg:flex"),children:[C.jsx("select",{className:"block w-full sm:w-auto px-3 py-3 text-sm rounded-2xl bg-white/50 dark:bg-gray-700/50 border-white/40 dark:border-gray-600/40 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:g,onChange:e=>x(e.target.value),children:Oe.map(e=>C.jsx("option",{value:e.value,children:e.label},`teacher-${e.value}`))}),C.jsx("select",{className:"block w-full sm:w-auto px-3 py-3 text-sm rounded-2xl bg-white/50 dark:bg-gray-700/50 border-white/40 dark:border-gray-600/40 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:h,onChange:e=>m(e.target.value),children:ge.map(e=>C.jsx("option",{value:e.value,children:e.label},`category-${e.value}`))}),C.jsx("select",{className:"block w-full sm:w-auto px-3 py-3 text-sm rounded-2xl bg-white/50 dark:bg-gray-700/50 border-white/40 dark:border-gray-600/40 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:d,onChange:e=>u(e.target.value),children:xe.map(e=>C.jsx("option",{value:e.value,children:e.label},`status-${e.value}`))}),C.jsx("select",{className:"block w-full sm:w-auto px-3 py-3 text-sm rounded-2xl bg-white/50 dark:bg-gray-700/50 border-white/40 dark:border-gray-600/40 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:p,onChange:e=>f(e.target.value),children:me.map(e=>C.jsx("option",{value:e.value,children:e.label},`sort-${e.value}`))}),C.jsx(A,{onClick:()=>v("desc"===b?"asc":"desc"),variant:"outline",className:"px-3",children:"desc"===b?"↓":"↑"}),C.jsx(A,{onClick:Se,variant:"outline",disabled:le,children:C.jsx(G,{className:"h-4 w-4 "+(le?"animate-spin":"")})})]})]})}),C.jsxs("div",{children:[C.jsxs("div",{className:"flex items-center justify-between mb-4",children:[C.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"Available Recordings"}),C.jsxs("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:[je.length," items",l&&` • matching "${l}"`,"all"!==g&&` • by ${null==(r=Oe.find(e=>e.value===g))?void 0:r.label}`]})]}),se?C.jsx("div",{className:"flex justify-center items-center min-h-64 bg-white/50 dark:bg-gray-800/50 rounded-3xl border border-white/30 dark:border-gray-700/40",children:C.jsxs("div",{className:"text-center",children:[C.jsx(P,{size:"lg"}),C.jsx("p",{className:"mt-3 text-sm text-gray-600 dark:text-gray-400",children:"Loading recordings..."})]})}):je.length>0?C.jsxs(C.Fragment,{children:[C.jsx("div",{className:"grid grid-cols-1 gap-4 sm:gap-6",children:je.map(e=>C.jsx(ve,{recording:e,onWatch:Ce,actionLoading:y,getTeacherName:Re,teachers:pe},`recording-${e.id}`))}),q&&C.jsx("div",{className:"flex justify-center mt-8",children:C.jsx(A,{onClick:()=>z(),disabled:te,variant:"outline",className:"flex items-center",children:te?C.jsxs(C.Fragment,{children:[C.jsx(P,{size:"sm",className:"mr-2"}),"Loading more recordings..."]}):C.jsx(C.Fragment,{children:"Load More Recordings"})})})]}):C.jsxs("div",{className:"text-center py-12 bg-white/50 dark:bg-gray-800/50 rounded-3xl border border-white/30 dark:border-gray-700/40",children:[C.jsx(J,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),C.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:l||"all"!==d||"all"!==h||"all"!==g?"No matching recordings":"No recordings available"}),C.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6 max-w-md mx-auto",children:l||"all"!==d||"all"!==h||"all"!==g?"Try adjusting your search or filters.":"Enroll in a class to access recordings."}),C.jsxs(A,{onClick:()=>window.location.href="/courses",className:"bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600",children:[C.jsx(Y,{className:"h-4 w-4 mr-2"}),"Browse Classes"]})]})]})]})]})]}):C.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-50 via-white to-cyan-50 dark:from-gray-900 dark:via-gray-800 dark:to-blue-900",children:C.jsxs("div",{className:"text-center max-w-md p-8",children:[C.jsx(Y,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),C.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Pending Approval"}),C.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Your account is awaiting admin approval. You will be notified via email once approved."}),C.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-xl p-4",children:C.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:"Please contact the administrator if you have been waiting for more than 24 hours."})})]})}):C.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-50 via-white to-cyan-50 dark:from-gray-900 dark:via-gray-800 dark:to-blue-900",children:C.jsxs("div",{className:"text-center max-w-md p-8",children:[C.jsx(Y,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),C.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Authentication Required"}),C.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Please log in to access the student dashboard."}),C.jsx(A,{onClick:()=>window.location.href="/login",className:"bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 shadow-lg",children:"Sign in"})]})})};export{we as default};
