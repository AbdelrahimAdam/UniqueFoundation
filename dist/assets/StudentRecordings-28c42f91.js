var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,i=(t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,o=(e,t)=>{for(var a in t||(t={}))s.call(t,a)&&i(e,a,t[a]);if(r)for(var a of r(t))l.call(t,a)&&i(e,a,t[a]);return e},n=(e,r)=>t(e,a(r));import{k as c,r as d,j as m,V as u,t as x,a4 as g,z as h,y as p,l as y,g as b,D as f,Z as v,C as j,e as w,p as N,a8 as k,o as S,A as C,K as D,O as L,a9 as A,a0 as R}from"./vendor-react-b59152ff.js";import{u as $,L as T}from"./index-cde8ec3e.js";import"./firebase-a4f86f3d.js";import{s as M}from"./sessionService-cec466cd.js";import{r as P}from"./recordingService-f09f52a5.js";import{B as z}from"./Button-d86c7bdc.js";import{z as O,B as U}from"./vendor-c2e5c299.js";import"./i18n-417c627b.js";const W="recordings",F="upcoming",I="live",B="createdAt",G="title",J="duration",_="views",E="scheduledTime",V=[{value:"all",label:"All Categories"},{value:"lecture",label:"Lectures"},{value:"tutorial",label:"Tutorials"},{value:"workshop",label:"Workshops"},{value:"qna",label:"Q&A Sessions"}],Z=e=>{if(!e||0===e)return"0:00";const t=Math.floor(e/3600),a=Math.floor(e%3600/60),r=Math.floor(e%60);return t>0?`${t}:${a.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`:`${a}:${r.toString().padStart(2,"0")}`},q=e=>{if(!e)return"TBD";try{return new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}catch(t){return"Invalid Date"}},K=e=>{if(!e||"string"!=typeof e)return null;const t=e.match(/\/d\/([a-zA-Z0-9-_]+)/);return t?t[1]:null},Q=c.memo(d.forwardRef(({recording:e,onWatch:t,onDownload:a,index:r},s)=>{const l=!!K(e.recordingUrl),[i,o]=d.useState(!1);return m.jsxs(O.div,{ref:s,layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:Math.min(.03*r,.3),type:"spring",stiffness:400,damping:40},className:"group bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden hover:shadow-xl transition-all duration-300 hover:scale-105",children:[m.jsxs("div",{className:"h-48 bg-gradient-to-br from-blue-500 to-cyan-500 relative overflow-hidden",children:[e.thumbnailUrl?m.jsxs(m.Fragment,{children:[m.jsx("img",{src:e.thumbnailUrl,alt:e.title,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-110 "+(i?"opacity-100":"opacity-0"),loading:"lazy",onLoad:()=>o(!0)}),!i&&m.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gradient-to-br from-blue-500 to-cyan-500",children:m.jsx(u,{className:"h-8 w-8 text-white opacity-80"})})]}):m.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gradient-to-br from-blue-500 to-cyan-500",children:m.jsx(u,{className:"h-16 w-16 text-white opacity-80"})}),m.jsx("div",{className:"absolute bottom-4 left-4",children:m.jsx("span",{className:"px-3 py-1 bg-black bg-opacity-70 text-white rounded-full text-sm font-medium backdrop-blur-sm",children:Z(e.duration)})}),e.watched&&m.jsx("div",{className:"absolute top-4 right-4",children:m.jsxs("span",{className:"px-3 py-1 bg-green-500 text-white rounded-full text-xs font-medium flex items-center gap-1",children:[m.jsx(x,{className:"h-3 w-3"})," Watched"]})}),l&&m.jsx("div",{className:"absolute top-4 left-4",children:m.jsxs("span",{className:"px-2 py-1 bg-blue-500 text-white rounded-full text-xs font-medium flex items-center gap-1",children:[m.jsx(g,{className:"h-3 w-3"}),"Drive"]})}),l&&m.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-black bg-opacity-40",children:m.jsx("button",{onClick:()=>t(e),className:"p-4 bg-white bg-opacity-20 rounded-full backdrop-blur-sm hover:bg-opacity-30 transition-all transform hover:scale-110",title:"Watch on Google Drive",children:m.jsx(h,{className:"h-8 w-8 text-white"})})})]}),m.jsxs("div",{className:"p-6 space-y-4",children:[m.jsxs("div",{className:"flex items-start justify-between",children:[m.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white text-lg line-clamp-2 flex-1",children:e.title}),e.isFeatured&&m.jsx(p,{className:"h-5 w-5 text-yellow-500 fill-current ml-2 flex-shrink-0"})]}),m.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm line-clamp-2",children:e.description||"No description available"}),m.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500 dark:text-gray-400",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsxs("span",{className:"flex items-center gap-1",children:[m.jsx(y,{className:"h-4 w-4"}),e.instructorName]}),m.jsxs("span",{className:"flex items-center gap-1",children:[m.jsx(b,{className:"h-4 w-4"}),e.views||0]})]}),e.category&&m.jsx("span",{className:"px-2 py-1 bg-gradient-to-r from-blue-100 to-cyan-100 dark:from-blue-900/30 dark:to-cyan-900/30 text-xs rounded-full capitalize",children:e.category})]}),m.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-gray-100 dark:border-gray-700",children:[m.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.createdAt?new Date(e.createdAt).toLocaleDateString():"Unknown date"}),m.jsxs("div",{className:"flex gap-2",children:[m.jsxs(z,{onClick:()=>t(e),size:"sm",className:"bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600",children:[m.jsx(h,{className:"h-4 w-4 mr-1"}),"Watch"]}),m.jsx(z,{variant:"outline",size:"sm",onClick:()=>a(e),title:"Download video",children:m.jsx(f,{className:"h-4 w-4"})})]})]})]})]})})),H=c.memo(d.forwardRef(({session:e,onJoin:t,index:a,type:r},s)=>{const l=r===I,i=l?"from-red-500 to-pink-600":"from-orange-400 to-yellow-500",o=l?"border-l-red-500":"border-l-orange-500",n=l?k:N,c=l?"Live Now":"Upcoming",d=l?"Join Live":"Join Session",u=l?k:R;return m.jsxs(O.div,{ref:s,layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:Math.min(.03*a,.3),type:"spring",stiffness:400,damping:40},className:`group bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden hover:shadow-xl transition-all duration-300 hover:scale-105 border-l-4 ${o} ${l?"animate-pulse":""}`,children:[m.jsxs("div",{className:`h-48 bg-gradient-to-br ${i} relative overflow-hidden`,children:[m.jsx("div",{className:"w-full h-full flex items-center justify-center",children:m.jsx(n,{className:"h-16 w-16 text-white opacity-80 "+(l?"animate-pulse":"")})}),m.jsx("div",{className:"absolute bottom-4 left-4",children:m.jsx("span",{className:"px-3 py-1 bg-black bg-opacity-70 text-white rounded-full text-sm font-medium backdrop-blur-sm",children:Z(e.duration||60)})}),m.jsx("div",{className:"absolute top-4 right-4",children:m.jsxs("span",{className:`px-3 py-1 ${l?"bg-red-500 animate-pulse":"bg-orange-500"} text-white rounded-full text-xs font-medium flex items-center gap-1`,children:[l&&m.jsx(v,{className:"h-3 w-3"}),c]})})]}),m.jsxs("div",{className:"p-6 space-y-4",children:[m.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white text-lg line-clamp-2",children:e.title||e.topic}),m.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm line-clamp-2",children:e.description||(l?"Live session in progress":"Live session coming soon")}),m.jsx("div",{className:"flex items-center justify-between text-sm text-gray-500 dark:text-gray-400",children:m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsxs("span",{className:"flex items-center gap-1",children:[m.jsx(y,{className:"h-4 w-4"}),e.instructorName]}),m.jsxs("span",{className:"flex items-center gap-1",children:[m.jsx(j,{className:"h-4 w-4"}),q(e.scheduledTime)]})]})}),m.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-gray-100 dark:border-gray-700",children:[m.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.courseName||"General Session"}),m.jsxs(z,{size:"sm",onClick:()=>t(e),className:"bg-gradient-to-r "+(l?"from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 animate-pulse":"from-orange-500 to-yellow-500 hover:from-orange-600 hover:to-yellow-600"),children:[m.jsx(u,{className:"h-4 w-4 mr-1"}),d]})]})]})]})})),X=c.memo(()=>{w();const{user:e}=$(),[t,a]=d.useState([]),[r,s]=d.useState([]),[l,i]=d.useState([]),[c,g]=d.useState(!0),[h,p]=d.useState(""),[y,b]=d.useState("all"),[f,v]=d.useState(B),[R,q]=d.useState(W),[X,Y]=d.useState(null),[ee,te]=d.useState(!1),ae=null==e?void 0:e.uid,re=d.useRef(null),se=d.useMemo(()=>{const e=t.length,a=t.reduce((e,t)=>e+(t.duration||0),0),s=t.reduce((e,t)=>e+(t.views||0),0),i=t.filter(e=>e.progress>=95).length;return{totalRecordings:e,totalDuration:Z(a),totalViews:s,completedRecordings:i,completionRate:e>0?Math.round(i/e*100):0,upcomingCount:r.length,liveCount:l.length}},[t,r,l]),le=d.useMemo(()=>{if(!t.length&&!r.length&&!l.length)return[];let e=[];switch(R){case W:e=t.map(e=>n(o({},e),{type:W,sortDate:e.createdAt}));break;case F:e=r.map(e=>n(o({},e),{type:F,duration:e.duration||60,sortDate:e.scheduledTime}));break;case I:e=l.map(e=>n(o({},e),{type:I,duration:e.duration||60,sortDate:e.actualStartTime||e.scheduledTime}));break;default:return[]}if(h){const t=h.toLowerCase();e=e.filter(e=>{var a,r,s;return(null==(a=e.title)?void 0:a.toLowerCase().includes(t))||(null==(r=e.description)?void 0:r.toLowerCase().includes(t))||(null==(s=e.instructorName)?void 0:s.toLowerCase().includes(t))||(e.tags||[]).some(e=>e.toLowerCase().includes(t))})}return"all"!==y&&(e=e.filter(e=>e.category===y)),e.length>0&&e.sort((e,t)=>{switch(f){case G:return(e.title||"").localeCompare(t.title||"");case J:return(t.duration||0)-(e.duration||0);case _:return(t.views||0)-(e.views||0);case E:return new Date(e.sortDate||0)-new Date(t.sortDate||0);default:return new Date(t.sortDate||0)-new Date(e.sortDate||0)}}),e},[t,r,l,R,h,y,f]),ie=d.useCallback(async e=>{const t=K(e.recordingUrl);if(!t)return void alert("Invalid Google Drive link");const a=`https://drive.google.com/file/d/${t}/preview`;if(window.open(a,"_blank","noopener,noreferrer"),e.id&&ae)try{await Promise.allSettled([P.incrementRecordingViews(e.id),P.updateStudentProgress(e.id,ae,{progress:5,lastWatched:new Date})])}catch(r){}},[ae]),oe=d.useCallback(e=>{const t=K(e.recordingUrl);if(!t)return void alert("Cannot download: Invalid video URL");const a=`https://drive.google.com/uc?export=download&id=${t}`,r=document.createElement("a");r.href=a,r.download=`${e.title||"recording"}.mp4`,r.target="_blank",document.body.appendChild(r),r.click(),document.body.removeChild(r)},[]),ne=d.useCallback(async t=>{if(t.meetLink){try{await M.addParticipant(t.id,ae,{email:null==e?void 0:e.email,name:(null==e?void 0:e.displayName)||"Student",joinedAt:new Date})}catch(a){}window.open(t.meetLink,"_blank","noopener,noreferrer")}else alert("No meeting link available")},[ae,e]),ce=d.useCallback(async(e=!1)=>{if(!ae)return;re.current&&re.current.abort(),re.current=new AbortController;const t=re.current.signal;try{e?te(!0):g(!0),Y(null);const[r,l,o]=await Promise.allSettled([P.getAvailableRecordings({studentId:ae,limit:50}),M.getTeacherSessionsForStudents({limit:20,daysAhead:30}),M.getAllSessions({status:"live",limit:20})]);if(t.aborted)return;if("fulfilled"===r.status){const e=Array.isArray(r.value.recordings)?r.value.recordings:[];a(e)}else a([]);"fulfilled"===l.status?s(l.value):s([]),"fulfilled"===o.status?i(o.value):i([])}catch(r){if(t.aborted)return;Y("Failed to load content. Please try refreshing.")}finally{t.aborted||(g(!1),te(!1))}},[ae]);d.useEffect(()=>(ae&&ce(),()=>{re.current&&re.current.abort()}),[ae,ce]);const de=d.useMemo(()=>[{key:W,label:"Recordings",icon:u,count:t.length},{key:F,label:"Upcoming",icon:N,count:r.length},{key:I,label:"Live",icon:k,count:l.length}],[t.length,r.length,l.length]),me=d.useMemo(()=>[{value:B,label:"Newest First"},{value:_,label:"Most Popular"},{value:J,label:"Longest"},{value:G,label:"Title A-Z"},{value:E,label:"Soonest First"}],[]),ue=d.useMemo(()=>[{label:"Total Recordings",value:se.totalRecordings,icon:u,color:"blue"},{label:"Completed",value:se.completedRecordings,percent:se.completionRate,icon:x,color:"green"},{label:"Total Watch Time",value:se.totalDuration,icon:j,color:"purple"}],[se]);return c?m.jsxs("div",{className:"flex flex-col items-center justify-center min-h-96 space-y-4",children:[m.jsx(T,{size:"lg"}),m.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading your learning content..."})]}):m.jsxs("div",{className:"space-y-6",children:[m.jsxs(O.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[m.jsxs("div",{children:[m.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-3",children:[m.jsx(u,{className:"h-8 w-8 text-blue-500"}),"Learning Content"]}),m.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Watch recordings on Google Drive, join live sessions, and track your progress"})]}),m.jsx("div",{className:"flex gap-3",children:m.jsxs(z,{onClick:()=>ce(!0),variant:"outline",disabled:ee,children:[m.jsx(S,{className:"h-4 w-4 mr-2 "+(ee?"animate-spin":"")}),ee?"Refreshing...":"Refresh"]})})]}),X&&m.jsxs(O.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded-xl p-4 flex items-start gap-3",children:[m.jsx(C,{className:"h-5 w-5 text-red-500 mt-0.5 flex-shrink-0"}),m.jsxs("div",{className:"flex-1",children:[m.jsx("p",{className:"text-red-700 dark:text-red-300",children:X}),m.jsx(z,{onClick:()=>ce(!0),size:"sm",variant:"outline",className:"mt-2 border-red-300 text-red-700 hover:bg-red-50",children:"Try Again"})]})]}),m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:ue.map((e,t)=>m.jsx(O.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.1*t},className:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-200 dark:border-gray-700 hover:shadow-xl transition-shadow duration-300",children:m.jsxs("div",{className:"flex items-center justify-between",children:[m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:e.label}),m.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-1",children:e.value}),void 0!==e.percent&&m.jsxs("p",{className:"text-sm text-green-600 dark:text-green-400 mt-1",children:[e.percent,"% completed"]})]}),m.jsx("div",{className:`p-3 bg-${e.color}-100 dark:bg-${e.color}-900/30 rounded-lg`,children:m.jsx(e.icon,{className:`h-6 w-6 text-${e.color}-600 dark:text-${e.color}-400`})})]})},e.label))}),m.jsx(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-200 dark:border-gray-700",children:m.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-6",children:[m.jsx("div",{className:"flex space-x-1 bg-gray-100 dark:bg-gray-700 rounded-lg p-1",children:de.map(e=>m.jsxs("button",{onClick:()=>q(e.key),className:"flex items-center px-4 py-2 rounded-md text-sm font-medium transition-all duration-200 "+(R===e.key?"bg-white dark:bg-gray-600 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),children:[m.jsx(e.icon,{className:"h-4 w-4 mr-2"}),e.label,m.jsx("span",{className:"ml-2 px-1.5 py-0.5 text-xs rounded-full "+(R===e.key?"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300":"bg-gray-200 dark:bg-gray-600 text-gray-600 dark:text-gray-400"),children:e.count})]},e.key))}),m.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row lg:items-center gap-4",children:[m.jsxs("div",{className:"flex-1 relative",children:[m.jsx(D,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),m.jsx("input",{type:"text",placeholder:"Search recordings, sessions, instructors...",value:h,onChange:e=>p(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors duration-200"})]}),m.jsxs("div",{className:"flex flex-wrap gap-3",children:[m.jsxs("div",{className:"relative",children:[m.jsx(L,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),m.jsx("select",{value:y,onChange:e=>b(e.target.value),className:"pl-10 pr-8 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none cursor-pointer",children:V.map(e=>m.jsx("option",{value:e.value,children:e.label},e.value))})]}),m.jsxs("div",{className:"relative",children:[m.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),m.jsx("select",{value:f,onChange:e=>v(e.target.value),className:"pl-10 pr-8 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none cursor-pointer",children:me.map(e=>m.jsx("option",{value:e.value,children:e.label},e.value))})]})]})]})]})}),m.jsxs("div",{children:[m.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:m.jsx(U,{mode:"popLayout",children:le.map((e,t)=>e.type===W?m.jsx(Q,{recording:e,index:t,onWatch:ie,onDownload:oe},e.id):e.type===F||e.type===I?m.jsx(H,{session:e,index:t,type:e.type,onJoin:ne},e.id):null)})}),0===le.length&&m.jsxs(O.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-16",children:[R===W&&m.jsx(u,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),R===F&&m.jsx(N,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),R===I&&m.jsx(k,{className:"mx-auto h-16 w-16 text-gray-400 mb-4"}),m.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:["No ",R," found"]}),m.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6 max-w-md mx-auto",children:h||"all"!==y?"Try adjusting your search or filters to find more content.":`No ${R} are currently available. Check back later for new content.`}),m.jsxs(z,{onClick:()=>ce(!0),variant:"outline",children:[m.jsx(S,{className:"h-4 w-4 mr-2"}),"Refresh Content"]})]})]})]})});export{X as default};
