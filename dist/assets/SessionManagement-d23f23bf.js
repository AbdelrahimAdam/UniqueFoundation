import{j as e,L as s}from"./index-ce15b861.js";import{r as t}from"./vendor-0a74ad82.js";import"./firebase-383b8577.js";import{s as r}from"./sessionService-b3fdcd6e.js";import{r as a}from"./recordingService-dfe80829.js";import{c as i}from"./courseService-d53954a4.js";import{c as l,B as o}from"./Button-fb358952.js";import n from"./CreateSessionModal-40ddcd14.js";import{C as d}from"./CreateRecordingModal-d064b574.js";import{u as c}from"./useTranslation-9d3f62b5.js";import{U as m}from"./upload-a712be01.js";import{P as x}from"./plus-d285199b.js";import{R as u}from"./refresh-cw-c5a59bfc.js";import{S as g}from"./search-e15913c7.js";import{C as h}from"./calendar-9dea7464.js";import{V as p}from"./video-63348c6e.js";import{U as f}from"./users-1bfd9ab7.js";import{P as w}from"./play-circle-8e2c3fb1.js";import{E as j}from"./eye-ccc819fa.js";import{P as y}from"./pen-square-386b9902.js";import{C as b}from"./clock-5d166213.js";import{C as v}from"./check-circle-dac5ac57.js";import{F as N}from"./file-video-1f680f72.js";import"./router-80e9042b.js";import"./index.esm-e04fd8e7.js";import"./Select-3566718e.js";import"./utils-db1934d6.js";import"./chevron-down-51b415ee.js";import"./alert-circle-354385f5.js";import"./check-97dea4ca.js";import"./camera-0148ccce.js";import"./x-b8d49cff.js";import"./file-text-fe19bc5b.js";import"./link-91bf4f7a.js";import"./book-open-4dbb8b42.js";import"./user-1dea5926.js";import"./download-0e098eb5.js";import"./external-link-492650bf.js";const k=l("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),S=()=>{c();const[l,b]=t.useState([]),[S,C]=t.useState([]),[R,L]=t.useState([]),[I,P]=t.useState(!0),[E,A]=t.useState(""),[B,F]=t.useState("all"),[T,z]=t.useState("all"),[M,U]=t.useState(!1),[D,V]=t.useState(!1),[$,G]=t.useState({}),[J,O]=t.useState(null);t.useEffect(()=>{q()},[]);const q=async()=>{try{P(!0);const[e,s,t]=await Promise.all([r.getAllSessions().catch(e=>[]),a.getAllRecordings().catch(e=>[]),i.getAllCourses().catch(e=>[])]),l=e.map(e=>({...e,collection:"sessions",isFromRecordingsCollection:!1})),o=s.filter(e=>e.meetLink||"scheduled"===e.status||"live"===e.status).map(e=>({...e,collection:"recordings",isFromRecordingsCollection:!0})),n=s.filter(e=>!e.meetLink&&("completed"===e.status||"recorded"===e.status)).map(e=>({...e,collection:"recordings",isFromRecordingsCollection:!1}));b([...l,...o]),C(n),L(t)}catch(e){}finally{P(!1)}},H=e=>{e.meetLink&&window.open(e.meetLink,"_blank")},_=async e=>{try{G(s=>({...s,[e]:!0}));const s=await a.getRecordingById(e);if(!s||!s.meetLink)throw new Error("Session not found in recordings collection");await r.createSession({meetLink:s.meetLink,title:s.title,description:s.description,scheduledTime:s.scheduledTime,duration:s.duration,category:s.category,visibility:s.visibility,maxParticipants:s.maxParticipants,courseId:s.courseId,enableRecording:s.enableRecording,status:s.status,recordingStatus:s.recordingStatus,isPublished:s.isPublished,instructorId:s.instructorId,instructorEmail:s.instructorEmail,instructorName:s.instructorName,createdBy:s.createdBy});await q()}catch(s){alert("Failed to migrate session: "+s.message)}finally{G(s=>({...s,[e]:!1}))}},K=l.filter(e=>{const s=e.title?.toLowerCase().includes(E.toLowerCase())||e.topic?.toLowerCase().includes(E.toLowerCase())||e.description?.toLowerCase().includes(E.toLowerCase())||e.instructorName?.toLowerCase().includes(E.toLowerCase()),t="all"===B||e.status===B;return s&&t}),X=S.filter(e=>{const s=e.title?.toLowerCase().includes(E.toLowerCase())||e.description?.toLowerCase().includes(E.toLowerCase())||e.instructorName?.toLowerCase().includes(E.toLowerCase())||e.category?.toLowerCase().includes(E.toLowerCase()),t="all"===B||e.status===B;return s&&t}),Z=e=>{switch(e){case"scheduled":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300";case"live":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300";case"completed":case"available":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300";case"recorded":return"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-300"}};if(I)return e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsx(s,{size:"lg"})});const Q="sessions"===T?K:"recordings"===T?X:[...K,...X],W=l.filter(e=>"recordings"===e.collection),Y=l.filter(e=>"sessions"===e.collection);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white break-words",children:"Session & Recording Management"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-1 text-sm sm:text-base",children:"Manage Google Meet sessions and recordings"})]}),e.jsxs("div",{className:"flex flex-col xs:flex-row gap-2 sm:gap-3 w-full sm:w-auto",children:[e.jsxs(o,{onClick:()=>{O(null),V(!0)},variant:"outline",className:"bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white w-full sm:w-auto justify-center",children:[e.jsx(m,{className:"h-4 w-4 mr-2"}),"Add Recording"]}),e.jsxs(o,{onClick:()=>{O(null),U(!0)},className:"bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 w-full sm:w-auto justify-center",children:[e.jsx(x,{className:"h-4 w-4 mr-2"}),"Schedule Session"]})]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 sm:gap-6 justify-center sm:justify-start",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-blue-600 dark:text-blue-400",children:Y.length}),e.jsx("div",{className:"text-xs sm:text-sm text-blue-700 dark:text-blue-300",children:"Sessions in Sessions"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-orange-600 dark:text-orange-400",children:W.length}),e.jsx("div",{className:"text-xs sm:text-sm text-orange-700 dark:text-orange-300",children:"Sessions in Recordings"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-bold text-purple-600 dark:text-purple-400",children:S.length}),e.jsx("div",{className:"text-xs sm:text-sm text-purple-700 dark:text-purple-300",children:"Standalone Recordings"})]})]}),W.length>0&&e.jsxs(o,{onClick:()=>{window.confirm(`Migrate ${W.length} sessions from recordings to sessions collection?`)&&W.forEach(e=>{_(e.id)})},variant:"outline",className:"bg-orange-500 hover:bg-orange-600 text-white w-full sm:w-auto justify-center mt-2 sm:mt-0",children:[e.jsx(u,{className:"h-4 w-4 mr-2"}),"Migrate All"]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 sm:p-6 shadow-lg border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"relative",children:[e.jsx(g,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search sessions and recordings...",value:E,onChange:e=>A(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base"})]})}),e.jsxs("div",{className:"flex flex-col xs:flex-row gap-3 w-full",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("select",{value:T,onChange:e=>z(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"sessions",children:"Sessions Only"}),e.jsx("option",{value:"recordings",children:"Recordings Only"})]})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("select",{value:B,onChange:e=>F(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"scheduled",children:"Scheduled"}),e.jsx("option",{value:"live",children:"Live"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"recorded",children:"Recorded"}),e.jsx("option",{value:"available",children:"Available"})]})})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-6",children:Q.map(t=>{const i=(e=>e.meetLink?"session":"recording")(t),n="session"===i,d="recording"===i;(e=>{switch(e){case"scheduled":return h;case"live":return w;case"completed":case"available":return v;case"recorded":return N;default:;}})(t.status);const c="live"===t.status,m="scheduled"===t.status,x=t.recordingUrl||t.isRecorded,g=t.isPublished,b=(e=>"recordings"===e.collection&&e.meetLink)(t);return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden hover:shadow-xl transition-all duration-300",children:[e.jsxs("div",{className:"p-4 sm:p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-1 sm:gap-2 mb-2",children:[n&&e.jsx(h,{className:"h-3 w-3 sm:h-4 sm:w-4 text-blue-500 flex-shrink-0"}),d&&e.jsx(p,{className:"h-3 w-3 sm:h-4 sm:w-4 text-purple-500 flex-shrink-0"}),e.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${Z(t.status)} break-words`,children:[n?"Session":"Recording"," â€¢ ",t.status]}),!g&&e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300",children:"Draft"}),n&&b&&e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-300",children:"From Recordings"})]}),e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white text-base sm:text-lg line-clamp-2 break-words",children:t.title||t.topic}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-xs sm:text-sm mt-1 line-clamp-2 break-words",children:t.description})]})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-4 text-xs sm:text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(f,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:t.instructorName||"Unknown"})]}),t.scheduledTime&&e.jsxs("span",{className:"flex items-center",children:[e.jsx(h,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:new Date(t.scheduledTime).toLocaleDateString()})]})]})]}),e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[t.scheduledTime&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:"Time"}),e.jsx("span",{className:"text-xs sm:text-sm font-medium text-gray-900 dark:text-white text-right",children:new Date(t.scheduledTime).toLocaleTimeString()})]}),t.duration&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:"Duration"}),e.jsxs("span",{className:"text-xs sm:text-sm font-medium text-gray-900 dark:text-white",children:[t.duration," min"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:"Recording"}),e.jsx("span",{className:"text-xs sm:text-sm font-medium "+(x?"text-green-600 dark:text-green-400":"text-gray-500 dark:text-gray-400"),children:x?"Available":"Not available"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-4 sm:mt-6",children:[n&&c&&e.jsxs(o,{onClick:()=>H(t),className:"flex-1 min-w-[120px] bg-red-600 hover:bg-red-700 text-white text-xs sm:text-sm",children:[e.jsx(w,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),"Join Live"]}),n&&m&&e.jsxs(o,{onClick:()=>H(t),variant:"outline",className:"flex-1 min-w-[120px] text-xs sm:text-sm",children:[e.jsx(h,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),"Join"]}),n&&!x&&"completed"===t.status&&e.jsxs(o,{onClick:()=>(async(e,s=!1)=>{const t=prompt("Enter Google Drive recording URL:");if(t)try{let i;if(G(s=>({...s,[e]:!0})),i=s?S.find(s=>s.id===e&&s.meetLink):l.find(s=>s.id===e),!i)throw new Error("Session not found");s?await a.updateRecording(e,{recordingUrl:t,isRecorded:!0,recordingStatus:"available",status:"completed"}):await r.markAsRecorded(e,t),await a.createRecording({title:`${i.title} - Recording`,description:`Recording of ${i.title}`,recordingUrl:t,duration:i.duration||60,fileSize:250,quality:"1080p",courseId:i.courseId,instructorId:i.instructorId,instructorEmail:i.instructorEmail,instructorName:i.instructorName,visibility:i.visibility||"public",category:i.category||"general",status:"recorded",recordingStatus:"available",isPublished:!0}),await q()}catch(i){alert("Failed to add recording: "+i.message)}finally{G(s=>({...s,[e]:!1}))}})(t.id,b),disabled:$[t.id],className:"flex-1 min-w-[120px] bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-xs sm:text-sm",children:[$[t.id]?e.jsx(s,{size:"sm",className:"mr-1 sm:mr-2"}):e.jsx(p,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),"Add Recording"]}),x&&e.jsx("a",{href:t.recordingUrl,target:"_blank",rel:"noopener noreferrer",className:"flex-1 min-w-[120px]",children:e.jsxs(o,{variant:"outline",className:"w-full text-xs sm:text-sm",children:[e.jsx(j,{className:"h-3 w-3 sm:h-4 sm:w-4 mr-1 sm:mr-2"}),"View Recording"]})}),n&&e.jsxs("div",{className:"flex flex-wrap gap-1 sm:gap-2 w-full mt-2",children:[m&&e.jsx(o,{onClick:()=>(async(e,s=!1)=>{try{if(G(s=>({...s,[e]:!0})),s)await a.updateRecording(e,{status:"live"});else if(await r.getSessionById(e))await r.updateSessionStatus(e,"live");else{const s=await a.getRecordingById(e);if(!s||!s.meetLink)throw new Error("Session not found in any collection");await a.updateRecording(e,{status:"live"})}await q()}catch(t){alert("Failed to start session: "+t.message)}finally{G(s=>({...s,[e]:!1}))}})(t.id,b),variant:"outline",size:"sm",className:"text-xs flex-1 min-w-[60px]",children:"Start"}),c&&e.jsx(o,{onClick:()=>(async(e,s=!1)=>{try{if(G(s=>({...s,[e]:!0})),s)await a.updateRecording(e,{status:"completed"});else if(await r.getSessionById(e))await r.updateSessionStatus(e,"completed");else{const s=await a.getRecordingById(e);if(!s||!s.meetLink)throw new Error("Session not found in any collection");await a.updateRecording(e,{status:"completed"})}await q()}catch(t){alert("Failed to end session: "+t.message)}finally{G(s=>({...s,[e]:!1}))}})(t.id,b),variant:"outline",size:"sm",className:"text-xs flex-1 min-w-[60px]",children:"End"}),g?e.jsx(o,{onClick:()=>(async(e,s=!1)=>{try{if(G(s=>({...s,[e]:!0})),s)await a.updateRecording(e,{isPublished:!1});else if(await r.getSessionById(e))await r.updateSession(e,{isPublished:!1});else{const s=await a.getRecordingById(e);if(!s||!s.meetLink)throw new Error("Session not found in any collection");await a.updateRecording(e,{isPublished:!1})}await q()}catch(t){alert("Failed to unpublish session: "+t.message)}finally{G(s=>({...s,[e]:!1}))}})(t.id,b),variant:"outline",size:"sm",className:"text-xs flex-1 min-w-[85px]",children:"Unpublish"}):e.jsx(o,{onClick:()=>(async(e,s=!1)=>{try{if(G(s=>({...s,[e]:!0})),s)await a.updateRecording(e,{isPublished:!0});else if(await r.getSessionById(e))await r.updateSession(e,{isPublished:!0});else{const s=await a.getRecordingById(e);if(!s||!s.meetLink)throw new Error("Session not found in any collection");await a.updateRecording(e,{isPublished:!0})}await q()}catch(t){alert("Failed to publish session: "+t.message)}finally{G(s=>({...s,[e]:!1}))}})(t.id,b),variant:"outline",size:"sm",className:"text-xs flex-1 min-w-[70px]",children:"Publish"})]}),e.jsxs("div",{className:"flex flex-wrap gap-1 sm:gap-2 w-full mt-2",children:[n&&b&&e.jsxs(o,{onClick:()=>_(t.id),disabled:$[t.id],variant:"outline",size:"sm",className:"text-xs flex-1 min-w-[80px] text-orange-600 hover:text-orange-700 hover:bg-orange-50 dark:hover:bg-orange-900/20",children:[$[t.id]?e.jsx(s,{size:"sm",className:"mr-1"}):e.jsx(u,{className:"h-3 w-3 mr-1"}),"Migrate"]}),e.jsx(o,{onClick:()=>n?(O(t),void U(!0)):(O(t),void V(!0)),variant:"outline",size:"sm",className:"text-xs flex-1 min-w-[60px]",children:e.jsx(y,{className:"h-3 w-3"})}),e.jsx(o,{onClick:()=>n?(async(e,s=!1)=>{if(window.confirm("Are you sure you want to delete this session?"))try{G(s=>({...s,[e]:!0})),s?await a.deleteRecording(e):await r.deleteSession(e),await q()}catch(t){alert("Failed to delete session: "+t.message)}finally{G(s=>({...s,[e]:!1}))}})(t.id,b):(async e=>{if(window.confirm("Are you sure you want to delete this recording?"))try{G(s=>({...s,[e]:!0})),await a.deleteRecording(e),await q()}catch(s){alert("Failed to delete recording: "+s.message)}finally{G(s=>({...s,[e]:!1}))}})(t.id),variant:"outline",size:"sm",className:"text-xs flex-1 min-w-[60px] text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20",children:e.jsx(k,{className:"h-3 w-3"})})]})]})]})]},t.id)})}),0===Q.length&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(p,{className:"mx-auto h-12 w-12 sm:h-16 sm:w-16 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"No sessions or recordings found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6 text-sm sm:text-base",children:E||"all"!==B||"all"!==T?"Try adjusting your search or filters":"Get started by scheduling your first session or adding a recording"}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center gap-2 sm:gap-3",children:[e.jsxs(o,{onClick:()=>V(!0),variant:"outline",className:"bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white w-full sm:w-auto justify-center",children:[e.jsx(m,{className:"h-4 w-4 mr-2"}),"Add Recording"]}),e.jsxs(o,{onClick:()=>U(!0),className:"bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 w-full sm:w-auto justify-center",children:[e.jsx(x,{className:"h-4 w-4 mr-2"}),"Schedule Session"]})]})]}),M&&e.jsx(n,{onClose:()=>U(!1),onSuccess:()=>{U(!1),q()},session:J}),D&&e.jsx(d,{onClose:()=>V(!1),onSuccess:()=>{V(!1),q()},recording:J})]})};export{S as default};
